{
  "version": 3,
  "sources": ["../src/workers/timer-worker.ts"],
  "sourcesContent": ["/**\n * Web Worker timer \u2014 drift-free countdown using absolute time.\n * Messages IN:  START, ADD_TIME, PAUSE, RESUME, RESET\n * Messages OUT: TICK, DONE\n */\n\ninterface StartMsg { type: 'START'; totalMs: number; startAbsMs: number }\ninterface AddTimeMsg { type: 'ADD_TIME'; addMs: number }\ninterface AdjustMsg { type: 'ADJUST'; totalMs: number; elapsedMs: number }\ninterface PauseMsg { type: 'PAUSE' }\ninterface ResumeMsg { type: 'RESUME'; resumeAbsMs: number }\ninterface ResetMsg { type: 'RESET' }\n\ntype InMsg = StartMsg | AddTimeMsg | AdjustMsg | PauseMsg | ResumeMsg | ResetMsg;\n\nlet totalMs = 0;\nlet startAbsMs = 0;\nlet pausedElapsedMs = 0;\nlet paused = false;\nlet running = false;\nlet interval: ReturnType<typeof setInterval> | null = null;\n\nfunction tick(): void {\n  if (!running || paused) return;\n  const now = performance.now();\n  const elapsedMs = pausedElapsedMs + (now - startAbsMs);\n  const remainingMs = Math.max(0, totalMs - elapsedMs);\n\n  (self as unknown as Worker).postMessage({ type: 'TICK', remainingMs, elapsedMs });\n\n  if (remainingMs <= 0) {\n    (self as unknown as Worker).postMessage({ type: 'DONE' });\n    stop();\n  }\n}\n\nfunction stop(): void {\n  running = false;\n  if (interval !== null) {\n    clearInterval(interval);\n    interval = null;\n  }\n}\n\nself.onmessage = (e: MessageEvent<InMsg>) => {\n  const msg = e.data;\n\n  switch (msg.type) {\n    case 'START':\n      totalMs = msg.totalMs;\n      startAbsMs = msg.startAbsMs;\n      pausedElapsedMs = 0;\n      paused = false;\n      running = true;\n      if (interval !== null) clearInterval(interval);\n      interval = setInterval(tick, 100);\n      tick();\n      break;\n\n    case 'ADD_TIME':\n      totalMs += msg.addMs;\n      tick();\n      break;\n\n    case 'ADJUST':\n      totalMs = msg.totalMs;\n      if (paused) {\n        pausedElapsedMs = msg.elapsedMs;\n      } else if (running) {\n        startAbsMs = performance.now() - (msg.elapsedMs - pausedElapsedMs);\n      }\n      tick();\n      break;\n\n    case 'PAUSE':\n      if (running && !paused) {\n        const now = performance.now();\n        pausedElapsedMs += now - startAbsMs;\n        paused = true;\n      }\n      break;\n\n    case 'RESUME':\n      if (running && paused) {\n        startAbsMs = msg.resumeAbsMs;\n        paused = false;\n        tick();\n      }\n      break;\n\n    case 'RESET':\n      stop();\n      totalMs = 0;\n      pausedElapsedMs = 0;\n      paused = false;\n      break;\n  }\n};\n"],
  "mappings": ";;;AAeA,MAAI,UAAU;AACd,MAAI,aAAa;AACjB,MAAI,kBAAkB;AACtB,MAAI,SAAS;AACb,MAAI,UAAU;AACd,MAAI,WAAkD;AAEtD,WAAS,OAAa;AACpB,QAAI,CAAC,WAAW,OAAQ;AACxB,UAAM,MAAM,YAAY,IAAI;AAC5B,UAAM,YAAY,mBAAmB,MAAM;AAC3C,UAAM,cAAc,KAAK,IAAI,GAAG,UAAU,SAAS;AAEnD,IAAC,KAA2B,YAAY,EAAE,MAAM,QAAQ,aAAa,UAAU,CAAC;AAEhF,QAAI,eAAe,GAAG;AACpB,MAAC,KAA2B,YAAY,EAAE,MAAM,OAAO,CAAC;AACxD,WAAK;AAAA,IACP;AAAA,EACF;AAEA,WAAS,OAAa;AACpB,cAAU;AACV,QAAI,aAAa,MAAM;AACrB,oBAAc,QAAQ;AACtB,iBAAW;AAAA,IACb;AAAA,EACF;AAEA,OAAK,YAAY,CAAC,MAA2B;AAC3C,UAAM,MAAM,EAAE;AAEd,YAAQ,IAAI,MAAM;AAAA,MAChB,KAAK;AACH,kBAAU,IAAI;AACd,qBAAa,IAAI;AACjB,0BAAkB;AAClB,iBAAS;AACT,kBAAU;AACV,YAAI,aAAa,KAAM,eAAc,QAAQ;AAC7C,mBAAW,YAAY,MAAM,GAAG;AAChC,aAAK;AACL;AAAA,MAEF,KAAK;AACH,mBAAW,IAAI;AACf,aAAK;AACL;AAAA,MAEF,KAAK;AACH,kBAAU,IAAI;AACd,YAAI,QAAQ;AACV,4BAAkB,IAAI;AAAA,QACxB,WAAW,SAAS;AAClB,uBAAa,YAAY,IAAI,KAAK,IAAI,YAAY;AAAA,QACpD;AACA,aAAK;AACL;AAAA,MAEF,KAAK;AACH,YAAI,WAAW,CAAC,QAAQ;AACtB,gBAAM,MAAM,YAAY,IAAI;AAC5B,6BAAmB,MAAM;AACzB,mBAAS;AAAA,QACX;AACA;AAAA,MAEF,KAAK;AACH,YAAI,WAAW,QAAQ;AACrB,uBAAa,IAAI;AACjB,mBAAS;AACT,eAAK;AAAA,QACP;AACA;AAAA,MAEF,KAAK;AACH,aAAK;AACL,kBAAU;AACV,0BAAkB;AAClB,iBAAS;AACT;AAAA,IACJ;AAAA,EACF;",
  "names": []
}
