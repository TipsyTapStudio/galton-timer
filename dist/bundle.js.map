{
  "version": 3,
  "sources": ["../src/utils/url-params.ts", "../src/utils/seed.ts", "../src/engine/simulation.ts", "../src/engine/seven-seg.ts", "../src/engine/layout.ts", "../src/engine/grain-renderer.ts", "../src/engine/renderer.ts", "../src/engine/timer-bridge.ts", "../src/components/console.ts", "../src/main.ts"],
  "sourcesContent": ["/**\n * URL parameter serialization / deserialization.\n * Format: ?app=timer&t=3600&n=3600&s=42&rows=24&mode=standard&clock=true&theme=nixie&friction=1.0\n */\n\nexport type AppMode = 'timer' | 'clock';\n\nexport interface AppParams {\n  /** App mode: timer or clock */\n  app: AppMode;\n  /** Timer duration in seconds */\n  t: number;\n  /** Total number of particles */\n  n: number;\n  /** PRNG seed */\n  s: number;\n  /** Number of peg rows */\n  rows: number;\n  /** Physics mode preset name */\n  mode: string;\n  /** Clock display enabled */\n  clock: boolean;\n  /** Color theme name */\n  theme: string;\n  /** Centiseconds display enabled */\n  cs: boolean;\n  /** Friction multiplier for drag values */\n  friction: number;\n}\n\nconst VALID_MODES = ['standard', 'heavy sand', 'techno', 'moon gravity', 'super ball'];\nconst VALID_THEMES = ['nixie', 'system', 'studio', 'cyber'];\nconst VALID_APP_MODES: AppMode[] = ['timer', 'clock'];\n\nconst DEFAULTS: AppParams = {\n  app: 'timer',\n  t: 3600,\n  n: 3600,\n  s: 0,       // 0 means \"generate from timestamp\"\n  rows: 24,\n  mode: 'standard',\n  clock: false,\n  theme: 'nixie',\n  cs: true,\n  friction: 1.0,\n};\n\nexport function readParams(): AppParams {\n  const sp = new URLSearchParams(window.location.search);\n  const raw = (key: string, fallback: number): number => {\n    const v = sp.get(key);\n    if (v === null) return fallback;\n    const num = parseInt(v, 10);\n    return Number.isFinite(num) ? num : fallback;\n  };\n\n  let seed = raw('s', DEFAULTS.s);\n  if (seed === 0) {\n    seed = (Date.now() % 1_000_000) | 1;\n  }\n\n  const appRaw = (sp.get('app') || DEFAULTS.app).toLowerCase().trim() as AppMode;\n  const app = VALID_APP_MODES.includes(appRaw) ? appRaw : DEFAULTS.app;\n\n  const modeRaw = (sp.get('mode') || DEFAULTS.mode).toLowerCase().trim();\n  const mode = VALID_MODES.includes(modeRaw) ? modeRaw : DEFAULTS.mode;\n\n  const clockRaw = sp.get('clock');\n  const clock = clockRaw === null ? DEFAULTS.clock : clockRaw !== 'false' && clockRaw !== '0';\n\n  const themeRaw = (sp.get('theme') || DEFAULTS.theme).toLowerCase().trim();\n  const theme = VALID_THEMES.includes(themeRaw) ? themeRaw : DEFAULTS.theme;\n\n  const csRaw = sp.get('cs');\n  const cs = csRaw === null ? DEFAULTS.cs : csRaw !== 'false' && csRaw !== '0';\n\n  const frictionRaw = sp.get('friction');\n  const friction = frictionRaw !== null\n    ? Math.max(0.5, Math.min(3.0, parseFloat(frictionRaw) || DEFAULTS.friction))\n    : DEFAULTS.friction;\n\n  return {\n    app,\n    t: Math.max(1, raw('t', DEFAULTS.t)),\n    n: Math.max(10, Math.min(3600, raw('n', DEFAULTS.n))),\n    s: seed,\n    rows: Math.max(4, Math.min(64, raw('rows', DEFAULTS.rows))),\n    mode,\n    clock,\n    theme,\n    cs,\n    friction,\n  };\n}\n\nexport function writeParams(cfg: AppParams): void {\n  const sp = new URLSearchParams();\n  sp.set('app', cfg.app);\n  sp.set('t', String(cfg.t));\n  sp.set('n', String(cfg.n));\n  sp.set('s', String(cfg.s));\n  sp.set('rows', String(cfg.rows));\n  sp.set('mode', cfg.mode);\n  sp.set('clock', String(cfg.clock));\n  sp.set('theme', cfg.theme);\n  sp.set('cs', String(cfg.cs));\n  sp.set('friction', String(cfg.friction));\n  const url = `${window.location.pathname}?${sp.toString()}`;\n  window.history.replaceState(null, '', url);\n}\n", "/**\n * Seed-based deterministic PRNG (mulberry32).\n * Math.random() is FORBIDDEN in this project.\n * All randomness must flow through this module.\n */\nexport function createPRNG(seed: number): () => number {\n  let s = seed | 0;\n  return (): number => {\n    s |= 0;\n    s = (s + 0x6d2b79f5) | 0;\n    let t = Math.imul(s ^ (s >>> 15), 1 | s);\n    t = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;\n    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;\n  };\n}\n\n/** Hash a string into a numeric seed. */\nexport function hashSeed(str: string): number {\n  let h = 0;\n  for (let i = 0; i < str.length; i++) {\n    h = (Math.imul(31, h) + str.charCodeAt(i)) | 0;\n  }\n  return h >>> 0;\n}\n", "/**\n * Physics-based particle simulation.\n * NO PHYSICS ENGINE \u2014 simplified gravity + peg-collision model.\n *\n * Each particle carries:\n *   - Pre-computed 50/50 path  (mathematical truth, P(k)=C(n,k)(1/2)^n)\n *   - Live physics state        (x, y, vx, vy \u2014 unique kinetic drama)\n *\n * Collision model: normal-based reflection off circular peg surfaces.\n * The deflection direction emerges from geometry (collision normal),\n * NOT from artificial kick forces.\n *\n * Time authority: elapsedMs is set EXCLUSIVELY by the Web Worker timer.\n * The simulation never self-increments elapsed time.\n */\n\n// \u2500\u2500 Types \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface Particle {\n  path: number[];       // 0=left, 1=right at each peg row\n  bin: number;          // final bin = sum(path)\n  x: number;            // px\n  y: number;            // px\n  vx: number;           // px/s\n  vy: number;           // px/s\n  pegIndex: number;     // next peg row to interact with\n  settled: boolean;\n  jitter: number;       // [0,1) per-particle randomness seed\n}\n\nexport interface BoardGeom {\n  emitX: number;\n  emitY: number;\n  pegX: (row: number, index: number) => number;\n  pegY: (row: number) => number;\n  pegSpacing: number;\n  numRows: number;\n  accBottom: number;\n}\n\nexport interface SimConfig {\n  numRows: number;\n  totalParticles: number;\n  totalTimeSec: number;\n  rng: () => number;\n}\n\n// \u2500\u2500 Physics constants (tuning knobs \u2014 live-editable via Console) \u2500\u2500\n\nexport type PhysicsParams = {\n  restitution: number;    // coefficient of restitution (0 = perfectly inelastic, 1 = elastic)\n  restitutionRange: number; // per-particle random spread added to restitution\n  nudge: number;          // gentle position correction toward expected peg (0\u20130.15)\n  dragX: number;\n  dragY: number;\n  dragXSettle: number;\n  dragYSettle: number;\n  gravity: number;\n};\n\nexport const PRESETS: Record<string, PhysicsParams> = {\n  'Standard': {\n    restitution: 0.20, restitutionRange: 0.08,\n    nudge: 0.08,\n    dragX: 3.0, dragY: 1.5, dragXSettle: 6.0, dragYSettle: 3.0, gravity: 800,\n  },\n  'Heavy Sand': {\n    restitution: 0.01, restitutionRange: 0.02,\n    nudge: 0.10,\n    dragX: 6.0, dragY: 2.0, dragXSettle: 14.0, dragYSettle: 7.0, gravity: 1400,\n  },\n  'Techno': {\n    restitution: 0.0, restitutionRange: 0.0,\n    nudge: 0.15,\n    dragX: 10.0, dragY: 1.0, dragXSettle: 18.0, dragYSettle: 4.0, gravity: 1600,\n  },\n  'Moon Gravity': {\n    restitution: 0.08, restitutionRange: 0.03,\n    nudge: 0.12,\n    dragX: 2.0, dragY: 0.08, dragXSettle: 3.0, dragYSettle: 0.8, gravity: 50,\n  },\n  'Super Ball': {\n    restitution: 0.70, restitutionRange: 0.15,\n    nudge: 0.04,\n    dragX: 0.8, dragY: 0.4, dragXSettle: 2.5, dragYSettle: 1.2, gravity: 800,\n  },\n};\n\nexport const PHYSICS: PhysicsParams = { ...PRESETS['Standard'] };\n\n// \u2500\u2500 Helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction fract(x: number): number {\n  return x - Math.floor(x);\n}\n\n/**\n * Compute the smallest positive time for a particle at `y` with velocity `vy`\n * under constant gravity `g` to reach `targetY`.\n * Uses standard kinematics: y(t) = y + vy*t + 0.5*g*t\u00B2\n * Returns Infinity if the target is unreachable.\n */\nfunction timeToHit(y: number, vy: number, g: number, targetY: number): number {\n  const dy = targetY - y;\n  if (dy <= 0) return 0; // already at or past target\n\n  if (Math.abs(g) < 1e-6) {\n    // No gravity \u2014 linear: t = dy / vy\n    return vy > 1e-9 ? dy / vy : Infinity;\n  }\n\n  // Quadratic: 0.5*g*t\u00B2 + vy*t - dy = 0\n  const disc = vy * vy + 2 * g * dy;\n  if (disc < 0) return Infinity;\n\n  const sqrtDisc = Math.sqrt(disc);\n  const t1 = (-vy + sqrtDisc) / g;\n  const t2 = (-vy - sqrtDisc) / g;\n\n  // Return smallest positive root\n  let t = Infinity;\n  if (t1 > 1e-9) t = t1;\n  if (t2 > 1e-9 && t2 < t) t = t2;\n  return t;\n}\n\nexport function maxBinProbability(numRows: number): number {\n  const k = Math.floor(numRows / 2);\n  let logC = 0;\n  for (let i = 1; i <= numRows; i++) logC += Math.log(i);\n  for (let i = 1; i <= k; i++) logC -= Math.log(i);\n  for (let i = 1; i <= numRows - k; i++) logC -= Math.log(i);\n  return Math.exp(logC - numRows * Math.LN2);\n}\n\n// \u2500\u2500 Simulation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Effective peg collision radius as fraction of pegSpacing. */\nconst PEG_COLLISION_FRAC = 0.30;\n\nexport class Simulation {\n  readonly numRows: number;\n  readonly totalParticles: number;\n  totalTimeMs: number;\n\n  binCounts: number[];\n  activeParticles: Particle[] = [];\n  emittedCount = 0;\n  elapsedMs = 0;\n  allEmitted = false;\n  allSettled = false;\n\n  private rng: () => number;\n  emitIntervalMs: number;\n\n  constructor(cfg: SimConfig) {\n    this.numRows = cfg.numRows;\n    this.totalParticles = cfg.totalParticles;\n    this.totalTimeMs = cfg.totalTimeSec * 1000;\n    this.rng = cfg.rng;\n    this.binCounts = new Array(cfg.numRows + 1).fill(0);\n    this.emitIntervalMs = this.totalTimeMs / cfg.totalParticles;\n  }\n\n  /**\n   * Advance simulation. Returns newly-settled particles for baking.\n   *\n   * IMPORTANT: This method does NOT advance elapsedMs.\n   * elapsedMs is set exclusively by the Worker timer via setElapsedMs().\n   * Emission is derived from the current elapsedMs value.\n   */\n  update(\n    dtMs: number,\n    geom: BoardGeom,\n    getGroundY: (x: number) => number,\n  ): Particle[] {\n    const dt = Math.min(dtMs, 100) / 1000; // seconds, capped\n    const settled: Particle[] = [];\n\n    // \u2500\u2500 Emission (derived from Worker-authoritative elapsedMs) \u2500\u2500\n    if (!this.allEmitted) {\n      const expectedEmitted = Math.min(\n        this.totalParticles,\n        Math.floor(this.elapsedMs / this.emitIntervalMs),\n      );\n      const toEmit = expectedEmitted - this.emittedCount;\n      for (let i = 0; i < toEmit; i++) {\n        this.activeParticles.push(this.createParticle(geom));\n      }\n      if (this.emittedCount >= this.totalParticles) this.allEmitted = true;\n    }\n\n    // \u2500\u2500 Physics \u2500\u2500\n    const alive: Particle[] = [];\n    const halfBoard = geom.pegSpacing * (this.numRows / 2 + 1.5);\n    const pegR = geom.pegSpacing * PEG_COLLISION_FRAC;\n\n    for (const p of this.activeParticles) {\n      const g = PHYSICS.gravity;\n\n      // Drag (stronger in settling zone)\n      const settling = p.pegIndex >= this.numRows;\n      const dxCoeff = settling ? PHYSICS.dragXSettle : PHYSICS.dragX;\n      const dyCoeff = settling ? PHYSICS.dragYSettle : PHYSICS.dragY;\n      p.vx *= Math.exp(-dxCoeff * dt);\n      p.vy *= Math.exp(-dyCoeff * dt);\n\n      // \u2500\u2500 CCD sweep loop (quadratic \u2014 accounts for gravity during flight) \u2500\u2500\n      let remainDt = dt;\n      let didSettle = false;\n      const MAX_CCD_ITER = this.numRows + 2;\n\n      for (let iter = 0; iter < MAX_CCD_ITER && remainDt > 0; iter++) {\n        if (p.pegIndex < this.numRows) {\n          // \u2500\u2500 Peg zone \u2500\u2500\n          const pegRowY = geom.pegY(p.pegIndex);\n          const tHit = timeToHit(p.y, p.vy, g, pegRowY);\n\n          if (tHit > remainDt) {\n            p.x += p.vx * remainDt;\n            p.y += p.vy * remainDt + 0.5 * g * remainDt * remainDt;\n            p.vy += g * remainDt;\n            remainDt = 0;\n            break;\n          }\n\n          // Advance to exact collision point\n          p.x += p.vx * tHit;\n          p.vy += g * tHit;\n          p.y = pegRowY;\n          remainDt -= tHit;\n\n          // \u2500\u2500 Collision response \u2014 normal-based reflection \u2500\u2500\n          const dir = p.path[p.pegIndex];\n          const bj = fract(p.jitter * 997.0 + p.pegIndex * 7.31);\n\n          let hIdx = 0;\n          for (let i = 0; i < p.pegIndex; i++) hIdx += p.path[i];\n          const pegCX = geom.pegX(p.pegIndex, hIdx);\n\n          const nudge = PHYSICS.nudge;\n          p.x = p.x * (1 - nudge) + pegCX * nudge;\n\n          let dx = p.x - pegCX;\n          const minOff = pegR * (0.10 + 0.12 * bj);\n          if (dir === 1 && dx < minOff) dx = minOff;\n          if (dir === 0 && dx > -minOff) dx = -minOff;\n          dx = Math.max(-pegR, Math.min(pegR, dx));\n\n          const frac = dx / pegR;\n          const nx = frac;\n          const ny = -Math.sqrt(Math.max(0, 1 - frac * frac));\n\n          const vDotN = p.vx * nx + p.vy * ny;\n          if (vDotN < 0) {\n            const e = PHYSICS.restitution + PHYSICS.restitutionRange * bj;\n            p.vx -= (1 + e) * vDotN * nx;\n            p.vy -= (1 + e) * vDotN * ny;\n          }\n\n          p.pegIndex++;\n        } else {\n          // \u2500\u2500 Settling zone \u2014 CCD against ground \u2500\u2500\n          const groundY = getGroundY(p.x);\n          const tGround = timeToHit(p.y, p.vy, g, groundY);\n\n          if (tGround > remainDt) {\n            p.x += p.vx * remainDt;\n            p.y += p.vy * remainDt + 0.5 * g * remainDt * remainDt;\n            p.vy += g * remainDt;\n            remainDt = 0;\n            break;\n          }\n\n          // Hit ground\n          p.x += p.vx * tGround;\n          p.y = groundY;\n          p.settled = true;\n          this.binCounts[p.bin]++;\n          settled.push(p);\n          didSettle = true;\n          break;\n        }\n      }\n\n      if (didSettle) continue;\n      p.x = Math.max(geom.emitX - halfBoard, Math.min(geom.emitX + halfBoard, p.x));\n      alive.push(p);\n    }\n\n    this.activeParticles = alive;\n    if (this.allEmitted && alive.length === 0) this.allSettled = true;\n\n    return settled;\n  }\n\n  getRemainingTimeSec(): number {\n    return Math.max(0, (this.totalTimeMs - this.elapsedMs) / 1000);\n  }\n\n  /**\n   * Set elapsed time from Worker tick.\n   * This is the SOLE source of truth for elapsed time.\n   */\n  setElapsedMs(ms: number): void {\n    this.elapsedMs = ms;\n  }\n\n  /** Add time to total duration and recalculate emission interval. */\n  addTime(ms: number): void {\n    this.totalTimeMs += ms;\n    this.emitIntervalMs = this.totalTimeMs / this.totalParticles;\n  }\n\n  /**\n   * Instant-snap: emit all particles that SHOULD have been emitted by now\n   * (based on current elapsedMs) but weren't. Skip physics; settle immediately.\n   * Used after tab-hidden restore when elapsedMs has advanced but update() didn't run.\n   */\n  instantSnap(geom: BoardGeom): Particle[] {\n    const expectedEmitted = Math.min(\n      this.totalParticles,\n      Math.floor(this.elapsedMs / this.emitIntervalMs),\n    );\n    const toEmit = expectedEmitted - this.emittedCount;\n    if (toEmit <= 0) return [];\n\n    const settled: Particle[] = [];\n    for (let i = 0; i < toEmit; i++) {\n      const p = this.createParticle(geom);\n      p.settled = true;\n      p.pegIndex = this.numRows;\n      this.binCounts[p.bin]++;\n      settled.push(p);\n    }\n\n    if (this.emittedCount >= this.totalParticles) this.allEmitted = true;\n    return settled;\n  }\n\n  /**\n   * Force-settle all active (in-flight) particles immediately.\n   * Returns them for baking. Used when restoring from hidden tab.\n   */\n  forceSettleActive(): Particle[] {\n    const settled: Particle[] = [];\n    for (const p of this.activeParticles) {\n      p.settled = true;\n      p.pegIndex = this.numRows;\n      this.binCounts[p.bin]++;\n      settled.push(p);\n    }\n    this.activeParticles = [];\n    return settled;\n  }\n\n  /** Reset simulation to initial state \u2014 all particles removed, counters zeroed. */\n  reset(): void {\n    this.activeParticles = [];\n    this.binCounts.fill(0);\n    this.emittedCount = 0;\n    this.elapsedMs = 0;\n    this.allEmitted = false;\n    this.allSettled = false;\n  }\n\n  private createParticle(geom: BoardGeom): Particle {\n    const path: number[] = [];\n    let bin = 0;\n    for (let i = 0; i < this.numRows; i++) {\n      const d = this.rng() < 0.5 ? 0 : 1;\n      path.push(d);\n      bin += d;\n    }\n    this.emittedCount++;\n    return {\n      path,\n      bin,\n      x: geom.emitX,\n      y: geom.emitY,\n      vx: 0,\n      vy: 0,\n      pegIndex: 0,\n      settled: false,\n      jitter: this.rng(),\n    };\n  }\n}\n", "/**\n * Seven-segment neon clock renderer.\n *\n * Segment layout:\n *   \u2500a\u2500\n *  \u2502   \u2502\n *  f   b\n *  \u2502   \u2502\n *   \u2500g\u2500\n *  \u2502   \u2502\n *  e   c\n *  \u2502   \u2502\n *   \u2500d\u2500\n *\n * Rendering: no shadowBlur. Glow via multi-pass overlay at scaled width.\n * Ultra-thin segments \u2014 glow is the star, core is the whisper.\n */\n\n// \u2500\u2500 Segment map: [a,b,c,d,e,f,g] per digit 0-9 \u2500\u2500\n\nexport const DIGIT_SEGMENTS: boolean[][] = [\n  [true,  true,  true,  true,  true,  true,  false], // 0\n  [false, true,  true,  false, false, false, false], // 1\n  [true,  true,  false, true,  true,  false, true],  // 2\n  [true,  true,  true,  true,  false, false, true],  // 3\n  [false, true,  true,  false, false, true,  true],  // 4\n  [true,  false, true,  true,  false, true,  true],  // 5\n  [true,  false, true,  true,  true,  true,  true],  // 6\n  [true,  true,  true,  false, false, false, false], // 7\n  [true,  true,  true,  true,  true,  true,  true],  // 8\n  [true,  true,  true,  true,  false, true,  true],  // 9\n];\n\n// \u2500\u2500 Theme interface \u2500\u2500\n\nexport interface ClockTheme {\n  name: string;\n  segmentRGB: [number, number, number];\n  grainRGB: [number, number, number];\n  glowIntensity: number;\n}\n\nexport const CLOCK_THEMES: ClockTheme[] = [\n  { name: 'Nixie',  segmentRGB: [255, 147, 41],  grainRGB: [255, 180, 100], glowIntensity: 1.2 },\n  { name: 'System', segmentRGB: [0, 255, 65],     grainRGB: [120, 255, 140], glowIntensity: 0.8 },\n  { name: 'Studio', segmentRGB: [220, 220, 230],  grainRGB: [230, 230, 240], glowIntensity: 1.0 },\n  { name: 'Cyber',  segmentRGB: [0, 150, 255],    grainRGB: [80, 180, 255],  glowIntensity: 1.0 },\n];\n\nexport function getThemeByName(name: string): ClockTheme {\n  const lower = name.toLowerCase();\n  return CLOCK_THEMES.find(t => t.name.toLowerCase() === lower) || CLOCK_THEMES[0];\n}\n\n// \u2500\u2500 Segment geometry helpers \u2500\u2500\n\nfunction drawSegmentPath(\n  ctx: CanvasRenderingContext2D,\n  x: number, y: number,\n  w: number, h: number,\n  segIndex: number,\n  thickness: number,\n): void {\n  const ht = thickness / 2;\n  const margin = thickness * 0.3;\n\n  let sx: number, sy: number, len: number, horizontal: boolean;\n\n  switch (segIndex) {\n    case 0: sx = x + margin; sy = y; len = w - margin * 2; horizontal = true; break;\n    case 1: sx = x + w; sy = y + margin; len = h / 2 - margin * 2; horizontal = false; break;\n    case 2: sx = x + w; sy = y + h / 2 + margin; len = h / 2 - margin * 2; horizontal = false; break;\n    case 3: sx = x + margin; sy = y + h; len = w - margin * 2; horizontal = true; break;\n    case 4: sx = x; sy = y + h / 2 + margin; len = h / 2 - margin * 2; horizontal = false; break;\n    case 5: sx = x; sy = y + margin; len = h / 2 - margin * 2; horizontal = false; break;\n    case 6: sx = x + margin; sy = y + h / 2; len = w - margin * 2; horizontal = true; break;\n    default: return;\n  }\n\n  if (horizontal) {\n    ctx.moveTo(sx, sy);\n    ctx.lineTo(sx + ht, sy - ht);\n    ctx.lineTo(sx + len - ht, sy - ht);\n    ctx.lineTo(sx + len, sy);\n    ctx.lineTo(sx + len - ht, sy + ht);\n    ctx.lineTo(sx + ht, sy + ht);\n    ctx.closePath();\n  } else {\n    ctx.moveTo(sx, sy);\n    ctx.lineTo(sx - ht, sy + ht);\n    ctx.lineTo(sx - ht, sy + len - ht);\n    ctx.lineTo(sx, sy + len);\n    ctx.lineTo(sx + ht, sy + len - ht);\n    ctx.lineTo(sx + ht, sy + ht);\n    ctx.closePath();\n  }\n}\n\n// \u2500\u2500 Public drawing functions \u2500\u2500\n\nexport function drawDigit(\n  ctx: CanvasRenderingContext2D,\n  x: number, y: number,\n  w: number, h: number,\n  segments: boolean[],\n  rgb: [number, number, number],\n  glowIntensity: number,\n): void {\n  // Ultra-thin core \u2014 glow is the protagonist\n  const thickness = Math.max(1.2, w * 0.07);\n\n  // 6 glow passes: outer 2 softer, inner 4 hotter\n  const glowScales = [5.5, 4.5, 3.5, 2.8, 2.2, 1.8];\n  const glowAlphaFactors = [0.5, 0.7, 1.0, 1.0, 1.2, 1.2];\n\n  for (let s = 0; s < 7; s++) {\n    if (segments[s]) {\n      const glowAlpha = 0.09 * glowIntensity;\n      for (let pass = 0; pass < 6; pass++) {\n        ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${(glowAlpha * glowAlphaFactors[pass]).toFixed(4)})`;\n        ctx.beginPath();\n        drawSegmentPath(ctx, x, y, w, h, s, thickness * glowScales[pass]);\n        ctx.fill();\n      }\n\n      // Core: crisp thin line\n      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},0.85)`;\n      ctx.beginPath();\n      drawSegmentPath(ctx, x, y, w, h, s, thickness);\n      ctx.fill();\n    } else {\n      // Off segment: barely-there ghost\n      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},0.02)`;\n      ctx.beginPath();\n      drawSegmentPath(ctx, x, y, w, h, s, thickness);\n      ctx.fill();\n    }\n  }\n}\n\n/**\n * Draw a colon (two dots) between digit groups.\n */\nfunction drawColon(\n  ctx: CanvasRenderingContext2D,\n  x: number, y: number,\n  dotR: number,\n  rgb: [number, number, number],\n  glowIntensity: number,\n  digitH: number,\n): void {\n  const topY = y - digitH * 0.20;\n  const botY = y + digitH * 0.20;\n  const alpha = 0.4;\n\n  // Glow passes\n  const glowAlpha = 0.09 * glowIntensity;\n  for (const dy of [topY, botY]) {\n    for (let pass = 0; pass < 3; pass++) {\n      const scale = [3.0, 2.2, 1.6][pass];\n      const factor = [0.6, 0.9, 1.1][pass];\n      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${(glowAlpha * factor).toFixed(4)})`;\n      ctx.beginPath();\n      ctx.arc(x, dy, dotR * scale, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    // Core dot\n    ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${alpha})`;\n    ctx.beginPath();\n    ctx.arc(x, dy, dotR, 0, Math.PI * 2);\n    ctx.fill();\n  }\n}\n\n/**\n * Draw clock centered at (cx, cy).\n * With centiseconds: MM : SS : CC (6 digits + colons)\n * Without centiseconds: MM : SS or HH : MM : SS (colons included)\n */\nexport function drawClock(\n  ctx: CanvasRenderingContext2D,\n  totalSec: number,\n  cx: number, cy: number,\n  digitH: number,\n  theme: ClockTheme,\n  centiseconds?: number,\n  showHours?: boolean,\n): void {\n  const hh = Math.floor(totalSec / 3600);\n  const mm = Math.floor((totalSec % 3600) / 60);\n  const ss = Math.floor(totalSec % 60);\n\n  const digitW = digitH * 0.50;\n  const pairGap = digitW * 0.35;    // luxurious intra-pair kerning\n  const groupGap = digitW * 1.3;    // wide group separation \u2014 colon breathes\n\n  const rgb = theme.segmentRGB;\n  const glow = theme.glowIntensity;\n\n  // Determine groups\n  let groups: number[][];\n  if (centiseconds !== undefined) {\n    // MM : SS : CC\n    groups = [\n      [Math.floor(mm / 10), mm % 10],\n      [Math.floor(ss / 10), ss % 10],\n      [Math.floor(centiseconds / 10), centiseconds % 10],\n    ];\n  } else if (hh > 0 || showHours) {\n    // HH : MM : SS\n    groups = [\n      [Math.floor(hh / 10), hh % 10],\n      [Math.floor(mm / 10), mm % 10],\n      [Math.floor(ss / 10), ss % 10],\n    ];\n  } else {\n    // MM : SS\n    groups = [\n      [Math.floor(mm / 10), mm % 10],\n      [Math.floor(ss / 10), ss % 10],\n    ];\n  }\n\n  const numGroups = groups.length;\n  const pairW = digitW * 2 + pairGap;\n  const totalW = pairW * numGroups + groupGap * (numGroups - 1);\n  const startX = cx - totalW / 2;\n  const startY = cy - digitH / 2;\n\n  let dx = startX;\n  const dotR = Math.max(1.2, digitW * 0.08);\n\n  for (let g = 0; g < numGroups; g++) {\n    const [d1, d2] = groups[g];\n    drawDigit(ctx, dx, startY, digitW, digitH, DIGIT_SEGMENTS[d1], rgb, glow);\n    dx += digitW + pairGap;\n    drawDigit(ctx, dx, startY, digitW, digitH, DIGIT_SEGMENTS[d2], rgb, glow);\n    dx += digitW;\n\n    // Draw colon between groups\n    if (g < numGroups - 1) {\n      const colonX = dx + groupGap / 2;\n      drawColon(ctx, colonX, cy, dotR, rgb, glow, digitH);\n      dx += groupGap;\n    }\n  }\n}\n", "/**\r\n * Pure geometry \u2014 no canvas, no DOM.\r\n * Layout computation, peg coordinates, hopper grain positions, stack jitter.\r\n */\r\n\r\nimport { maxBinProbability } from './simulation';\r\n\r\nexport const SQRT3_2 = Math.sqrt(3) / 2;\r\n\r\n// \u2500\u2500 Layout \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\r\n\r\nexport interface Layout {\r\n  width: number;\r\n  height: number;\r\n  dpr: number;\r\n  centerX: number;\r\n  contentW: number;\r\n\r\n  // Hopper (funnel: rect top + trapezoid bottom)\r\n  hopperTop: number;\r\n  hopperJunction: number;  // rect\u2192trapezoid seam\r\n  hopperBottom: number;    // nozzle exit\r\n  hopperRectHW: number;    // half-width of rect section\r\n  hopperTopHW: number;     // alias for hopperRectHW\r\n  nozzleHW: number;        // half-width at nozzle (= gridTopHW)\r\n  hopperSigma: number;     // sigma in peg-spacing units for Gaussian envelope\r\n\r\n  // Board\r\n  emitY: number;\r\n  boardTop: number;\r\n  boardBottom: number;\r\n\r\n  // Accumulation\r\n  accTop: number;\r\n  accBottom: number;\r\n  accHeight: number;\r\n\r\n  // Inline timer\r\n  inlineTimerY: number;\r\n\r\n  // Sizing\r\n  pegSpacing: number;\r\n  rowSpacingY: number;\r\n  numRows: number;\r\n  pegRadius: number;\r\n  grainRadius: number;\r\n  settledDiameter: number;\r\n  settledRadius: number;\r\n  stackScale: number;\r\n  stackRowH: number;     // rendering row height for stacks (normalized)\r\n  miniGrainR: number;    // tiny dot radius for hopper + stack texture\r\n}\r\n\r\nexport function computeLayout(\r\n  w: number,\r\n  h: number,\r\n  dpr: number,\r\n  numRows: number,\r\n  totalParticles: number,\r\n): Layout {\r\n  const centerX = w / 2;\r\n  const marginX = w * 0.15;\r\n  const contentW = w - marginX * 2;\r\n\r\n  // \u2500\u2500 Safe zones \u2500\u2500\r\n  // topMargin and bottomMargin are INVIOLABLE \u2014 stacks never cross bottomMargin.\r\n  const topMargin = h * 0.05;\r\n  const bottomMargin = h * 0.15;\r\n  const safeH = h - topMargin - bottomMargin;\r\n\r\n  // \u2500\u2500 Grid sizing \u2500\u2500\r\n  const dxFromWidth = contentW / (numRows + 2);\r\n\r\n  const inlineTimerH = h * 0.06;\r\n  const gapBudget = h * 0.03;\r\n  const availableForSystem = safeH - inlineTimerH - gapBudget;\r\n\r\n  const boardH_target = availableForSystem * 3 / 5;\r\n  const dxFromRatio = numRows > 1\r\n    ? boardH_target / ((numRows - 1) * SQRT3_2)\r\n    : dxFromWidth;\r\n\r\n  const pegSpacing = Math.min(dxFromWidth, dxFromRatio);\r\n  const rowSpacingY = pegSpacing * SQRT3_2;\r\n  const boardH = numRows > 1 ? (numRows - 1) * rowSpacingY : 0;\r\n\r\n  // \u2500\u2500 Universal grain radius \u2500\u2500\r\n  const grainRadius = Math.max(1.2, Math.min(3.5, pegSpacing * 0.09));\r\n  const pegRadius = Math.max(1.5, Math.min(5.0, pegSpacing * 0.12));\r\n\r\n  // \u2500\u2500 Hopper dimensions \u2500\u2500\r\n  const nozzleHW = pegSpacing * 0.8;\r\n  const gridHW = (numRows * pegSpacing) / 2;\r\n  const hopperTopHW = Math.max(pegSpacing * 4, gridHW * 1.3);\r\n  const hopperRectHW = hopperTopHW;\r\n\r\n  const taperH = Math.max(boardH / 3, pegSpacing * 2.5);\r\n\r\n  // \u2500\u2500 Gaps \u2500\u2500\r\n  const hopperToGrid = Math.max(pegSpacing * 0.6, h * 0.012);\r\n  const gridToAcc = Math.max(pegSpacing * 0.7, h * 0.015);\r\n\r\n  // \u2500\u2500 Accumulation: bottom-anchored \u2500\u2500\r\n  // accBottom is FIXED at the UI buffer line. Stacks grow upward from here.\r\n  const accBottom = h - bottomMargin;\r\n\r\n  // Compute how much space the hopper + grid consume above stacks\r\n  const aboveAccH = inlineTimerH + taperH + hopperToGrid + boardH + gridToAcc;\r\n\r\n  // accHeight gets whatever remains, capped at boardH/2 to keep proportions sane\r\n  const accHeight_available = safeH - aboveAccH;\r\n  const accHeight = Math.max(pegSpacing * 2, Math.min(accHeight_available, boardH / 2));\r\n\r\n  // \u2500\u2500 Accumulation grain sizing \u2500\u2500\r\n  const maxProb = maxBinProbability(numRows);\r\n  const maxBinCount = maxProb * totalParticles * 1.15;\r\n\r\n  // \u2500\u2500 Position everything bottom-up from the anchor \u2500\u2500\r\n  const accTop = accBottom - accHeight;\r\n  const boardBottom = accTop - gridToAcc;\r\n  const boardTopY = boardBottom - boardH;\r\n  const hopperBottom = boardTopY - hopperToGrid;\r\n  const hopperTop = hopperBottom - taperH;\r\n  const hopperJunction = hopperTop;\r\n  const emitY = hopperBottom + hopperToGrid * 0.55;\r\n  // Inline timer sits above hopper; clamp so it never overlaps or goes off-screen\r\n  const inlineTimerY = Math.max(topMargin + inlineTimerH * 0.5, hopperTop - inlineTimerH * 0.6);\r\n\r\n  const stackScale = (accHeight * 0.85) / (maxProb * totalParticles);\r\n\r\n  // Stack rendering: row height normalized so peak bin \u2264 accHeight * 0.95\r\n  const d_natural = grainRadius * 1.6;\r\n  const rowH_natural = d_natural * SQRT3_2;\r\n  const peakCeiling = accHeight * 0.95;\r\n  const stackRowH = maxBinCount > 0\r\n    ? Math.min(rowH_natural, peakCeiling / maxBinCount)\r\n    : rowH_natural;\r\n\r\n  // Mini-grain radius: smaller than falling particles, used for hopper + stack texture\r\n  const miniGrainR = Math.max(0.8, grainRadius * 0.55);\r\n\r\n  // \u2500\u2500 Vertical centering \u2500\u2500\r\n  let finalHopperTop = hopperTop;\r\n  let finalHopperJunction = hopperJunction;\r\n  let finalHopperBottom = hopperBottom;\r\n  let finalEmitY = emitY;\r\n  let finalBoardTop = boardTopY;\r\n  let finalBoardBottom = boardBottom;\r\n  let finalAccTop = accTop;\r\n  let finalAccBottom = accBottom;\r\n  let finalInlineTimerY = inlineTimerY;\r\n\r\n  const contentTop = finalInlineTimerY - inlineTimerH * 0.5;\r\n  const contentBottom = finalAccBottom;\r\n  const totalContentH = contentBottom - contentTop;\r\n\r\n  const idealOffsetY = (h - totalContentH) / 2 - contentTop;\r\n\r\n  const uiSafeBottom = h * 0.12;\r\n  const maxOffset = (h - uiSafeBottom) - finalAccBottom;\r\n  const minOffset = topMargin - contentTop;\r\n  const offsetY = Math.max(minOffset, Math.min(idealOffsetY, maxOffset));\r\n\r\n  finalHopperTop += offsetY;\r\n  finalHopperJunction += offsetY;\r\n  finalHopperBottom += offsetY;\r\n  finalEmitY += offsetY;\r\n  finalBoardTop += offsetY;\r\n  finalBoardBottom += offsetY;\r\n  finalAccTop += offsetY;\r\n  finalAccBottom += offsetY;\r\n  finalInlineTimerY += offsetY;\r\n\r\n  return {\r\n    width: w, height: h, dpr, centerX, contentW,\r\n    hopperTop: finalHopperTop,\r\n    hopperJunction: finalHopperJunction,\r\n    hopperBottom: finalHopperBottom,\r\n    hopperRectHW, hopperTopHW: hopperRectHW, nozzleHW,\r\n    hopperSigma: taperH * 0.47 / pegSpacing,\r\n    emitY: finalEmitY,\r\n    boardTop: finalBoardTop, boardBottom: finalBoardBottom,\r\n    accTop: finalAccTop, accBottom: finalAccBottom, accHeight,\r\n    inlineTimerY: finalInlineTimerY,\r\n    pegSpacing, rowSpacingY, numRows, pegRadius,\r\n    grainRadius, settledDiameter: stackRowH,\r\n    settledRadius: stackRowH / 2,\r\n    stackScale,\r\n    stackRowH,\r\n    miniGrainR,\r\n  };\r\n}\r\n\r\n// \u2500\u2500 Peg coordinates (pure functions) \u2500\u2500\r\n\r\nexport function pegX(L: Layout, row: number, index: number): number {\r\n  return L.centerX + (index - row / 2) * L.pegSpacing;\r\n}\r\n\r\nexport function pegY(L: Layout, row: number): number {\r\n  return L.boardTop + row * L.rowSpacingY;\r\n}\r\n\r\n// \u2500\u2500 Gaussian half-width for inverted bell-curve hopper \u2500\u2500\r\n\r\nexport function gaussianHW(y: number, L: Layout): number {\r\n  const totalH = L.hopperBottom - L.hopperTop;\r\n  if (totalH <= 0) return L.nozzleHW;\r\n  const t = Math.max(0, Math.min(1, (L.hopperBottom - y) / totalH)); // 0=bottom, 1=top\r\n  const sigPx = L.hopperSigma * L.pegSpacing;\r\n  const d = t * totalH;\r\n  const gaussVal = 1 - Math.exp(-(d * d) / (2 * sigPx * sigPx));\r\n  return L.nozzleHW + (L.hopperTopHW - L.nozzleHW) * gaussVal;\r\n}\r\n\r\n// \u2500\u2500 Hopper grain positions (hex-packed, bottom-up) \u2500\u2500\r\n\r\nexport interface HopperGrain {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nexport function computeHopperGrains(\r\n  L: Layout,\r\n  totalCount: number,\r\n  grainR: number,\r\n): HopperGrain[] {\r\n  const grains: HopperGrain[] = [];\r\n  const d = grainR * 2.1;\r\n  const rowH = d * SQRT3_2;\r\n  const cx = L.centerX;\r\n  const trapH = L.hopperBottom - L.hopperJunction;\r\n\r\n  let row = 0;\r\n  let y = L.hopperBottom - grainR * 1.5;\r\n\r\n  while (grains.length < totalCount) {\r\n    const hw = gaussianHW(y, L);\r\n\r\n    const usableW = hw * 0.88;\r\n    const xOff = (row % 2 === 1) ? d * 0.5 : 0;\r\n    const nCols = Math.max(1, Math.floor((usableW * 2) / d));\r\n\r\n    for (let c = 0; c < nCols && grains.length < totalCount; c++) {\r\n      const gx = cx - usableW + xOff + c * d + grainR;\r\n      const seed = (row * 1009 + c * 7919 + 31337) & 0x7fffffff;\r\n      const jx = ((seed % 1000) / 1000 - 0.5) * grainR * 0.5;\r\n      const jy = (((seed * 1103515245 + 12345) & 0x7fffffff) % 1000 / 1000 - 0.5) * grainR * 0.4;\r\n      grains.push({ x: gx + jx, y: y + jy });\r\n    }\r\n\r\n    y -= rowH;\r\n    row++;\r\n  }\r\n  return grains;\r\n}\r\n\r\n// \u2500\u2500 Deterministic jitter for stack grains \u2500\u2500\r\n\r\nexport function stackJitterX(bin: number, k: number, maxJitter: number): number {\r\n  const hash = ((bin * 2654435761 + k * 340573321) >>> 0) & 0x7fffffff;\r\n  return (hash % 10000 / 10000 - 0.5) * 2 * maxJitter;\r\n}\r\n\r\nexport function stackJitterY(bin: number, k: number, maxJitter: number): number {\r\n  const hash = ((bin * 1103515245 + k * 1299709) >>> 0) & 0x7fffffff;\r\n  return (hash % 10000 / 10000 - 0.5) * 2 * maxJitter;\r\n}\r\n", "/**\r\n * GrainRenderer \u2014 owns both canvases + all grain/peg/hopper drawing.\r\n *\r\n * Architecture:\r\n *   staticCanvas  \u2014 settled grains baked once, never redrawn per frame.\r\n *   dynamicCanvas \u2014 moving particles, pegs, hopper grains, UI \u2014 cleared each frame.\r\n */\r\n\r\nimport type { Particle } from './simulation';\r\nimport type { ClockTheme } from './seven-seg';\r\nimport {\r\n  Layout, HopperGrain,\r\n  pegX, pegY,\r\n  stackJitterX, stackJitterY,\r\n  computeHopperGrains,\r\n  gaussianHW,\r\n} from './layout';\r\n\r\nconst PI2 = Math.PI * 2;\r\n\r\n// \u2500\u2500 Unified grain appearance \u2500\u2500\r\nconst GRAIN_ALPHA = 0.85;          // moving particles\r\nconst GRAIN_GLOW_ALPHA = 0.06;\r\nconst GRAIN_GLOW_SCALE = 2.5;\r\nconst STATIC_GRAIN_ALPHA = 1.0;    // baked stack grains \u2014 fully opaque to prevent accumulation\r\n\r\nexport class GrainRenderer {\r\n  readonly staticCanvas: HTMLCanvasElement;\r\n  readonly dynamicCanvas: HTMLCanvasElement;\r\n  readonly sCtx: CanvasRenderingContext2D;\r\n  readonly dCtx: CanvasRenderingContext2D;\r\n\r\n  /** Per-bin settled grain counts. */\r\n  private binCounts: number[];\r\n\r\n  /** Hopper grain positions (pre-computed). */\r\n  private hopperGrainCache: HopperGrain[] = [];\r\n  /** Topmost grain Y (minimum Y in cache). */\r\n  private hopperGrainTopY = 0;\r\n\r\n  // \u2500\u2500 Hopper fade (for stop\u2192idle transition) \u2500\u2500\r\n  private hopperFadeAlpha = 1;\r\n\r\n  // \u2500\u2500 Purge drain animation \u2500\u2500\r\n  private purgeOffsets: number[] = [];\r\n  private purgeVelocities: number[] = [];\r\n  private purgeDelays: number[] = [];\r\n  private purgeAlphas: number[] = [];\r\n  private purging = false;\r\n\r\n  // \u2500\u2500 Grain colors \u2500\u2500\r\n  private grainCoreFill = '';\r\n  private grainGlowFill = '';\r\n  private staticGrainFill = '';    // opaque \u2014 for baked stack grains\r\n\r\n  constructor(container: HTMLElement) {\r\n    this.staticCanvas = document.createElement('canvas');\r\n    this.dynamicCanvas = document.createElement('canvas');\r\n    for (const c of [this.staticCanvas, this.dynamicCanvas]) {\r\n      c.style.position = 'absolute';\r\n      c.style.top = '0';\r\n      c.style.left = '0';\r\n      container.appendChild(c);\r\n    }\r\n    this.sCtx = this.staticCanvas.getContext('2d')!;\r\n    this.dCtx = this.dynamicCanvas.getContext('2d')!;\r\n    this.binCounts = [];\r\n  }\r\n\r\n  updateGrainColors(theme: ClockTheme): void {\r\n    const [r, g, b] = theme.grainRGB;\r\n    this.grainCoreFill = `rgba(${r},${g},${b},${GRAIN_ALPHA})`;\r\n    this.grainGlowFill = `rgba(${r},${g},${b},${GRAIN_GLOW_ALPHA})`;\r\n    this.staticGrainFill = `rgba(${r},${g},${b},${STATIC_GRAIN_ALPHA})`;\r\n  }\r\n\r\n  applyLayout(L: Layout, totalParticles: number): void {\r\n    const w = L.width;\r\n    const h = L.height;\r\n    const dpr = L.dpr;\r\n\r\n    for (const c of [this.staticCanvas, this.dynamicCanvas]) {\r\n      c.width = w * dpr;\r\n      c.height = h * dpr;\r\n      c.style.width = w + 'px';\r\n      c.style.height = h + 'px';\r\n    }\r\n    this.sCtx.setTransform(dpr, 0, 0, dpr, 0, 0);\r\n    this.dCtx.setTransform(dpr, 0, 0, dpr, 0, 0);\r\n\r\n    this.binCounts = new Array(L.numRows + 1).fill(0);\r\n    this.sCtx.clearRect(0, 0, w, h);\r\n\r\n    this.hopperGrainCache = computeHopperGrains(L, totalParticles, L.miniGrainR);\r\n\r\n    // Find actual top of grain pile (min Y in cache)\r\n    let minY = L.hopperBottom;\r\n    for (const g of this.hopperGrainCache) {\r\n      if (g.y < minY) minY = g.y;\r\n    }\r\n    this.hopperGrainTopY = minY;\r\n  }\r\n\r\n  getBinCounts(): number[] {\r\n    return this.binCounts;\r\n  }\r\n\r\n  // \u2500\u2500 Baking \u2014 grain with slot-width X jitter \u2500\u2500\r\n\r\n  bakeParticle(L: Layout, p: Particle): void {\r\n    const bin = p.bin;\r\n    this.binCounts[bin]++;\r\n    const count = this.binCounts[bin];\r\n\r\n    const binX = pegX(L, L.numRows - 1, bin);\r\n    const mr = L.miniGrainR;\r\n    const d = mr * 2.1;\r\n    const rowH = L.stackRowH;\r\n    const maxJitterX = Math.min(4, mr * 2.5);\r\n    const maxJitterY = rowH * 0.18;\r\n    const hexOff = (count % 2 === 0) ? d * 0.5 : 0;\r\n    const jx = stackJitterX(bin, count, maxJitterX);\r\n    const jy = stackJitterY(bin, count, maxJitterY);\r\n    const grainX = binX + hexOff + jx;\r\n    const grainY = L.accBottom - (count - 0.5) * rowH + jy;\r\n\r\n    const ctx = this.sCtx;\r\n    ctx.fillStyle = this.staticGrainFill;\r\n    ctx.beginPath();\r\n    ctx.arc(grainX, grainY, mr, 0, PI2);\r\n    ctx.fill();\r\n  }\r\n\r\n  /** Rebake all settled grains with current grain color. */\r\n  rebakeStatic(L: Layout, _theme: ClockTheme): void {\r\n    if (!L) return;\r\n    this.sCtx.clearRect(0, 0, L.width, L.height);\r\n    const mr = L.miniGrainR;\r\n    const d = mr * 2.1;\r\n    const rowH = L.stackRowH;\r\n    const maxJitterX = Math.min(4, mr * 2.5);\r\n    const maxJitterY = rowH * 0.18;\r\n\r\n    this.sCtx.fillStyle = this.staticGrainFill;\r\n\r\n    // Opaque grain circles only \u2014 no column fills\r\n    this.sCtx.beginPath();\r\n    for (let bin = 0; bin <= L.numRows; bin++) {\r\n      const binX = pegX(L, L.numRows - 1, bin);\r\n      for (let k = 1; k <= this.binCounts[bin]; k++) {\r\n        const hexOff = (k % 2 === 0) ? d * 0.5 : 0;\r\n        const jx = stackJitterX(bin, k, maxJitterX);\r\n        const jy = stackJitterY(bin, k, maxJitterY);\r\n        const gx = binX + hexOff + jx;\r\n        const gy = L.accBottom - (k - 0.5) * rowH + jy;\r\n        this.sCtx.moveTo(gx + mr, gy);\r\n        this.sCtx.arc(gx, gy, mr, 0, PI2);\r\n      }\r\n    }\r\n    this.sCtx.fill();\r\n  }\r\n\r\n  drawHopper(\r\n    ctx: CanvasRenderingContext2D,\r\n    L: Layout,\r\n    emitted: number,\r\n    total: number,\r\n  ): void {\r\n    const cx = L.centerX;\r\n\r\n    ctx.save();\r\n    ctx.globalAlpha = this.hopperFadeAlpha;\r\n\r\n    // \u2500\u2500 Funnel outline (Gaussian curve) \u2500\u2500\r\n    const visTop = Math.max(0, L.hopperTop);\r\n    ctx.strokeStyle = 'rgba(255,255,255,0.08)';\r\n    ctx.lineWidth = 0.5;\r\n    const nSamples = 40;\r\n    ctx.beginPath();\r\n    // Right edge top\u2192bottom\r\n    for (let i = 0; i <= nSamples; i++) {\r\n      const y = visTop + (L.hopperBottom - visTop) * (i / nSamples);\r\n      const hw = gaussianHW(y, L);\r\n      if (i === 0) ctx.moveTo(cx + hw, y);\r\n      else ctx.lineTo(cx + hw, y);\r\n    }\r\n    // Left edge bottom\u2192top\r\n    for (let i = nSamples; i >= 0; i--) {\r\n      const y = visTop + (L.hopperBottom - visTop) * (i / nSamples);\r\n      const hw = gaussianHW(y, L);\r\n      ctx.lineTo(cx - hw, y);\r\n    }\r\n    ctx.closePath();\r\n    ctx.stroke();\r\n\r\n    // \u2500\u2500 Grain fill: bowl-shaped surface clipping \u2500\u2500\r\n    // Center sinks early (concave curve), edges follow later (convex curve).\r\n    // The bowl shape is maintained throughout, shrinking as sand depletes.\r\n    const remaining = Math.max(0, total - emitted);\r\n    const cacheLen = this.hopperGrainCache.length;\r\n\r\n    if (remaining > 0 && cacheLen > 0) {\r\n      const r = L.miniGrainR;\r\n      const ratio = remaining / total;  // 1.0 = full, 0.0 = empty\r\n      const progress = 1 - ratio;       // 0.0 = full, 1.0 = empty\r\n\r\n      // Use actual grain pile top, not hopperTop (grains may not reach hopper ceiling)\r\n      const grainTop = this.hopperGrainTopY;\r\n      const grainH = L.hopperBottom - grainTop;\r\n      const topHW = L.hopperTopHW;\r\n\r\n      // Volumetric correction: cone-shaped container holds most volume at the top.\r\n      // Removing fraction `progress` of grains lowers fill height by 1-(1-p)^(1/3).\r\n      const volP = 1 - Math.pow(1 - progress, 1 / 3);\r\n\r\n      // Center drops with volumetric height, edges follow with delay\r\n      const centerDrop = volP * grainH * 1.1;\r\n      const edgeDrop = Math.pow(volP, 2.0) * grainH * 1.1;\r\n      // Bowl depth = difference between center and edge drop\r\n      const bowlDepth = centerDrop - edgeDrop;\r\n\r\n      // Surface noise amplitude: roughens the boundary for a granular look.\r\n      // Scales with grain radius so it's subtle but visible.\r\n      const noiseAmp = r * 3.5;\r\n\r\n      // Glow pass (batched)\r\n      ctx.fillStyle = this.grainGlowFill;\r\n      ctx.beginPath();\r\n      for (let i = 0; i < cacheLen; i++) {\r\n        const g = this.hopperGrainCache[i];\r\n        if (g.y < -r * 3) continue;\r\n        // Use local half-width so the bowl curve is visible at every row\r\n        const localHW = gaussianHW(g.y, L);\r\n        const off = Math.min(1, Math.abs(g.x - cx) / localHW);\r\n        // Deterministic per-grain noise (hash-based, no flicker)\r\n        const noise = (((i * 2654435761) >>> 0) % 10000 / 10000 - 0.5) * noiseAmp;\r\n        const surfaceY = grainTop + edgeDrop + bowlDepth * (1 - off * off) + noise;\r\n        if (g.y < surfaceY) continue;\r\n        ctx.moveTo(g.x + r * GRAIN_GLOW_SCALE, g.y);\r\n        ctx.arc(g.x, g.y, r * GRAIN_GLOW_SCALE, 0, PI2);\r\n      }\r\n      ctx.fill();\r\n\r\n      // Core pass (batched)\r\n      ctx.fillStyle = this.grainCoreFill;\r\n      ctx.beginPath();\r\n      for (let i = 0; i < cacheLen; i++) {\r\n        const g = this.hopperGrainCache[i];\r\n        if (g.y < -r) continue;\r\n        const localHW = gaussianHW(g.y, L);\r\n        const off = Math.min(1, Math.abs(g.x - cx) / localHW);\r\n        const noise = (((i * 2654435761) >>> 0) % 10000 / 10000 - 0.5) * noiseAmp;\r\n        const surfaceY = grainTop + edgeDrop + bowlDepth * (1 - off * off) + noise;\r\n        if (g.y < surfaceY) continue;\r\n        ctx.moveTo(g.x + r, g.y);\r\n        ctx.arc(g.x, g.y, r, 0, PI2);\r\n      }\r\n      ctx.fill();\r\n    }\r\n\r\n    // \u2500\u2500 Nozzle stream \u2500\u2500\r\n    if (remaining > 0) {\r\n      const now = performance.now();\r\n      const r = L.miniGrainR;\r\n      // Fewer stream dots when only a few grains remain\r\n      const streamCount = remaining < 10 ? Math.max(1, Math.ceil(remaining / 3)) : 4;\r\n      for (let i = 0; i < streamCount; i++) {\r\n        const phase = ((now * 0.003 + i * 0.25) % 1);\r\n        const sy = L.hopperBottom + (L.emitY - L.hopperBottom) * phase;\r\n        ctx.globalAlpha = 0.4 * (1 - phase * 0.8);\r\n        ctx.fillStyle = this.grainCoreFill;\r\n        ctx.beginPath();\r\n        ctx.arc(cx, sy, r * 0.7, 0, PI2);\r\n        ctx.fill();\r\n      }\r\n    }\r\n\r\n    ctx.restore();\r\n  }\r\n\r\n  drawPegs(ctx: CanvasRenderingContext2D, L: Layout, theme: ClockTheme, pegAlphaOverride?: number): void {\r\n    const [pr, pg, pb] = theme.segmentRGB;\r\n    const alpha = pegAlphaOverride !== undefined ? pegAlphaOverride : 0.15;\r\n    // Blend theme color with gray(180). When alpha is high (alarm flash), use more theme color.\r\n    const themeWeight = (pegAlphaOverride !== undefined && pegAlphaOverride > 0.5) ? 0.6 : 0.3;\r\n    const grayWeight = 1 - themeWeight;\r\n    const blendR = Math.round(pr * themeWeight + 180 * grayWeight);\r\n    const blendG = Math.round(pg * themeWeight + 180 * grayWeight);\r\n    const blendB = Math.round(pb * themeWeight + 180 * grayWeight);\r\n    ctx.fillStyle = `rgba(${blendR},${blendG},${blendB},${alpha.toFixed(3)})`;\r\n    ctx.beginPath();\r\n    for (let row = 0; row < L.numRows; row++) {\r\n      for (let j = 0; j <= row; j++) {\r\n        const x = pegX(L, row, j);\r\n        const y = pegY(L, row);\r\n        ctx.moveTo(x + L.pegRadius, y);\r\n        ctx.arc(x, y, L.pegRadius, 0, PI2);\r\n      }\r\n    }\r\n    ctx.fill();\r\n  }\r\n\r\n  drawParticles(\r\n    ctx: CanvasRenderingContext2D,\r\n    L: Layout,\r\n    particles: Particle[],\r\n  ): void {\r\n    if (particles.length === 0) return;\r\n    const r = L.grainRadius;\r\n\r\n    ctx.fillStyle = this.grainGlowFill;\r\n    ctx.beginPath();\r\n    for (const p of particles) {\r\n      ctx.moveTo(p.x + r * GRAIN_GLOW_SCALE, p.y);\r\n      ctx.arc(p.x, p.y, r * GRAIN_GLOW_SCALE, 0, PI2);\r\n    }\r\n    ctx.fill();\r\n\r\n    ctx.fillStyle = this.grainCoreFill;\r\n    ctx.beginPath();\r\n    for (const p of particles) {\r\n      ctx.moveTo(p.x + r, p.y);\r\n      ctx.arc(p.x, p.y, r, 0, PI2);\r\n    }\r\n    ctx.fill();\r\n  }\r\n\r\n  drawRainParticles(\r\n    ctx: CanvasRenderingContext2D,\r\n    L: Layout,\r\n    rain: { x: number; y: number; alpha: number }[],\r\n    theme: ClockTheme,\r\n  ): void {\r\n    const r = L.miniGrainR;\r\n    const [gr, gg, gb] = theme.grainRGB;\r\n    for (const p of rain) {\r\n      ctx.globalAlpha = p.alpha * (GRAIN_GLOW_ALPHA / GRAIN_ALPHA);\r\n      ctx.fillStyle = `rgb(${gr},${gg},${gb})`;\r\n      ctx.beginPath();\r\n      ctx.arc(p.x, p.y, r * GRAIN_GLOW_SCALE, 0, PI2);\r\n      ctx.fill();\r\n\r\n      ctx.globalAlpha = p.alpha;\r\n      ctx.beginPath();\r\n      ctx.arc(p.x, p.y, r, 0, PI2);\r\n      ctx.fill();\r\n    }\r\n    ctx.globalAlpha = 1;\r\n  }\r\n\r\n  // \u2500\u2500 Purge drain animation \u2500\u2500\r\n\r\n  beginPurge(L: Layout): void {\r\n    const numBins = L.numRows + 1;\r\n    this.purgeOffsets = new Array(numBins).fill(0);\r\n    this.purgeVelocities = new Array(numBins).fill(0);\r\n    this.purgeDelays = [];\r\n    this.purgeAlphas = new Array(numBins).fill(1);\r\n    for (let i = 0; i < numBins; i++) {\r\n      const hash = ((i * 2654435761) >>> 0) & 0x7fffffff;\r\n      this.purgeDelays.push((hash % 1000) / 1000 * 0.2);\r\n    }\r\n    this.purging = true;\r\n  }\r\n\r\n  /**\r\n   * Drain animation: each bin's grains fall with gravity.\r\n   * Returns true when fully drained.\r\n   */\r\n  purgeStacks(L: Layout, dt: number, theme: ClockTheme): boolean {\r\n    this.sCtx.clearRect(0, 0, L.width, L.height);\r\n\r\n    if (!this.purging) {\r\n      this.binCounts.fill(0);\r\n      return true;\r\n    }\r\n\r\n    const mr = L.miniGrainR;\r\n    const d = mr * 2.1;\r\n    const rowH = L.stackRowH;\r\n    const maxJitterX = Math.min(4, mr * 2.5);\r\n    const maxJitterY = rowH * 0.18;\r\n    const gravity = 1500;\r\n    let allDone = true;\r\n\r\n    // Update physics per-bin\r\n    for (let bin = 0; bin <= L.numRows; bin++) {\r\n      if (this.binCounts[bin] === 0) continue;\r\n      if (this.purgeDelays[bin] > 0) {\r\n        this.purgeDelays[bin] -= dt;\r\n        allDone = false;\r\n        continue;\r\n      }\r\n      this.purgeVelocities[bin] += gravity * dt;\r\n      this.purgeOffsets[bin] += this.purgeVelocities[bin] * dt;\r\n      this.purgeAlphas[bin] = Math.max(0, 1 - this.purgeOffsets[bin] / (L.height * 0.6));\r\n      if (this.purgeAlphas[bin] > 0) {\r\n        allDone = false;\r\n      }\r\n    }\r\n\r\n    if (allDone) {\r\n      this.binCounts.fill(0);\r\n      this.purging = false;\r\n      return true;\r\n    }\r\n\r\n    // Draw falling grains\r\n    const [gr, gg, gb] = theme.grainRGB;\r\n    // Glow pass\r\n    this.sCtx.beginPath();\r\n    let anyGlow = false;\r\n    for (let bin = 0; bin <= L.numRows; bin++) {\r\n      const alpha = this.purgeAlphas[bin];\r\n      if (alpha <= 0 || this.binCounts[bin] === 0) continue;\r\n      const offset = this.purgeOffsets[bin];\r\n      const binX = pegX(L, L.numRows - 1, bin);\r\n      for (let k = 0; k < this.binCounts[bin]; k++) {\r\n        const kk = k + 1;\r\n        const hexOff = (kk % 2 === 0) ? d * 0.5 : 0;\r\n        const jx = stackJitterX(bin, kk, maxJitterX);\r\n        const jy = stackJitterY(bin, kk, maxJitterY);\r\n        const gx = binX + hexOff + jx;\r\n        const gy = L.accBottom - (k + 0.5) * rowH + jy + offset;\r\n        if (gy > L.height + mr * 3) continue;\r\n        if (!anyGlow) {\r\n          anyGlow = true;\r\n        }\r\n        this.sCtx.moveTo(gx + mr * GRAIN_GLOW_SCALE, gy);\r\n        this.sCtx.arc(gx, gy, mr * GRAIN_GLOW_SCALE, 0, PI2);\r\n      }\r\n    }\r\n    if (anyGlow) {\r\n      this.sCtx.fillStyle = `rgba(${gr},${gg},${gb},${GRAIN_GLOW_ALPHA})`;\r\n      this.sCtx.fill();\r\n    }\r\n\r\n    // Core pass \u2014 need per-bin alpha, so draw per-bin\r\n    for (let bin = 0; bin <= L.numRows; bin++) {\r\n      const alpha = this.purgeAlphas[bin];\r\n      if (alpha <= 0 || this.binCounts[bin] === 0) continue;\r\n      const offset = this.purgeOffsets[bin];\r\n      const binX = pegX(L, L.numRows - 1, bin);\r\n      this.sCtx.fillStyle = `rgba(${gr},${gg},${gb},${(GRAIN_ALPHA * alpha).toFixed(3)})`;\r\n      this.sCtx.beginPath();\r\n      for (let k = 0; k < this.binCounts[bin]; k++) {\r\n        const kk = k + 1;\r\n        const hexOff = (kk % 2 === 0) ? d * 0.5 : 0;\r\n        const jx = stackJitterX(bin, kk, maxJitterX);\r\n        const jy = stackJitterY(bin, kk, maxJitterY);\r\n        const gx = binX + hexOff + jx;\r\n        const gy = L.accBottom - (k + 0.5) * rowH + jy + offset;\r\n        if (gy > L.height + mr) continue;\r\n        this.sCtx.moveTo(gx + mr, gy);\r\n        this.sCtx.arc(gx, gy, mr, 0, PI2);\r\n      }\r\n      this.sCtx.fill();\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  clearStatic(L: Layout): void {\r\n    this.binCounts.fill(0);\r\n    this.sCtx.clearRect(0, 0, L.width, L.height);\r\n    this.purging = false;\r\n  }\r\n\r\n  // \u2500\u2500 Hopper fade helpers \u2500\u2500\r\n\r\n  beginHopperFade(): void {\r\n    this.hopperFadeAlpha = 1;\r\n  }\r\n\r\n  setHopperFadeAlpha(a: number): void {\r\n    this.hopperFadeAlpha = a;\r\n  }\r\n\r\n  resetHopperFade(): void {\r\n    this.hopperFadeAlpha = 1;\r\n  }\r\n\r\n  /** Fill stacks with binomial distribution (for stop\u2192idle). */\r\n  fillStacks(L: Layout, numRows: number, totalParticles: number, theme: ClockTheme): void {\r\n    // Compute binomial expected counts: C(n,k) / 2^n * total\r\n    const n = numRows;\r\n    const numBins = n + 1;\r\n    this.binCounts = new Array(numBins).fill(0);\r\n\r\n    // Use log-space to avoid overflow for large n\r\n    // ln(C(n,k)) = ln(n!) - ln(k!) - ln((n-k)!)\r\n    const lnFact: number[] = new Array(n + 1);\r\n    lnFact[0] = 0;\r\n    for (let i = 1; i <= n; i++) {\r\n      lnFact[i] = lnFact[i - 1] + Math.log(i);\r\n    }\r\n\r\n    let placed = 0;\r\n    const probs: number[] = new Array(numBins);\r\n    for (let k = 0; k < numBins; k++) {\r\n      probs[k] = Math.exp(lnFact[n] - lnFact[k] - lnFact[n - k] - n * Math.LN2);\r\n    }\r\n\r\n    // Distribute particles proportionally\r\n    for (let k = 0; k < numBins; k++) {\r\n      this.binCounts[k] = Math.round(probs[k] * totalParticles);\r\n      placed += this.binCounts[k];\r\n    }\r\n    // Fix rounding errors by adjusting the center bin\r\n    const centerBin = Math.floor(numBins / 2);\r\n    this.binCounts[centerBin] += totalParticles - placed;\r\n\r\n    this.rebakeStatic(L, theme);\r\n  }\r\n\r\n  /** Ground height based on nearest bin's grain count. */\r\n  getGroundY(L: Layout, x: number): number {\r\n    const numBins = L.numRows + 1;\r\n    let nearestBin = 0;\r\n    let minDist = Infinity;\r\n    for (let b = 0; b < numBins; b++) {\r\n      const bx = pegX(L, L.numRows - 1, b);\r\n      const dist = Math.abs(x - bx);\r\n      if (dist < minDist) {\r\n        minDist = dist;\r\n        nearestBin = b;\r\n      }\r\n    }\r\n    return L.accBottom - this.binCounts[nearestBin] * L.stackRowH;\r\n  }\r\n}\r\n", "/**\n * AppRenderer \u2014 slim orchestrator.\n * Delegates grain/canvas ops to GrainRenderer, keeps frame pipeline + UI drawing.\n */\n\nimport type { Particle, BoardGeom } from './simulation';\nimport { drawClock, getThemeByName, CLOCK_THEMES } from './seven-seg';\nimport type { ClockTheme } from './seven-seg';\nimport { computeLayout, pegX, pegY } from './layout';\nimport type { Layout } from './layout';\nimport { GrainRenderer } from './grain-renderer';\n\nexport class Renderer {\n  layout!: Layout;\n  private gr: GrainRenderer;\n  private totalParticles: number;\n\n  // \u2500\u2500 Theme & clock \u2500\u2500\n  clockEnabled = true;\n  private currentTheme: ClockTheme = CLOCK_THEMES[0];\n\n  // \u2500\u2500 Alarm \u2500\u2500\n  alarmActive = false;\n  private alarmFlashStart = 0;\n  private alarmHighlight = false;\n\n  constructor(\n    container: HTMLElement,\n    numRows: number,\n    totalParticles: number,\n    _seed: number,\n  ) {\n    this.totalParticles = totalParticles;\n    this.gr = new GrainRenderer(container);\n    this.gr.updateGrainColors(this.currentTheme);\n    this.resize(numRows);\n  }\n\n  setClockEnabled(v: boolean): void {\n    this.clockEnabled = v;\n  }\n\n  setTheme(theme: ClockTheme): void {\n    this.currentTheme = theme;\n    this.gr.updateGrainColors(theme);\n    // Set background tint from theme\n    const [r, g, b] = theme.segmentRGB;\n    document.documentElement.style.setProperty('--bg',\n      `rgb(${Math.round(r * 0.02)},${Math.round(g * 0.02)},${Math.round(b * 0.02)})`);\n    // Rebake static canvas with new grain color\n    this.gr.rebakeStatic(this.layout, theme);\n  }\n\n  setThemeByName(name: string): void {\n    this.setTheme(getThemeByName(name));\n  }\n\n  setGlowIntensity(v: number): void {\n    this.currentTheme = { ...this.currentTheme, glowIntensity: v };\n  }\n\n  getTheme(): ClockTheme {\n    return this.currentTheme;\n  }\n\n  resize(numRows: number, totalParticles?: number): void {\n    if (totalParticles !== undefined) this.totalParticles = totalParticles;\n    const dpr = window.devicePixelRatio || 1;\n    const w = window.innerWidth;\n    const h = window.innerHeight;\n\n    this.layout = computeLayout(w, h, dpr, numRows, this.totalParticles);\n    this.gr.applyLayout(this.layout, this.totalParticles);\n  }\n\n  // \u2500\u2500 Geometry for simulation \u2500\u2500\n\n  pegX(row: number, index: number): number {\n    return pegX(this.layout, row, index);\n  }\n\n  pegY(row: number): number {\n    return pegY(this.layout, row);\n  }\n\n  getGeom(): BoardGeom {\n    return {\n      emitX: this.layout.centerX,\n      emitY: this.layout.emitY,\n      pegX: (r, i) => this.pegX(r, i),\n      pegY: (r) => this.pegY(r),\n      pegSpacing: this.layout.pegSpacing,\n      numRows: this.layout.numRows,\n      accBottom: this.layout.accBottom,\n    };\n  }\n\n  /** Ground height based on nearest bin's grain count. */\n  getGroundY(x: number): number {\n    return this.gr.getGroundY(this.layout, x);\n  }\n\n  // \u2500\u2500 Baking \u2500\u2500\n\n  bakeParticle(p: Particle): void {\n    this.gr.bakeParticle(this.layout, p);\n  }\n\n  // \u2500\u2500 Frame drawing \u2500\u2500\n\n  drawFrame(\n    particles: Particle[],\n    remainingSec: number,\n    totalParticles: number,\n    emittedCount: number,\n    _paused: boolean,\n    totalMs?: number,\n    rain?: { x: number; y: number; alpha: number }[],\n    centiseconds?: number,\n    wallClockSec?: number,\n  ): void {\n    const L = this.layout;\n    const ctx = this.gr.dCtx;\n    ctx.clearRect(0, 0, L.width, L.height);\n\n    if (totalMs !== undefined && totalMs > 0) {\n      this.drawProgressBar(ctx, remainingSec * 1000, totalMs);\n    }\n\n    if (this.clockEnabled) {\n      if (wallClockSec !== undefined) {\n        this.drawSevenSegClock(ctx, wallClockSec, undefined, true);\n      } else {\n        this.drawSevenSegClock(ctx, remainingSec, centiseconds);\n      }\n    }\n    if (wallClockSec !== undefined) {\n      this.drawInlineTimer(ctx, wallClockSec, undefined, true);\n    } else {\n      this.drawInlineTimer(ctx, remainingSec, centiseconds);\n    }\n    this.gr.drawHopper(ctx, L, emittedCount, totalParticles);\n\n    // Alarm pin flash\n    let pegAlpha: number | undefined;\n    if (this.alarmActive) {\n      const elapsed = performance.now() - this.alarmFlashStart;\n      const flashDuration = 200;\n      const totalFlashes = 10;\n      const flashIndex = elapsed / flashDuration;\n      if (flashIndex < totalFlashes) {\n        const phase = flashIndex % 1;\n        const wave = Math.sin(phase * Math.PI);\n        pegAlpha = 0.15 + 0.70 * wave;\n      } else {\n        pegAlpha = 0.55;\n        this.alarmHighlight = true;\n      }\n    }\n\n    this.gr.drawPegs(ctx, L, this.currentTheme, pegAlpha);\n    this.gr.drawParticles(ctx, L, particles);\n    if (rain && rain.length > 0) {\n      this.gr.drawRainParticles(ctx, L, rain, this.currentTheme);\n    }\n  }\n\n  private drawProgressBar(ctx: CanvasRenderingContext2D, remainingMs: number, totalMs: number): void {\n    const progress = Math.max(0, Math.min(1, 1 - remainingMs / totalMs));\n    const [r, g, b] = this.currentTheme.segmentRGB;\n    ctx.fillStyle = `rgba(${r},${g},${b},0.60)`;\n    ctx.fillRect(0, 0, this.layout.width * progress, 2);\n  }\n\n  private drawSevenSegClock(ctx: CanvasRenderingContext2D, sec: number, centiseconds?: number, showHours?: boolean): void {\n    const L = this.layout;\n    const digitH = Math.min(L.width * 0.22, L.height * 0.25);\n    drawClock(ctx, Math.floor(sec), L.centerX, L.height / 2, digitH, this.currentTheme, centiseconds, showHours);\n  }\n\n  private drawInlineTimer(ctx: CanvasRenderingContext2D, sec: number, centiseconds?: number, showHours?: boolean): void {\n    if (sec <= 0) return;\n    const L = this.layout;\n    const digitH = L.height * 0.04;\n    drawClock(ctx, Math.floor(sec), L.centerX, L.inlineTimerY, digitH, this.currentTheme, centiseconds, showHours);\n  }\n\n  // \u2500\u2500 Rain particles (refill \u2014 identical grain rendering) \u2500\u2500\n\n  drawRainParticles(ctx: CanvasRenderingContext2D, rainParticles: { x: number; y: number; alpha: number }[]): void {\n    this.gr.drawRainParticles(ctx, this.layout, rainParticles, this.currentTheme);\n  }\n\n  // \u2500\u2500 Purge \u2500\u2500\n\n  beginPurge(): void {\n    this.gr.beginPurge(this.layout);\n  }\n\n  purgeStacks(dt: number): boolean {\n    return this.gr.purgeStacks(this.layout, dt, this.currentTheme);\n  }\n\n  // \u2500\u2500 Hopper fade \u2500\u2500\n\n  beginHopperFade(): void {\n    this.gr.beginHopperFade();\n  }\n\n  setHopperFadeAlpha(a: number): void {\n    this.gr.setHopperFadeAlpha(a);\n  }\n\n  resetHopperFade(): void {\n    this.gr.resetHopperFade();\n  }\n\n  fillStacks(numRows: number, totalParticles: number): void {\n    this.gr.fillStacks(this.layout, numRows, totalParticles, this.currentTheme);\n  }\n\n  // \u2500\u2500 Alarm \u2500\u2500\n\n  startAlarm(): void {\n    this.alarmActive = true;\n    this.alarmFlashStart = performance.now();\n    this.alarmHighlight = false;\n  }\n\n  stopAlarm(): void {\n    this.alarmActive = false;\n    this.alarmHighlight = false;\n  }\n\n  isAlarmFlashDone(): boolean {\n    if (!this.alarmActive) return true;\n    return this.alarmHighlight;\n  }\n\n  /** Clear baked grains and reset all state. */\n  clearStatic(): void {\n    this.gr.clearStatic(this.layout);\n  }\n}\n\nexport { CLOCK_THEMES, getThemeByName };\nexport type { ClockTheme, Layout };\n", "/**\n * Timer Bridge \u2014 wraps the Web Worker timer for main-thread use.\n */\n\nexport class TimerBridge {\n  private worker: Worker;\n  onTick: ((remainingMs: number, elapsedMs: number) => void) | null = null;\n  onDone: (() => void) | null = null;\n\n  constructor() {\n    this.worker = new Worker('dist/timer-worker.js');\n    this.worker.onmessage = (e: MessageEvent) => {\n      const msg = e.data;\n      if (msg.type === 'TICK') {\n        this.onTick?.(msg.remainingMs, msg.elapsedMs);\n      } else if (msg.type === 'DONE') {\n        this.onDone?.();\n      }\n    };\n  }\n\n  start(totalMs: number): void {\n    this.worker.postMessage({\n      type: 'START',\n      totalMs,\n      startAbsMs: performance.now(),\n    });\n  }\n\n  addTime(addMs: number): void {\n    this.worker.postMessage({ type: 'ADD_TIME', addMs });\n  }\n\n  pause(): void {\n    this.worker.postMessage({ type: 'PAUSE' });\n  }\n\n  resume(): void {\n    this.worker.postMessage({\n      type: 'RESUME',\n      resumeAbsMs: performance.now(),\n    });\n  }\n\n  reset(): void {\n    this.worker.postMessage({ type: 'RESET' });\n  }\n}\n", "/**\r\n * Control Console \u2014 Tipsy Tap Studio Pro Edition.\r\n *\r\n * Refined instrument panel: glassmorphism drawer, digital-gauge aesthetics,\r\n * generous breathing room. Minimal on-screen controls auto-hide after 5s.\r\n */\r\n\r\nimport { PRESETS, PHYSICS, PhysicsParams } from '../engine/simulation';\r\nimport { CLOCK_THEMES } from '../engine/seven-seg';\r\nimport type { AppMode } from '../utils/url-params';\r\n\r\n// \u2500\u2500 Types \u2500\u2500\r\n\r\nexport type SignalStatus = 'ready' | 'running' | 'ending' | 'idle' | 'alarm';\r\n\r\nexport interface ConsoleController {\r\n  el: HTMLElement;\r\n  show(): void;\r\n  hide(): void;\r\n  setTime(remainingMs: number): void;\r\n  setStatus(status: SignalStatus): void;\r\n  onModeChange: ((mode: string) => void) | null;\r\n  onPause: (() => void) | null;\r\n  onStart: (() => void) | null;\r\n  onStop: (() => void) | null;\r\n  onThemeChange: ((themeName: string) => void) | null;\r\n  onDurationChange: ((sec: number) => void) | null;\r\n  onParticlesChange: ((n: number) => void) | null;\r\n  onRowsChange: ((rows: number) => void) | null;\r\n  onCentisecondsToggle: ((enabled: boolean) => void) | null;\r\n  onResetDefaults: (() => void) | null;\r\n  onShareURL: (() => void) | null;\r\n  onAppModeChange: ((mode: AppMode) => void) | null;\r\n  onGravityChange: ((value: number) => void) | null;\r\n  onBouncinessChange: ((value: number) => void) | null;\r\n  onFrictionChange: ((value: number) => void) | null;\r\n  setPaused(paused: boolean): void;\r\n  setThemeName(name: string): void;\r\n  setAccentColor(rgb: [number, number, number]): void;\r\n  setConfigEnabled(enabled: boolean): void;\r\n  setDuration(sec: number): void;\r\n  setParticles(n: number): void;\r\n  setRows(rows: number): void;\r\n  setSeed(seed: number): void;\r\n  closeDrawer(): void;\r\n}\r\n\r\n// \u2500\u2500 Styles \u2500\u2500\r\n\r\nfunction injectStyles(): void {\r\n  if (document.getElementById('gt-console-style')) return;\r\n  const style = document.createElement('style');\r\n  style.id = 'gt-console-style';\r\n  style.textContent = `\r\n    /* \u2500\u2500 On-screen controls \u2500\u2500 */\r\n    .gt-controls {\r\n      position: fixed;\r\n      bottom: 28px;\r\n      left: 50%;\r\n      transform: translateX(-50%);\r\n      z-index: 1000;\r\n      display: flex;\r\n      gap: 20px;\r\n      align-items: center;\r\n      user-select: none;\r\n      transition: opacity 0.4s ease;\r\n    }\r\n    .gt-controls.hidden {\r\n      opacity: 0;\r\n      pointer-events: none;\r\n    }\r\n    .gt-ctrl-btn {\r\n      width: 36px;\r\n      height: 36px;\r\n      border-radius: 50%;\r\n      border: 1.5px solid rgba(255,255,255,0.12);\r\n      background: transparent;\r\n      color: rgba(255,255,255,0.45);\r\n      font-size: 14px;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      cursor: pointer;\r\n      transition: background 0.2s, color 0.2s, border-color 0.2s;\r\n      padding: 0;\r\n      line-height: 1;\r\n    }\r\n    .gt-ctrl-btn:hover {\r\n      background: rgba(255,255,255,0.04);\r\n      color: rgba(255,255,255,0.80);\r\n      border-color: rgba(255,255,255,0.25);\r\n    }\r\n    .gt-ctrl-btn:active {\r\n      background: rgba(255,255,255,0.14);\r\n    }\r\n    .gt-ctrl-btn svg {\r\n      width: 18px;\r\n      height: 18px;\r\n      fill: currentColor;\r\n    }\r\n\r\n    /* \u2500\u2500 Side Drawer (Glassmorphism) \u2500\u2500 */\r\n    .gt-drawer-overlay {\r\n      position: fixed;\r\n      inset: 0;\r\n      z-index: 600;\r\n      background: rgba(0,0,0,0.35);\r\n      opacity: 0;\r\n      pointer-events: none;\r\n      transition: opacity 0.3s ease;\r\n    }\r\n    .gt-drawer-overlay.open {\r\n      opacity: 1;\r\n      pointer-events: auto;\r\n    }\r\n    .gt-drawer {\r\n      position: fixed;\r\n      top: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      width: 300px;\r\n      max-width: 82vw;\r\n      z-index: 601;\r\n      background: rgba(8,8,12,0.72);\r\n      border-left: 1px solid rgba(255,255,255,0.05);\r\n      backdrop-filter: blur(32px) saturate(1.4);\r\n      -webkit-backdrop-filter: blur(32px) saturate(1.4);\r\n      transform: translateX(100%);\r\n      transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);\r\n      display: flex;\r\n      flex-direction: column;\r\n      font-family: 'JetBrains Mono', 'SF Mono', 'Menlo', monospace;\r\n      overflow-y: auto;\r\n      scrollbar-width: thin;\r\n      scrollbar-color: rgba(255,255,255,0.06) transparent;\r\n    }\r\n    .gt-drawer.open {\r\n      transform: translateX(0);\r\n    }\r\n    .gt-drawer-content {\r\n      padding: 40px 28px 32px;\r\n      display: flex;\r\n      flex-direction: column;\r\n      gap: 36px;\r\n    }\r\n\r\n    /* \u2500\u2500 Section headings \u2500\u2500 */\r\n    .gt-section-title {\r\n      font-size: 10px;\r\n      font-weight: 700;\r\n      letter-spacing: 4px;\r\n      text-transform: uppercase;\r\n      color: rgba(255,255,255,0.25);\r\n      margin-bottom: 20px;\r\n      padding-bottom: 8px;\r\n      border-bottom: 1px solid rgba(255,255,255,0.04);\r\n    }\r\n    .gt-section {\r\n      display: flex;\r\n      flex-direction: column;\r\n    }\r\n\r\n    /* \u2500\u2500 Field rows \u2500\u2500 */\r\n    .gt-field-row {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      gap: 12px;\r\n      min-height: 36px;\r\n      margin-bottom: 4px;\r\n    }\r\n    .gt-field-label {\r\n      font-size: 11px;\r\n      font-weight: 400;\r\n      color: rgba(255,255,255,0.40);\r\n      flex-shrink: 0;\r\n      letter-spacing: 0.5px;\r\n    }\r\n    .gt-field-select {\r\n      flex: 1;\r\n      max-width: 150px;\r\n      padding: 6px 10px;\r\n      background: rgba(255,255,255,0.03);\r\n      border: 1px solid rgba(255,255,255,0.06);\r\n      border-radius: 6px;\r\n      color: rgba(255,255,255,0.60);\r\n      font-family: inherit;\r\n      font-size: 11px;\r\n      outline: none;\r\n      cursor: pointer;\r\n      transition: border-color 0.15s;\r\n    }\r\n    .gt-field-select:focus {\r\n      border-color: rgba(255,255,255,0.15);\r\n    }\r\n    .gt-field-select option {\r\n      background: #0c0c0e;\r\n      color: #bbb;\r\n    }\r\n\r\n    /* \u2500\u2500 Theme strip \u2500\u2500 */\r\n    .gt-theme-strip {\r\n      display: flex;\r\n      gap: 0;\r\n      margin-bottom: 4px;\r\n      border-radius: 8px;\r\n      overflow: hidden;\r\n      border: 1px solid rgba(255,255,255,0.05);\r\n    }\r\n    .gt-theme-chip {\r\n      flex: 1;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      gap: 5px;\r\n      padding: 10px 0;\r\n      font-size: 8.5px;\r\n      font-weight: 500;\r\n      letter-spacing: 0.8px;\r\n      text-transform: uppercase;\r\n      font-family: inherit;\r\n      color: rgba(255,255,255,0.30);\r\n      background: rgba(255,255,255,0.02);\r\n      border: none;\r\n      border-right: 1px solid rgba(255,255,255,0.04);\r\n      cursor: pointer;\r\n      transition: all 0.25s;\r\n    }\r\n    .gt-theme-chip:last-child {\r\n      border-right: none;\r\n    }\r\n    .gt-theme-chip .gt-led {\r\n      width: 4px;\r\n      height: 4px;\r\n      border-radius: 50%;\r\n      flex-shrink: 0;\r\n      opacity: 0.45;\r\n      transition: opacity 0.25s, box-shadow 0.25s;\r\n    }\r\n    .gt-theme-chip:hover {\r\n      background: rgba(255,255,255,0.05);\r\n      color: rgba(255,255,255,0.55);\r\n    }\r\n    .gt-theme-chip:hover .gt-led {\r\n      opacity: 0.7;\r\n    }\r\n    .gt-theme-chip.active {\r\n      color: rgba(255,255,255,0.85);\r\n      background: color-mix(in srgb, var(--tc) 6%, transparent);\r\n      box-shadow: inset 0 0 12px color-mix(in srgb, var(--tc) 8%, transparent);\r\n    }\r\n    .gt-theme-chip.active .gt-led {\r\n      opacity: 1;\r\n      box-shadow: 0 0 4px var(--tc), 0 0 8px color-mix(in srgb, var(--tc) 50%, transparent);\r\n    }\r\n\r\n    /* \u2500\u2500 Sliders \u2500\u2500 */\r\n    .gt-slider-row {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 10px;\r\n      min-height: 32px;\r\n      margin-bottom: 4px;\r\n    }\r\n    .gt-slider-label {\r\n      font-size: 10px;\r\n      font-weight: 400;\r\n      color: rgba(255,255,255,0.30);\r\n      width: 52px;\r\n      flex-shrink: 0;\r\n      text-align: right;\r\n      letter-spacing: 0.3px;\r\n    }\r\n    .gt-slider-input {\r\n      -webkit-appearance: none;\r\n      appearance: none;\r\n      flex: 1;\r\n      height: 2px;\r\n      background: rgba(255,255,255,0.08);\r\n      border-radius: 1px;\r\n      outline: none;\r\n      cursor: pointer;\r\n    }\r\n    .gt-slider-input::-webkit-slider-thumb {\r\n      -webkit-appearance: none;\r\n      appearance: none;\r\n      width: 12px;\r\n      height: 12px;\r\n      border-radius: 50%;\r\n      background: rgba(255,255,255,0.40);\r\n      cursor: pointer;\r\n      transition: background 0.15s;\r\n    }\r\n    .gt-slider-input::-webkit-slider-thumb:hover {\r\n      background: rgba(255,255,255,0.65);\r\n    }\r\n    .gt-slider-input::-moz-range-thumb {\r\n      width: 12px;\r\n      height: 12px;\r\n      border-radius: 50%;\r\n      background: rgba(255,255,255,0.40);\r\n      cursor: pointer;\r\n      border: none;\r\n    }\r\n    .gt-slider-val {\r\n      font-size: 10px;\r\n      font-weight: 400;\r\n      color: rgba(255,255,255,0.22);\r\n      width: 38px;\r\n      text-align: left;\r\n      letter-spacing: 0.3px;\r\n    }\r\n\r\n    /* \u2500\u2500 Duration control \u2500\u2500 */\r\n    .gt-dur-row {\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 8px;\r\n      min-height: 36px;\r\n      margin-bottom: 4px;\r\n    }\r\n    .gt-dur-btn {\r\n      width: 30px;\r\n      height: 30px;\r\n      border-radius: 50%;\r\n      border: 1px solid rgba(255,255,255,0.08);\r\n      background: transparent;\r\n      color: rgba(255,255,255,0.35);\r\n      font-size: 16px;\r\n      font-family: inherit;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      cursor: pointer;\r\n      user-select: none;\r\n      flex-shrink: 0;\r\n      transition: all 0.15s;\r\n    }\r\n    .gt-dur-btn:hover {\r\n      background: rgba(255,255,255,0.05);\r\n      color: rgba(255,255,255,0.70);\r\n      border-color: rgba(255,255,255,0.15);\r\n    }\r\n    .gt-dur-btn:active {\r\n      background: rgba(255,255,255,0.10);\r\n    }\r\n    .gt-dur-display {\r\n      width: 56px;\r\n      padding: 0;\r\n      background: transparent;\r\n      border: none;\r\n      color: rgba(255,255,255,0.70);\r\n      font-family: inherit;\r\n      font-size: 14px;\r\n      font-weight: 500;\r\n      letter-spacing: 1.5px;\r\n      outline: none;\r\n      text-align: center;\r\n      flex-shrink: 0;\r\n      caret-color: rgba(255,255,255,0.40);\r\n    }\r\n    .gt-dur-display:focus {\r\n      color: rgba(255,255,255,0.90);\r\n    }\r\n\r\n    /* \u2500\u2500 System buttons \u2500\u2500 */\r\n    .gt-sys-btn {\r\n      width: 100%;\r\n      padding: 10px 0;\r\n      background: rgba(255,255,255,0.02);\r\n      border: 1px solid rgba(255,255,255,0.05);\r\n      border-radius: 8px;\r\n      color: rgba(255,255,255,0.35);\r\n      font-family: inherit;\r\n      font-size: 10px;\r\n      font-weight: 500;\r\n      letter-spacing: 1px;\r\n      text-transform: uppercase;\r\n      cursor: pointer;\r\n      transition: all 0.15s;\r\n      margin-bottom: 8px;\r\n    }\r\n    .gt-sys-btn:hover {\r\n      background: rgba(255,255,255,0.05);\r\n      color: rgba(255,255,255,0.60);\r\n      border-color: rgba(255,255,255,0.10);\r\n    }\r\n    .gt-sys-btn:active {\r\n      background: rgba(255,255,255,0.08);\r\n    }\r\n\r\n    /* \u2500\u2500 Duration preset buttons \u2500\u2500 */\r\n    .gt-preset-row {\r\n      display: flex;\r\n      gap: 6px;\r\n      margin-bottom: 8px;\r\n    }\r\n    .gt-preset-btn {\r\n      flex: 1;\r\n      padding: 6px 0;\r\n      border: 1px solid #555;\r\n      border-radius: 4px;\r\n      background: transparent;\r\n      color: #aaa;\r\n      font-size: 11px;\r\n      font-family: monospace;\r\n      cursor: pointer;\r\n      min-height: 32px;\r\n    }\r\n    .gt-preset-btn:hover { border-color: #888; color: #fff; }\r\n    .gt-preset-btn.active { border-color: currentColor; color: currentColor; background: rgba(255,255,255,0.05); }\r\n    .gt-preset-btn:disabled { opacity: 0.3; cursor: default; }\r\n\r\n    /* \u2500\u2500 Duration disabled hint \u2500\u2500 */\r\n    .gt-dur-hint {\r\n      font-size: 10px;\r\n      color: rgba(255,160,60,0.7);\r\n      letter-spacing: 0.5px;\r\n      margin-left: auto;\r\n      animation: gt-hint-pulse 2s ease-in-out infinite;\r\n    }\r\n    @keyframes gt-hint-pulse {\r\n      0%, 100% { opacity: 0.7; }\r\n      50% { opacity: 1.0; }\r\n    }\r\n\r\n    /* \u2500\u2500 Fixed credits \u2500\u2500 */\r\n    .gt-credits {\r\n      position: fixed;\r\n      bottom: 8px;\r\n      left: 50%;\r\n      transform: translateX(-50%);\r\n      font-size: 9px;\r\n      color: rgba(255,255,255,0.12);\r\n      letter-spacing: 1.5px;\r\n      z-index: 1;\r\n      pointer-events: none;\r\n      font-family: 'JetBrains Mono', 'SF Mono', monospace;\r\n    }\r\n  `;\r\n  document.head.appendChild(style);\r\n}\r\n\r\n// \u2500\u2500 Helpers \u2500\u2500\r\n\r\nfunction fmtMmSs(sec: number): string {\r\n  const m = Math.floor(sec / 60);\r\n  const s = sec % 60;\r\n  return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;\r\n}\r\n\r\nfunction parseMmSs(str: string): number | null {\r\n  const parts = str.split(':');\r\n  if (parts.length === 2) {\r\n    const m = parseInt(parts[0], 10);\r\n    const s = parseInt(parts[1], 10);\r\n    if (Number.isFinite(m) && Number.isFinite(s)) return m * 60 + s;\r\n  }\r\n  const v = parseInt(str, 10);\r\n  return Number.isFinite(v) ? v : null;\r\n}\r\n\r\n// \u2500\u2500 Console creation \u2500\u2500\r\n\r\nexport function createConsole(\r\n  initialMode: string,\r\n  initialTheme = 'Nixie',\r\n  initialDurationSec = 3600,\r\n  initialCs = true,\r\n  initialAppMode: AppMode = 'timer',\r\n  initialFriction = 1.0,\r\n  initialParticles = 3600,\r\n  initialRows = 24,\r\n  initialSeed = 0,\r\n): ConsoleController {\r\n  injectStyles();\r\n\r\n  let isPaused = false;\r\n  let currentDuration = Math.min(initialDurationSec, 3600);\r\n  let currentParticles = Math.max(10, Math.min(3600, initialParticles));\r\n  let currentRows = Math.max(4, Math.min(64, initialRows));\r\n  let currentSeed = initialSeed;\r\n\r\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n  // FIXED CREDITS\r\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n  const creditsEl = document.createElement('div');\r\n  creditsEl.className = 'gt-credits';\r\n  creditsEl.textContent = 'Crafted by Tipsy Tap Studio';\r\n  document.body.appendChild(creditsEl);\r\n\r\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n  // ON-SCREEN CONTROLS\r\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n\r\n  const controls = document.createElement('div');\r\n  controls.className = 'gt-controls';\r\n\r\n  function makeBtn(svg: string, title: string): HTMLButtonElement {\r\n    const btn = document.createElement('button');\r\n    btn.className = 'gt-ctrl-btn';\r\n    btn.innerHTML = svg;\r\n    btn.title = title;\r\n    return btn;\r\n  }\r\n\r\n  const startBtn = makeBtn(\r\n    '<svg viewBox=\"0 0 24 24\"><polygon points=\"6,4 20,12 6,20\"/></svg>',\r\n    'Start',\r\n  );\r\n  const pauseBtn = makeBtn(\r\n    '<svg viewBox=\"0 0 24 24\"><rect x=\"5\" y=\"4\" width=\"4\" height=\"16\"/><rect x=\"15\" y=\"4\" width=\"4\" height=\"16\"/></svg>',\r\n    'Pause',\r\n  );\r\n  const stopBtn = makeBtn(\r\n    '<svg viewBox=\"0 0 24 24\"><rect x=\"5\" y=\"5\" width=\"14\" height=\"14\" rx=\"2\"/></svg>',\r\n    'Stop',\r\n  );\r\n  const settingsBtn = makeBtn(\r\n    '<svg viewBox=\"0 0 24 24\"><path d=\"M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"/><path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"/></svg>',\r\n    'Settings',\r\n  );\r\n\r\n  startBtn.addEventListener('click', () => ctrl.onStart?.());\r\n  pauseBtn.addEventListener('click', () => ctrl.onPause?.());\r\n  stopBtn.addEventListener('click', () => ctrl.onStop?.());\r\n  settingsBtn.addEventListener('click', () => toggleDrawer());\r\n\r\n  controls.appendChild(startBtn);\r\n  controls.appendChild(pauseBtn);\r\n  controls.appendChild(stopBtn);\r\n  controls.appendChild(settingsBtn);\r\n  document.body.appendChild(controls);\r\n\r\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n  // SIDE DRAWER\r\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\r\n\r\n  const overlay = document.createElement('div');\r\n  overlay.className = 'gt-drawer-overlay';\r\n  overlay.addEventListener('click', () => closeDrawer());\r\n\r\n  const drawer = document.createElement('div');\r\n  drawer.className = 'gt-drawer';\r\n\r\n  const drawerContent = document.createElement('div');\r\n  drawerContent.className = 'gt-drawer-content';\r\n\r\n  // \u2500\u2500 TIMER section \u2500\u2500\r\n  const timerSection = document.createElement('div');\r\n  timerSection.className = 'gt-section';\r\n  timerSection.innerHTML = '<div class=\"gt-section-title\">Timer</div>';\r\n\r\n  // App mode\r\n  const appRow = document.createElement('div');\r\n  appRow.className = 'gt-field-row';\r\n  appRow.innerHTML = '<span class=\"gt-field-label\">App</span>';\r\n  const appSelect = document.createElement('select');\r\n  appSelect.className = 'gt-field-select';\r\n  for (const [val, label] of [['timer', 'Timer'], ['clock', 'Clock']] as const) {\r\n    const opt = document.createElement('option');\r\n    opt.value = val;\r\n    opt.textContent = label;\r\n    if (val === initialAppMode) opt.selected = true;\r\n    appSelect.appendChild(opt);\r\n  }\r\n  appSelect.addEventListener('change', () => {\r\n    ctrl.onAppModeChange?.(appSelect.value as AppMode);\r\n    updateClockModeVisibility();\r\n  });\r\n  appRow.appendChild(appSelect);\r\n  timerSection.appendChild(appRow);\r\n\r\n  // Duration (hidden in clock mode)\r\n  const durLabel = document.createElement('div');\r\n  durLabel.className = 'gt-field-row';\r\n  durLabel.innerHTML = '<span class=\"gt-field-label\">Duration</span>';\r\n  durLabel.style.marginBottom = '0';\r\n\r\n  const durRow = document.createElement('div');\r\n  durRow.className = 'gt-dur-row';\r\n\r\n  const durMinusBtn = document.createElement('button');\r\n  durMinusBtn.className = 'gt-dur-btn';\r\n  durMinusBtn.textContent = '\\u2212';\r\n\r\n  const durSlider = document.createElement('input');\r\n  durSlider.type = 'range';\r\n  durSlider.className = 'gt-slider-input';\r\n  durSlider.min = '1';\r\n  durSlider.max = '3600';\r\n  durSlider.step = '1';\r\n  durSlider.value = String(currentDuration);\r\n  durSlider.style.flex = '1';\r\n\r\n  const durDisplay = document.createElement('input');\r\n  durDisplay.className = 'gt-dur-display';\r\n  durDisplay.type = 'text';\r\n  durDisplay.value = fmtMmSs(currentDuration);\r\n\r\n  const durPlusBtn = document.createElement('button');\r\n  durPlusBtn.className = 'gt-dur-btn';\r\n  durPlusBtn.textContent = '+';\r\n\r\n  function setDuration(sec: number): void {\r\n    sec = Math.max(1, Math.min(3600, sec));\r\n    currentDuration = sec;\r\n    durSlider.value = String(sec);\r\n    durDisplay.value = fmtMmSs(sec);\r\n    ctrl.onDurationChange?.(sec);\r\n  }\r\n\r\n  durSlider.addEventListener('input', () => {\r\n    const v = parseInt(durSlider.value, 10);\r\n    currentDuration = v;\r\n    durDisplay.value = fmtMmSs(v);\r\n    presetBtns.forEach(b => b.classList.remove('active'));\r\n    ctrl.onDurationChange?.(v);\r\n  });\r\n\r\n  durDisplay.addEventListener('change', () => {\r\n    const parsed = parseMmSs(durDisplay.value);\r\n    if (parsed !== null) {\r\n      setDuration(parsed);\r\n    } else {\r\n      durDisplay.value = fmtMmSs(currentDuration);\r\n    }\r\n  });\r\n\r\n  // +/- hold acceleration helper\r\n  function makeHold(setter: (d: number) => void) {\r\n    let iv: ReturnType<typeof setInterval> | null = null;\r\n    return {\r\n      start(d: number) { setter(d); iv = setInterval(() => setter(d), 80); },\r\n      stop() { if (iv) { clearInterval(iv); iv = null; } },\r\n    };\r\n  }\r\n\r\n  const durHold = makeHold((d) => setDuration(currentDuration + d));\r\n  durMinusBtn.addEventListener('pointerdown', (e) => { e.preventDefault(); durHold.start(-1); });\r\n  durMinusBtn.addEventListener('pointerup', () => durHold.stop());\r\n  durMinusBtn.addEventListener('pointerleave', () => durHold.stop());\r\n  durPlusBtn.addEventListener('pointerdown', (e) => { e.preventDefault(); durHold.start(1); });\r\n  durPlusBtn.addEventListener('pointerup', () => durHold.stop());\r\n  durPlusBtn.addEventListener('pointerleave', () => durHold.stop());\r\n\r\n  durRow.appendChild(durMinusBtn);\r\n  durRow.appendChild(durSlider);\r\n  durRow.appendChild(durDisplay);\r\n  durRow.appendChild(durPlusBtn);\r\n\r\n  // \"Stop to change\" hint (hidden by default)\r\n  const durHint = document.createElement('span');\r\n  durHint.className = 'gt-dur-hint';\r\n  durHint.textContent = 'Stop to change';\r\n  durHint.style.display = 'none';\r\n  durLabel.appendChild(durHint);\r\n\r\n  // Duration preset buttons\r\n  const presetRow = document.createElement('div');\r\n  presetRow.className = 'gt-preset-row';\r\n  const PRESETS_DUR = [\r\n    { label: '3m', sec: 180 },\r\n    { label: '5m', sec: 300 },\r\n    { label: '10m', sec: 600 },\r\n    { label: '30m', sec: 1800 },\r\n    { label: '60m', sec: 3600 },\r\n  ];\r\n  const presetBtns: HTMLButtonElement[] = [];\r\n  for (const p of PRESETS_DUR) {\r\n    const btn = document.createElement('button');\r\n    btn.className = 'gt-preset-btn';\r\n    btn.textContent = p.label;\r\n    if (p.sec === currentDuration) btn.classList.add('active');\r\n    btn.addEventListener('click', () => {\r\n      setDuration(p.sec);\r\n      presetBtns.forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n    });\r\n    presetRow.appendChild(btn);\r\n    presetBtns.push(btn);\r\n  }\r\n\r\n  timerSection.appendChild(durLabel);\r\n  timerSection.appendChild(presetRow);\r\n  timerSection.appendChild(durRow);\r\n\r\n  // \u2500\u2500 Particles control \u2500\u2500\r\n  const partLabel = document.createElement('div');\r\n  partLabel.className = 'gt-field-row';\r\n  partLabel.innerHTML = '<span class=\"gt-field-label\">Particles</span>';\r\n  partLabel.style.marginBottom = '0';\r\n\r\n  const partHint = document.createElement('span');\r\n  partHint.className = 'gt-dur-hint';\r\n  partHint.textContent = 'Stop to change';\r\n  partHint.style.display = 'none';\r\n  partLabel.appendChild(partHint);\r\n\r\n  const partPresetRow = document.createElement('div');\r\n  partPresetRow.className = 'gt-preset-row';\r\n  const PRESETS_PART = [\r\n    { label: '60', val: 60 },\r\n    { label: '300', val: 300 },\r\n    { label: '600', val: 600 },\r\n    { label: '1800', val: 1800 },\r\n    { label: '3600', val: 3600 },\r\n  ];\r\n  const partPresetBtns: HTMLButtonElement[] = [];\r\n  for (const p of PRESETS_PART) {\r\n    const btn = document.createElement('button');\r\n    btn.className = 'gt-preset-btn';\r\n    btn.textContent = p.label;\r\n    if (p.val === currentParticles) btn.classList.add('active');\r\n    btn.addEventListener('click', () => {\r\n      setParticlesVal(p.val);\r\n      partPresetBtns.forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n    });\r\n    partPresetRow.appendChild(btn);\r\n    partPresetBtns.push(btn);\r\n  }\r\n\r\n  const partRow = document.createElement('div');\r\n  partRow.className = 'gt-dur-row';\r\n  const partMinusBtn = document.createElement('button');\r\n  partMinusBtn.className = 'gt-dur-btn';\r\n  partMinusBtn.textContent = '\\u2212';\r\n  const partSlider = document.createElement('input');\r\n  partSlider.type = 'range';\r\n  partSlider.className = 'gt-slider-input';\r\n  partSlider.min = '10';\r\n  partSlider.max = '3600';\r\n  partSlider.step = '1';\r\n  partSlider.value = String(currentParticles);\r\n  partSlider.style.flex = '1';\r\n  const partDisplay = document.createElement('input');\r\n  partDisplay.className = 'gt-dur-display';\r\n  partDisplay.type = 'text';\r\n  partDisplay.value = String(currentParticles);\r\n  const partPlusBtn = document.createElement('button');\r\n  partPlusBtn.className = 'gt-dur-btn';\r\n  partPlusBtn.textContent = '+';\r\n\r\n  function setParticlesVal(n: number): void {\r\n    n = Math.max(10, Math.min(3600, n));\r\n    currentParticles = n;\r\n    partSlider.value = String(n);\r\n    partDisplay.value = String(n);\r\n    ctrl.onParticlesChange?.(n);\r\n  }\r\n\r\n  partSlider.addEventListener('input', () => {\r\n    const v = parseInt(partSlider.value, 10);\r\n    currentParticles = v;\r\n    partDisplay.value = String(v);\r\n    partPresetBtns.forEach(b => b.classList.remove('active'));\r\n    ctrl.onParticlesChange?.(v);\r\n  });\r\n  partDisplay.addEventListener('change', () => {\r\n    const v = parseInt(partDisplay.value, 10);\r\n    if (Number.isFinite(v)) {\r\n      setParticlesVal(v);\r\n    } else {\r\n      partDisplay.value = String(currentParticles);\r\n    }\r\n  });\r\n\r\n  const partHold = makeHold((d) => setParticlesVal(currentParticles + d));\r\n  partMinusBtn.addEventListener('pointerdown', (e) => { e.preventDefault(); partHold.start(-1); });\r\n  partMinusBtn.addEventListener('pointerup', () => partHold.stop());\r\n  partMinusBtn.addEventListener('pointerleave', () => partHold.stop());\r\n  partPlusBtn.addEventListener('pointerdown', (e) => { e.preventDefault(); partHold.start(1); });\r\n  partPlusBtn.addEventListener('pointerup', () => partHold.stop());\r\n  partPlusBtn.addEventListener('pointerleave', () => partHold.stop());\r\n\r\n  partRow.appendChild(partMinusBtn);\r\n  partRow.appendChild(partSlider);\r\n  partRow.appendChild(partDisplay);\r\n  partRow.appendChild(partPlusBtn);\r\n\r\n  timerSection.appendChild(partLabel);\r\n  timerSection.appendChild(partPresetRow);\r\n  timerSection.appendChild(partRow);\r\n\r\n  // \u2500\u2500 Rows control \u2500\u2500\r\n  const rowsLabel = document.createElement('div');\r\n  rowsLabel.className = 'gt-field-row';\r\n  rowsLabel.innerHTML = '<span class=\"gt-field-label\">Rows</span>';\r\n  rowsLabel.style.marginBottom = '0';\r\n\r\n  const rowsHint = document.createElement('span');\r\n  rowsHint.className = 'gt-dur-hint';\r\n  rowsHint.textContent = 'Stop to change';\r\n  rowsHint.style.display = 'none';\r\n  rowsLabel.appendChild(rowsHint);\r\n\r\n  const rowsPresetRow = document.createElement('div');\r\n  rowsPresetRow.className = 'gt-preset-row';\r\n  const PRESETS_ROWS = [\r\n    { label: '8', val: 8 },\r\n    { label: '16', val: 16 },\r\n    { label: '24', val: 24 },\r\n    { label: '32', val: 32 },\r\n    { label: '48', val: 48 },\r\n  ];\r\n  const rowsPresetBtns: HTMLButtonElement[] = [];\r\n  for (const p of PRESETS_ROWS) {\r\n    const btn = document.createElement('button');\r\n    btn.className = 'gt-preset-btn';\r\n    btn.textContent = p.label;\r\n    if (p.val === currentRows) btn.classList.add('active');\r\n    btn.addEventListener('click', () => {\r\n      setRowsVal(p.val);\r\n      rowsPresetBtns.forEach(b => b.classList.remove('active'));\r\n      btn.classList.add('active');\r\n    });\r\n    rowsPresetRow.appendChild(btn);\r\n    rowsPresetBtns.push(btn);\r\n  }\r\n\r\n  const rowsRow = document.createElement('div');\r\n  rowsRow.className = 'gt-dur-row';\r\n  const rowsMinusBtn = document.createElement('button');\r\n  rowsMinusBtn.className = 'gt-dur-btn';\r\n  rowsMinusBtn.textContent = '\\u2212';\r\n  const rowsSlider = document.createElement('input');\r\n  rowsSlider.type = 'range';\r\n  rowsSlider.className = 'gt-slider-input';\r\n  rowsSlider.min = '4';\r\n  rowsSlider.max = '64';\r\n  rowsSlider.step = '1';\r\n  rowsSlider.value = String(currentRows);\r\n  rowsSlider.style.flex = '1';\r\n  const rowsDisplay = document.createElement('input');\r\n  rowsDisplay.className = 'gt-dur-display';\r\n  rowsDisplay.type = 'text';\r\n  rowsDisplay.value = String(currentRows);\r\n  const rowsPlusBtn = document.createElement('button');\r\n  rowsPlusBtn.className = 'gt-dur-btn';\r\n  rowsPlusBtn.textContent = '+';\r\n\r\n  function setRowsVal(r: number): void {\r\n    r = Math.max(4, Math.min(64, r));\r\n    currentRows = r;\r\n    rowsSlider.value = String(r);\r\n    rowsDisplay.value = String(r);\r\n    ctrl.onRowsChange?.(r);\r\n  }\r\n\r\n  rowsSlider.addEventListener('input', () => {\r\n    const v = parseInt(rowsSlider.value, 10);\r\n    currentRows = v;\r\n    rowsDisplay.value = String(v);\r\n    rowsPresetBtns.forEach(b => b.classList.remove('active'));\r\n    ctrl.onRowsChange?.(v);\r\n  });\r\n  rowsDisplay.addEventListener('change', () => {\r\n    const v = parseInt(rowsDisplay.value, 10);\r\n    if (Number.isFinite(v)) {\r\n      setRowsVal(v);\r\n    } else {\r\n      rowsDisplay.value = String(currentRows);\r\n    }\r\n  });\r\n\r\n  const rowsHold = makeHold((d) => setRowsVal(currentRows + d));\r\n  rowsMinusBtn.addEventListener('pointerdown', (e) => { e.preventDefault(); rowsHold.start(-1); });\r\n  rowsMinusBtn.addEventListener('pointerup', () => rowsHold.stop());\r\n  rowsMinusBtn.addEventListener('pointerleave', () => rowsHold.stop());\r\n  rowsPlusBtn.addEventListener('pointerdown', (e) => { e.preventDefault(); rowsHold.start(1); });\r\n  rowsPlusBtn.addEventListener('pointerup', () => rowsHold.stop());\r\n  rowsPlusBtn.addEventListener('pointerleave', () => rowsHold.stop());\r\n\r\n  rowsRow.appendChild(rowsMinusBtn);\r\n  rowsRow.appendChild(rowsSlider);\r\n  rowsRow.appendChild(rowsDisplay);\r\n  rowsRow.appendChild(rowsPlusBtn);\r\n\r\n  timerSection.appendChild(rowsLabel);\r\n  timerSection.appendChild(rowsPresetRow);\r\n  timerSection.appendChild(rowsRow);\r\n\r\n  // Centiseconds (hidden in clock mode)\r\n  const csRow = document.createElement('div');\r\n  csRow.className = 'gt-field-row';\r\n  csRow.innerHTML = '<span class=\"gt-field-label\">Centiseconds</span>';\r\n  const csSelect = document.createElement('select');\r\n  csSelect.className = 'gt-field-select';\r\n  csSelect.innerHTML = '<option value=\"on\">ON</option><option value=\"off\">OFF</option>';\r\n  csSelect.value = initialCs ? 'on' : 'off';\r\n  csSelect.addEventListener('change', () => {\r\n    ctrl.onCentisecondsToggle?.(csSelect.value === 'on');\r\n  });\r\n  csRow.appendChild(csSelect);\r\n  timerSection.appendChild(csRow);\r\n\r\n  // Preset\r\n  const physModeRow = document.createElement('div');\r\n  physModeRow.className = 'gt-field-row';\r\n  physModeRow.innerHTML = '<span class=\"gt-field-label\">Preset</span>';\r\n  const physModeSelect = document.createElement('select');\r\n  physModeSelect.className = 'gt-field-select';\r\n  for (const name of Object.keys(PRESETS)) {\r\n    const opt = document.createElement('option');\r\n    opt.value = name.toLowerCase();\r\n    opt.textContent = name;\r\n    if (name.toLowerCase() === initialMode.toLowerCase()) opt.selected = true;\r\n    physModeSelect.appendChild(opt);\r\n  }\r\n  physModeSelect.addEventListener('change', () => {\r\n    ctrl.onModeChange?.(physModeSelect.value);\r\n    updateBaseFromPreset();\r\n    syncPhysicsSliders();\r\n  });\r\n  physModeRow.appendChild(physModeSelect);\r\n  timerSection.appendChild(physModeRow);\r\n\r\n  // Clock mode visibility\r\n  function updateClockModeVisibility(): void {\r\n    const isClock = appSelect.value === 'clock';\r\n    durLabel.style.display = isClock ? 'none' : '';\r\n    presetRow.style.display = isClock ? 'none' : '';\r\n    durRow.style.display = isClock ? 'none' : '';\r\n    partLabel.style.display = isClock ? 'none' : '';\r\n    partPresetRow.style.display = isClock ? 'none' : '';\r\n    partRow.style.display = isClock ? 'none' : '';\r\n    rowsLabel.style.display = isClock ? 'none' : '';\r\n    rowsPresetRow.style.display = isClock ? 'none' : '';\r\n    rowsRow.style.display = isClock ? 'none' : '';\r\n    csRow.style.display = isClock ? 'none' : '';\r\n  }\r\n  updateClockModeVisibility();\r\n\r\n  drawerContent.appendChild(timerSection);\r\n\r\n  // \u2500\u2500 THEME section \u2500\u2500\r\n  const themeSection = document.createElement('div');\r\n  themeSection.className = 'gt-section';\r\n  themeSection.innerHTML = '<div class=\"gt-section-title\">Theme</div>';\r\n\r\n  const themeStrip = document.createElement('div');\r\n  themeStrip.className = 'gt-theme-strip';\r\n  const themeChips: HTMLButtonElement[] = [];\r\n\r\n  const LED_COLORS: Record<string, string> = {\r\n    nixie:  '#FF8C00',\r\n    system: '#00FF41',\r\n    studio: '#FFFFFF',\r\n    cyber:  '#00D1FF',\r\n  };\r\n\r\n  for (const t of CLOCK_THEMES) {\r\n    const chip = document.createElement('button');\r\n    chip.className = 'gt-theme-chip';\r\n    const tc = LED_COLORS[t.name.toLowerCase()] || '#fff';\r\n    chip.style.setProperty('--tc', tc);\r\n    if (t.name.toLowerCase() === initialTheme.toLowerCase()) chip.classList.add('active');\r\n\r\n    const led = document.createElement('span');\r\n    led.className = 'gt-led';\r\n    led.style.background = tc;\r\n    chip.appendChild(led);\r\n\r\n    const label = document.createElement('span');\r\n    label.textContent = t.name;\r\n    chip.appendChild(label);\r\n\r\n    chip.addEventListener('click', () => {\r\n      themeChips.forEach(c => c.classList.remove('active'));\r\n      chip.classList.add('active');\r\n      ctrl.onThemeChange?.(t.name);\r\n    });\r\n    themeStrip.appendChild(chip);\r\n    themeChips.push(chip);\r\n  }\r\n  themeSection.appendChild(themeStrip);\r\n  drawerContent.appendChild(themeSection);\r\n\r\n  // \u2500\u2500 PHYSICS section \u2500\u2500\r\n  const physSection = document.createElement('div');\r\n  physSection.className = 'gt-section';\r\n  physSection.innerHTML = '<div class=\"gt-section-title\">Physics</div>';\r\n\r\n  // Base drag values for friction multiplier\r\n  let baseDragX = PHYSICS.dragX;\r\n  let baseDragY = PHYSICS.dragY;\r\n  let baseDragXSettle = PHYSICS.dragXSettle;\r\n  let baseDragYSettle = PHYSICS.dragYSettle;\r\n  let currentFriction = initialFriction;\r\n\r\n  function updateBaseFromPreset(): void {\r\n    baseDragX = PHYSICS.dragX;\r\n    baseDragY = PHYSICS.dragY;\r\n    baseDragXSettle = PHYSICS.dragXSettle;\r\n    baseDragYSettle = PHYSICS.dragYSettle;\r\n  }\r\n\r\n  function applyFriction(f: number): void {\r\n    currentFriction = f;\r\n    PHYSICS.dragX = baseDragX * f;\r\n    PHYSICS.dragY = baseDragY * f;\r\n    PHYSICS.dragXSettle = baseDragXSettle * f;\r\n    PHYSICS.dragYSettle = baseDragYSettle * f;\r\n  }\r\n\r\n  if (initialFriction !== 1.0) {\r\n    applyFriction(initialFriction);\r\n  }\r\n\r\n  // Gravity\r\n  const gravRow = document.createElement('div');\r\n  gravRow.className = 'gt-slider-row';\r\n  const gravLabel = document.createElement('span');\r\n  gravLabel.className = 'gt-slider-label';\r\n  gravLabel.textContent = 'Gravity';\r\n  const gravInput = document.createElement('input');\r\n  gravInput.type = 'range';\r\n  gravInput.className = 'gt-slider-input';\r\n  gravInput.min = '50';\r\n  gravInput.max = '3000';\r\n  gravInput.step = '10';\r\n  gravInput.value = String(PHYSICS.gravity);\r\n  const gravVal = document.createElement('span');\r\n  gravVal.className = 'gt-slider-val';\r\n  gravVal.textContent = String(Math.round(PHYSICS.gravity));\r\n  gravInput.addEventListener('input', () => {\r\n    const v = parseFloat(gravInput.value);\r\n    PHYSICS.gravity = v;\r\n    gravVal.textContent = String(Math.round(v));\r\n    ctrl.onGravityChange?.(v);\r\n  });\r\n  gravRow.appendChild(gravLabel);\r\n  gravRow.appendChild(gravInput);\r\n  gravRow.appendChild(gravVal);\r\n  physSection.appendChild(gravRow);\r\n\r\n  // Bounce (restitution)\r\n  const bounceRow = document.createElement('div');\r\n  bounceRow.className = 'gt-slider-row';\r\n  const bounceLabel = document.createElement('span');\r\n  bounceLabel.className = 'gt-slider-label';\r\n  bounceLabel.textContent = 'Bounce';\r\n  const bounceInput = document.createElement('input');\r\n  bounceInput.type = 'range';\r\n  bounceInput.className = 'gt-slider-input';\r\n  bounceInput.min = '0';\r\n  bounceInput.max = '1.0';\r\n  bounceInput.step = '0.01';\r\n  bounceInput.value = String(PHYSICS.restitution);\r\n  const bounceVal = document.createElement('span');\r\n  bounceVal.className = 'gt-slider-val';\r\n  bounceVal.textContent = PHYSICS.restitution.toFixed(2);\r\n  bounceInput.addEventListener('input', () => {\r\n    const v = parseFloat(bounceInput.value);\r\n    PHYSICS.restitution = v;\r\n    bounceVal.textContent = v.toFixed(2);\r\n    ctrl.onBouncinessChange?.(v);\r\n  });\r\n  bounceRow.appendChild(bounceLabel);\r\n  bounceRow.appendChild(bounceInput);\r\n  bounceRow.appendChild(bounceVal);\r\n  physSection.appendChild(bounceRow);\r\n\r\n  // Flow (friction multiplier)\r\n  const fricRow = document.createElement('div');\r\n  fricRow.className = 'gt-slider-row';\r\n  const fricLabel = document.createElement('span');\r\n  fricLabel.className = 'gt-slider-label';\r\n  fricLabel.textContent = 'Flow';\r\n  const fricInput = document.createElement('input');\r\n  fricInput.type = 'range';\r\n  fricInput.className = 'gt-slider-input';\r\n  fricInput.min = '0.5';\r\n  fricInput.max = '3.0';\r\n  fricInput.step = '0.05';\r\n  fricInput.value = String(currentFriction);\r\n  const fricVal = document.createElement('span');\r\n  fricVal.className = 'gt-slider-val';\r\n  fricVal.textContent = `\\u00D7${currentFriction.toFixed(2)}`;\r\n  fricInput.addEventListener('input', () => {\r\n    const v = parseFloat(fricInput.value);\r\n    applyFriction(v);\r\n    fricVal.textContent = `\\u00D7${v.toFixed(2)}`;\r\n    ctrl.onFrictionChange?.(v);\r\n  });\r\n  fricRow.appendChild(fricLabel);\r\n  fricRow.appendChild(fricInput);\r\n  fricRow.appendChild(fricVal);\r\n  physSection.appendChild(fricRow);\r\n\r\n  // Reset\r\n  const physResetBtn = document.createElement('button');\r\n  physResetBtn.className = 'gt-sys-btn';\r\n  physResetBtn.textContent = 'Reset Physics';\r\n  physResetBtn.style.marginTop = '12px';\r\n  physResetBtn.addEventListener('click', () => {\r\n    applyPreset(physModeSelect.value);\r\n    updateBaseFromPreset();\r\n    currentFriction = 1.0;\r\n    applyFriction(1.0);\r\n    syncPhysicsSliders();\r\n  });\r\n  physSection.appendChild(physResetBtn);\r\n\r\n  function syncPhysicsSliders(): void {\r\n    gravInput.value = String(PHYSICS.gravity);\r\n    gravVal.textContent = String(Math.round(PHYSICS.gravity));\r\n    bounceInput.value = String(PHYSICS.restitution);\r\n    bounceVal.textContent = PHYSICS.restitution.toFixed(2);\r\n    fricInput.value = String(currentFriction);\r\n    fricVal.textContent = `\\u00D7${currentFriction.toFixed(2)}`;\r\n  }\r\n\r\n  drawerContent.appendChild(physSection);\r\n\r\n  // \u2500\u2500 SYSTEM section \u2500\u2500\r\n  const sysSection = document.createElement('div');\r\n  sysSection.className = 'gt-section';\r\n  sysSection.innerHTML = `<div class=\"gt-section-title\">System</div>`;\r\n\r\n  const seedRow = document.createElement('div');\r\n  seedRow.className = 'gt-field-row';\r\n  seedRow.innerHTML = '<span class=\"gt-field-label\">Seed</span>';\r\n  const seedVal = document.createElement('span');\r\n  seedVal.className = 'gt-slider-val';\r\n  seedVal.style.width = 'auto';\r\n  seedVal.textContent = String(currentSeed);\r\n  seedRow.appendChild(seedVal);\r\n  sysSection.appendChild(seedRow);\r\n\r\n  const shareBtn = document.createElement('button');\r\n  shareBtn.className = 'gt-sys-btn';\r\n  shareBtn.textContent = 'Share URL';\r\n  shareBtn.addEventListener('click', () => {\r\n    ctrl.onShareURL?.();\r\n    shareBtn.textContent = 'Copied!';\r\n    setTimeout(() => { shareBtn.textContent = 'Share URL'; }, 1500);\r\n  });\r\n  sysSection.appendChild(shareBtn);\r\n\r\n  const resetBtn = document.createElement('button');\r\n  resetBtn.className = 'gt-sys-btn';\r\n  resetBtn.textContent = 'Reset to Default';\r\n  resetBtn.addEventListener('click', () => ctrl.onResetDefaults?.());\r\n  sysSection.appendChild(resetBtn);\r\n\r\n  drawerContent.appendChild(sysSection);\r\n\r\n  drawer.appendChild(drawerContent);\r\n  document.body.appendChild(overlay);\r\n  document.body.appendChild(drawer);\r\n\r\n  // \u2500\u2500 Drawer toggle \u2500\u2500\r\n  let drawerOpen = false;\r\n\r\n  function toggleDrawer(): void {\r\n    drawerOpen = !drawerOpen;\r\n    drawer.classList.toggle('open', drawerOpen);\r\n    overlay.classList.toggle('open', drawerOpen);\r\n    if (drawerOpen) { syncPhysicsSliders(); }\r\n  }\r\n\r\n  function closeDrawer(): void {\r\n    drawerOpen = false;\r\n    drawer.classList.remove('open');\r\n    overlay.classList.remove('open');\r\n  }\r\n\r\n  // \u2500\u2500 Controller \u2500\u2500\r\n  const ctrl: ConsoleController = {\r\n    el: controls,\r\n    show() { controls.classList.remove('hidden'); },\r\n    hide() {\r\n      controls.classList.add('hidden');\r\n      if (drawerOpen) closeDrawer();\r\n    },\r\n    setTime(_remainingMs: number) {},\r\n    setStatus(_status: SignalStatus) {},\r\n    onModeChange: null,\r\n    onPause: null,\r\n    onStart: null,\r\n    onStop: null,\r\n    onThemeChange: null,\r\n    onDurationChange: null,\r\n    onParticlesChange: null,\r\n    onRowsChange: null,\r\n    onCentisecondsToggle: null,\r\n    onResetDefaults: null,\r\n    onShareURL: null,\r\n    onAppModeChange: null,\r\n    onGravityChange: null,\r\n    onBouncinessChange: null,\r\n    onFrictionChange: null,\r\n    setPaused(p: boolean) {\r\n      isPaused = p;\r\n      startBtn.style.display = p ? '' : 'none';\r\n      pauseBtn.style.display = p ? 'none' : '';\r\n    },\r\n    setThemeName(name: string) {\r\n      themeChips.forEach(c => {\r\n        c.classList.toggle('active', c.textContent?.toLowerCase() === name.toLowerCase());\r\n      });\r\n    },\r\n    setAccentColor(rgb: [number, number, number]) {\r\n      const [r, g, b] = rgb;\r\n      const accentBorder = `rgba(${r},${g},${b},0.30)`;\r\n      const accentColor = `rgba(${r},${g},${b},0.70)`;\r\n      for (const btn of [startBtn, pauseBtn, stopBtn, settingsBtn]) {\r\n        btn.style.borderColor = accentBorder;\r\n        btn.style.color = accentColor;\r\n      }\r\n      // Section titles in drawer\r\n      const titles = drawer.querySelectorAll<HTMLElement>('.gt-section-title');\r\n      for (const t of titles) {\r\n        t.style.color = `rgba(${r},${g},${b},0.35)`;\r\n      }\r\n    },\r\n    setConfigEnabled(enabled: boolean) {\r\n      // Duration\r\n      durSlider.disabled = !enabled;\r\n      durDisplay.disabled = !enabled;\r\n      durMinusBtn.disabled = !enabled;\r\n      durPlusBtn.disabled = !enabled;\r\n      for (const btn of presetBtns) btn.disabled = !enabled;\r\n      durHint.style.display = enabled ? 'none' : '';\r\n      // Particles\r\n      partSlider.disabled = !enabled;\r\n      partDisplay.disabled = !enabled;\r\n      partMinusBtn.disabled = !enabled;\r\n      partPlusBtn.disabled = !enabled;\r\n      for (const btn of partPresetBtns) btn.disabled = !enabled;\r\n      partHint.style.display = enabled ? 'none' : '';\r\n      // Rows\r\n      rowsSlider.disabled = !enabled;\r\n      rowsDisplay.disabled = !enabled;\r\n      rowsMinusBtn.disabled = !enabled;\r\n      rowsPlusBtn.disabled = !enabled;\r\n      for (const btn of rowsPresetBtns) btn.disabled = !enabled;\r\n      rowsHint.style.display = enabled ? 'none' : '';\r\n    },\r\n    setDuration(sec: number) {\r\n      currentDuration = sec;\r\n      durSlider.value = String(sec);\r\n      durDisplay.value = fmtMmSs(sec);\r\n    },\r\n    setParticles(n: number) {\r\n      currentParticles = n;\r\n      partSlider.value = String(n);\r\n      partDisplay.value = String(n);\r\n    },\r\n    setRows(rows: number) {\r\n      currentRows = rows;\r\n      rowsSlider.value = String(rows);\r\n      rowsDisplay.value = String(rows);\r\n    },\r\n    setSeed(seed: number) {\r\n      currentSeed = seed;\r\n      seedVal.textContent = String(seed);\r\n    },\r\n    closeDrawer,\r\n  };\r\n\r\n  startBtn.style.display = 'none';\r\n  return ctrl;\r\n}\r\n\r\nexport function applyPreset(modeName: string): void {\r\n  const key = Object.keys(PRESETS).find(\r\n    k => k.toLowerCase() === modeName.toLowerCase()\r\n  );\r\n  if (!key) return;\r\n  const preset = PRESETS[key];\r\n  for (const k of Object.keys(preset) as (keyof PhysicsParams)[]) {\r\n    (PHYSICS as any)[k] = preset[k];\r\n  }\r\n}\r\n", "/**\n * GALTON-TIMER \u2014 main entry point.\n * \"Chaos to Order, Randomness to Truth.\"\n *\n * Time authority: The Web Worker timer is the SOLE source of truth for elapsed time.\n * The simulation never self-increments elapsedMs \u2014 it receives it from Worker ticks.\n * On tab-hidden, the Worker keeps running (never paused). On restore, we snap.\n */\n\nimport { readParams, writeParams } from './utils/url-params';\nimport type { AppMode } from './utils/url-params';\nimport { createPRNG } from './utils/seed';\nimport { Simulation } from './engine/simulation';\nimport { Renderer, getThemeByName } from './engine/renderer';\nimport { gaussianHW } from './engine/layout';\nimport { TimerBridge } from './engine/timer-bridge';\nimport { createConsole, applyPreset } from './components/console';\n\n// \u2500\u2500 Bootstrap \u2500\u2500\n\nconst params = readParams();\n\n// Save original timer values before clock override\nlet savedTimerT = params.t;\nlet savedTimerN = params.n;\n\n// CLOCK mode overrides\nlet isClockMode = params.app === 'clock';\nif (isClockMode) {\n  params.n = 3600;\n  params.t = 3600;\n}\nwriteParams(params);\n\nconst rng = createPRNG(params.s);\n\nlet sim = new Simulation({\n  numRows: params.rows,\n  totalParticles: params.n,\n  totalTimeSec: params.t,\n  rng,\n});\n\n// \u2500\u2500 DOM \u2500\u2500\n\nconst container = document.getElementById('app')!;\nconst renderer = new Renderer(container, params.rows, params.n, params.s);\n\n// \u2500\u2500 Apply initial theme + clock \u2500\u2500\n\nrenderer.setThemeByName(params.theme);\nrenderer.setClockEnabled(params.clock);\n\n// \u2500\u2500 Apply initial mode preset \u2500\u2500\n\napplyPreset(params.mode);\n\n// \u2500\u2500 Web Worker Timer (SOLE time authority) \u2500\u2500\n\nconst timerBridge = new TimerBridge();\nlet workerRemainingMs = params.t * 1000;\n\n// Clock mode: worker elapsed starts from 0 for the remaining portion of the hour,\n// but the simulation needs the full hour-elapsed offset so grains continue emitting.\nlet clockElapsedOffset = 0;\n\ntimerBridge.onTick = (remainingMs, elapsedMs) => {\n  workerRemainingMs = remainingMs;\n  sim.setElapsedMs(elapsedMs + clockElapsedOffset);\n  consoleCtrl.setTime(remainingMs);\n};\n\ntimerBridge.onDone = () => {\n  workerRemainingMs = 0;\n  consoleCtrl.setTime(0);\n\n  if (isClockMode) {\n    // Hourly refill \u2014 no alarm, auto restart\n    startTheLoop();\n  } else {\n    renderer.startAlarm();\n    consoleCtrl.setStatus('alarm');\n  }\n};\n\n// \u2500\u2500 Console \u2500\u2500\n\nconst consoleCtrl = createConsole(\n  params.mode,\n  params.theme,\n  params.t,\n  params.cs,\n  params.app,\n  params.friction,\n  params.n,\n  params.rows,\n  params.s,\n);\n\n// Set initial accent color\nconsoleCtrl.setAccentColor(getThemeByName(params.theme).segmentRGB);\n\n// Auto-hide timer (5 seconds)\nlet hideTimeout: ReturnType<typeof setTimeout> | null = null;\n\nfunction showConsole(): void {\n  consoleCtrl.show();\n  if (hideTimeout !== null) clearTimeout(hideTimeout);\n  hideTimeout = setTimeout(() => consoleCtrl.hide(), 5000);\n}\n\ndocument.addEventListener('mousemove', showConsole);\ndocument.addEventListener('touchstart', showConsole);\nshowConsole();\n\n// Console callbacks\nconsoleCtrl.onModeChange = (modeName: string) => {\n  applyPreset(modeName);\n  params.mode = modeName;\n  writeParams(params);\n};\n\nconsoleCtrl.onThemeChange = (themeName: string) => {\n  renderer.setThemeByName(themeName);\n  consoleCtrl.setThemeName(themeName);\n  consoleCtrl.setAccentColor(getThemeByName(themeName).segmentRGB);\n  params.theme = themeName.toLowerCase();\n  writeParams(params);\n  // Redraw so hopper/pegs pick up new theme when loop isn't running\n  if (appState === 'idle') {\n    drawIdleFrame();\n  } else if (paused) {\n    renderer.drawFrame(\n      sim.activeParticles,\n      workerRemainingMs / 1000,\n      sim.totalParticles,\n      sim.emittedCount,\n      true,\n      sim.totalTimeMs,\n      undefined,\n      getCs(),\n      getWallClockSec(),\n    );\n  }\n};\n\nconsoleCtrl.onCentisecondsToggle = (enabled: boolean) => {\n  params.cs = enabled;\n  writeParams(params);\n};\n\nconsoleCtrl.onDurationChange = (sec: number) => {\n  params.t = sec;\n  writeParams(params);\n  if (appState === 'idle') drawIdleFrame();\n};\n\nconsoleCtrl.onParticlesChange = (n: number) => {\n  params.n = n;\n  savedTimerN = n;\n  writeParams(params);\n  if (appState === 'idle') {\n    sim = new Simulation({\n      numRows: params.rows,\n      totalParticles: params.n,\n      totalTimeSec: params.t,\n      rng,\n    });\n    renderer.clearStatic();\n    renderer.resize(params.rows, params.n);\n    drawIdleFrame();\n  }\n};\n\nconsoleCtrl.onRowsChange = (rows: number) => {\n  params.rows = rows;\n  writeParams(params);\n  if (appState === 'idle') {\n    sim = new Simulation({\n      numRows: params.rows,\n      totalParticles: params.n,\n      totalTimeSec: params.t,\n      rng,\n    });\n    renderer.clearStatic();\n    renderer.resize(params.rows, params.n);\n    drawIdleFrame();\n  }\n};\n\nconsoleCtrl.onAppModeChange = (mode: AppMode) => {\n  // Stop any running activity\n  cancelAnimationFrame(rafId);\n  timerBridge.reset();\n  renderer.stopAlarm();\n  renderer.resetHopperFade();\n  renderer.clearStatic();\n  paused = false;\n\n  // Save/restore timer duration across mode switch\n  if (!isClockMode) {\n    savedTimerT = params.t;\n    savedTimerN = params.n;\n  }\n\n  params.app = mode;\n  isClockMode = mode === 'clock';\n\n  if (isClockMode) {\n    params.n = 3600;\n    params.t = 3600;\n  } else {\n    params.t = savedTimerT;\n    params.n = savedTimerN;\n  }\n  writeParams(params);\n\n  // Recreate simulation\n  sim = new Simulation({\n    numRows: params.rows,\n    totalParticles: params.n,\n    totalTimeSec: params.t,\n    rng,\n  });\n  renderer.resize(params.rows);\n  workerRemainingMs = params.t * 1000;\n  clockElapsedOffset = 0;\n\n  if (isClockMode) {\n    startFresh();\n  } else {\n    appState = 'idle';\n    consoleCtrl.setPaused(true);\n    consoleCtrl.setStatus('idle');\n    consoleCtrl.setConfigEnabled(true);\n    consoleCtrl.setTime(params.t * 1000);\n    consoleCtrl.setDuration(params.t);\n    consoleCtrl.setParticles(params.n);\n    consoleCtrl.setRows(params.rows);\n    drawIdleFrame();\n  }\n};\n\nconsoleCtrl.onGravityChange = (_value: number) => {\n  // Gravity is set directly on PHYSICS by the console slider\n};\n\nconsoleCtrl.onFrictionChange = (value: number) => {\n  params.friction = value;\n  writeParams(params);\n};\n\nconsoleCtrl.onPause = () => togglePause();\nconsoleCtrl.onStart = () => {\n  if (paused) togglePause();      // resume if paused\n  else if (appState === 'idle' || sim.allSettled) startTheLoop(); // restart\n};\nconsoleCtrl.onStop = () => stopToIdle();\n\nconsoleCtrl.onShareURL = () => {\n  writeParams(params);\n  navigator.clipboard.writeText(window.location.href).catch(() => {});\n};\n\nconsoleCtrl.onResetDefaults = () => {\n  window.location.search = '';\n};\n\n// \u2500\u2500 State \u2500\u2500\n\ntype AppState = 'running' | 'paused' | 'purging' | 'refilling' | 'stopping' | 'idle';\nlet appState: AppState = 'idle';\nlet lastTime: number | null = null;\nlet paused = false;\nlet rafId = 0;\nlet hopperFadeAlpha = 1;\n\n// Snapshot of hopper state when entering stopping (for visible fade)\nlet stoppingEmitted = 0;\nlet stoppingTotal = 0;\n\n// Rain particles for refill animation\nlet rainParticles: { x: number; y: number; vx: number; vy: number; alpha: number; bounces: number }[] = [];\nlet refillElapsed = 0;\n\n// \u2500\u2500 Helpers \u2500\u2500\n\nfunction getCs(): number | undefined {\n  if (isClockMode) return undefined;\n  if (!params.cs) return undefined;\n  return Math.floor((workerRemainingMs % 1000) / 10);\n}\n\nfunction getWallClockSec(): number | undefined {\n  if (!isClockMode) return undefined;\n  const now = new Date();\n  return now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();\n}\n\nfunction togglePause(): void {\n  if (appState === 'purging' || appState === 'refilling' || appState === 'stopping') return;\n  if (sim.allSettled) return;\n\n  paused = !paused;\n  consoleCtrl.setPaused(paused);\n\n  if (paused) {\n    appState = 'paused';\n    timerBridge.pause();\n    cancelAnimationFrame(rafId);\n    renderer.drawFrame(\n      sim.activeParticles,\n      workerRemainingMs / 1000,\n      sim.totalParticles,\n      sim.emittedCount,\n      true,\n      sim.totalTimeMs,\n      undefined,\n      getCs(),\n      getWallClockSec(),\n    );\n  } else {\n    appState = 'running';\n    timerBridge.resume();\n    lastTime = null;\n    rafId = requestAnimationFrame(frame);\n  }\n}\n\nfunction startTheLoop(): void {\n  timerBridge.reset();\n  cancelAnimationFrame(rafId);\n  renderer.stopAlarm();\n  renderer.beginPurge();\n  appState = 'purging';\n  consoleCtrl.setStatus('ending');\n  consoleCtrl.setPaused(false);          // show \u23F8 during purge/refill\n  consoleCtrl.setConfigEnabled(false);\n  lastTime = null;\n  rafId = requestAnimationFrame(frame);\n}\n\nfunction stopToIdle(): void {\n  if (appState === 'idle' || appState === 'stopping') return;\n  cancelAnimationFrame(rafId);\n  timerBridge.reset();\n  renderer.stopAlarm();\n  paused = false;\n  consoleCtrl.setPaused(true); // show Start (\u25B6) button in idle\n\n  // Snapshot hopper state for visible fade-out\n  stoppingEmitted = sim.emittedCount;\n  stoppingTotal = sim.totalParticles;\n\n  // Fill stacks with binomial distribution\n  renderer.fillStacks(params.rows, params.n);\n\n  // Begin hopper fade-out (0.5s)\n  renderer.beginHopperFade();\n  hopperFadeAlpha = 1;\n  appState = 'stopping';\n  consoleCtrl.setStatus('idle');\n  consoleCtrl.setConfigEnabled(true);\n  lastTime = null;\n  rafId = requestAnimationFrame(frame);\n}\n\nfunction beginRefill(): void {\n  appState = 'refilling';\n  refillElapsed = 0;\n  rainParticles = [];\n\n  const L = renderer.layout;\n  const hopperHW = L.hopperTopHW;\n  const count = Math.min(Math.round(params.n * 0.15), 400);\n  for (let i = 0; i < count; i++) {\n    const tx = (Math.random() - 0.5) * 2;\n    rainParticles.push({\n      x: L.centerX + tx * hopperHW * 0.85,\n      y: L.hopperTop - 5 - Math.random() * 25,\n      vx: (Math.random() - 0.5) * 8,\n      vy: 300 + Math.random() * 50,\n      alpha: 0.5 + Math.random() * 0.3,\n      bounces: 0,\n    });\n  }\n}\n\nfunction drawIdleFrame(): void {\n  renderer.drawFrame([], params.t, params.n, params.n, false, params.t * 1000);\n}\n\nfunction startFresh(): void {\n  sim = new Simulation({\n    numRows: params.rows,\n    totalParticles: params.n,\n    totalTimeSec: params.t,\n    rng,\n  });\n  renderer.clearStatic();\n  renderer.resize(params.rows);\n\n  workerRemainingMs = params.t * 1000;\n  paused = false;\n  appState = 'running';\n\n  consoleCtrl.setPaused(false);\n  consoleCtrl.setStatus('ready');\n  consoleCtrl.setTime(params.t * 1000);\n  consoleCtrl.setConfigEnabled(false);\n\n  setTimeout(() => {\n    if (appState === 'running') {\n      consoleCtrl.setStatus('running');\n    }\n  }, 1000);\n\n  if (isClockMode) {\n    // Start from current position within the hour\n    const now = new Date();\n    const min = now.getMinutes();\n    const sec = now.getSeconds();\n    const ms = now.getMilliseconds();\n    const elapsedInHourMs = (min * 60 + sec) * 1000 + ms;\n    const remainingMs = 3600000 - elapsedInHourMs;\n\n    // Store offset so onTick adds it to worker's elapsed\n    clockElapsedOffset = elapsedInHourMs;\n\n    timerBridge.start(remainingMs);\n    workerRemainingMs = remainingMs;\n\n    // Instantly snap elapsed grains into place\n    sim.setElapsedMs(elapsedInHourMs);\n    const geom = renderer.getGeom();\n    const snapped = sim.instantSnap(geom);\n    for (const p of snapped) {\n      renderer.bakeParticle(p);\n    }\n  } else {\n    clockElapsedOffset = 0;\n    timerBridge.start(params.t * 1000);\n  }\n\n  lastTime = null;\n  rafId = requestAnimationFrame(frame);\n}\n\nfunction bakeSettledBatch(particles: import('./engine/simulation').Particle[]): void {\n  for (const p of particles) {\n    renderer.bakeParticle(p);\n  }\n}\n\n// \u2500\u2500 Resize \u2500\u2500\n\nwindow.addEventListener('resize', () => {\n  renderer.resize(params.rows);\n  if (appState === 'idle') {\n    drawIdleFrame();\n  } else if (paused || sim.allSettled) {\n    renderer.drawFrame(\n      sim.activeParticles,\n      workerRemainingMs / 1000,\n      sim.totalParticles,\n      sim.emittedCount,\n      paused,\n      sim.totalTimeMs,\n      undefined,\n      getCs(),\n      getWallClockSec(),\n    );\n  }\n});\n\n// \u2500\u2500 Pause / Resume (Space) \u2500\u2500\n\ndocument.addEventListener('keydown', (e) => {\n  if (e.code === 'Space') {\n    e.preventDefault();\n    togglePause();\n  }\n});\n\n// \u2500\u2500 Visibility API (Instant Snap) \u2500\u2500\n\ndocument.addEventListener('visibilitychange', () => {\n  if (document.hidden) {\n    cancelAnimationFrame(rafId);\n  } else {\n    if (appState !== 'running') {\n      if (appState === 'purging' || appState === 'refilling' || appState === 'stopping') {\n        lastTime = null;\n        rafId = requestAnimationFrame(frame);\n      }\n      return;\n    }\n\n    const geom = renderer.getGeom();\n    const forcedSettled = sim.forceSettleActive();\n    bakeSettledBatch(forcedSettled);\n    const snapped = sim.instantSnap(geom);\n    bakeSettledBatch(snapped);\n\n    renderer.drawFrame(\n      sim.activeParticles,\n      workerRemainingMs / 1000,\n      sim.totalParticles,\n      sim.emittedCount,\n      false,\n      sim.totalTimeMs,\n      undefined,\n      getCs(),\n      getWallClockSec(),\n    );\n\n    lastTime = null;\n    rafId = requestAnimationFrame(frame);\n  }\n});\n\n// \u2500\u2500 Main Loop \u2500\u2500\n\nfunction frame(now: number): void {\n  if (appState === 'paused' || appState === 'idle') return;\n\n  if (lastTime === null) lastTime = now;\n  const dtMs = Math.min(now - lastTime, 100);\n  const dtSec = dtMs / 1000;\n  lastTime = now;\n\n  if (appState === 'purging') {\n    const done = renderer.purgeStacks(dtSec);\n    renderer.drawFrame([], params.t, params.n, params.n, false, params.t * 1000);\n\n    if (done) {\n      beginRefill();\n    }\n    rafId = requestAnimationFrame(frame);\n    return;\n  }\n\n  if (appState === 'refilling') {\n    refillElapsed += dtMs;\n\n    const L = renderer.layout;\n    const gravity = 400;\n    for (const p of rainParticles) {\n      p.vy += gravity * dtSec;\n      p.x += p.vx * dtSec;\n      p.y += p.vy * dtSec;\n\n      if (p.y >= L.hopperBottom) {\n        p.y = L.hopperBottom - 1;\n        if (p.bounces < 3 && Math.abs(p.vy) > 15) {\n          const e = 0.15 + Math.random() * 0.30;\n          p.vy = -Math.abs(p.vy) * e;\n          p.vx = (Math.random() - 0.5) * 60;\n          p.bounces++;\n        } else {\n          p.vy = 0;\n          p.vx = 0;\n          p.alpha = Math.max(0, p.alpha - dtSec * 1.8);\n        }\n      }\n\n      const hw = gaussianHW(p.y, L);\n      const maxX = L.centerX + hw * 0.88;\n      const minX = L.centerX - hw * 0.88;\n      if (p.x > maxX) { p.x = maxX; p.vx = -Math.abs(p.vx) * 0.3; }\n      if (p.x < minX) { p.x = minX; p.vx = Math.abs(p.vx) * 0.3; }\n    }\n    rainParticles = rainParticles.filter(p => p.alpha > 0.01);\n\n    renderer.drawFrame([], params.t, sim.totalParticles, 0, false, sim.totalTimeMs, rainParticles);\n\n    if (refillElapsed >= 800) {\n      startFresh();\n      return;\n    }\n    rafId = requestAnimationFrame(frame);\n    return;\n  }\n\n  // \u2500\u2500 Stopping state (hopper fade-out) \u2500\u2500\n  if (appState === 'stopping') {\n    hopperFadeAlpha -= dtSec / 0.5; // 0.5s fade\n    renderer.setHopperFadeAlpha(Math.max(0, hopperFadeAlpha));\n    renderer.drawFrame([], params.t, stoppingTotal, stoppingEmitted, false, params.t * 1000);\n    if (hopperFadeAlpha <= 0) {\n      appState = 'idle';\n      renderer.resetHopperFade();\n      drawIdleFrame();\n      return; // idle \u2014 stop loop\n    }\n    rafId = requestAnimationFrame(frame);\n    return;\n  }\n\n  // \u2500\u2500 Running state \u2500\u2500\n  const geom = renderer.getGeom();\n  const settled = sim.update(dtMs, geom, (x) => renderer.getGroundY(x));\n\n  for (const p of settled) {\n    renderer.bakeParticle(p);\n  }\n\n  renderer.drawFrame(\n    sim.activeParticles,\n    workerRemainingMs / 1000,\n    sim.totalParticles,\n    sim.emittedCount,\n    false,\n    sim.totalTimeMs,\n    undefined,\n    getCs(),\n    getWallClockSec(),\n  );\n\n  if (!sim.allSettled) {\n    rafId = requestAnimationFrame(frame);\n  } else if (!renderer.isAlarmFlashDone()) {\n    rafId = requestAnimationFrame(frame); // keep loop for alarm flash\n  } else {\n    renderer.stopAlarm();\n    appState = 'idle';\n    consoleCtrl.setStatus('idle');\n    consoleCtrl.setPaused(true);        // show \u25B6\n    consoleCtrl.setConfigEnabled(true);\n    drawIdleFrame();\n  }\n}\n\n// \u2500\u2500 Initial start \u2500\u2500\n\nif (isClockMode) {\n  startFresh(); // Clock auto-starts (real-time display)\n} else {\n  // Timer mode: start in idle, wait for user to press \u25B6\n  appState = 'idle';\n  consoleCtrl.setPaused(true);\n  consoleCtrl.setStatus('idle');\n  consoleCtrl.setConfigEnabled(true);\n  drawIdleFrame();\n}\n"],
  "mappings": "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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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",
  "names": ["container", "container", "rainParticles"]
}
