{
  "version": 3,
  "sources": ["../src/utils/url-params.ts", "../src/utils/seed.ts", "../src/engine/simulation.ts", "../src/engine/seven-seg.ts", "../src/engine/layout.ts", "../src/engine/grain-renderer.ts", "../src/engine/renderer.ts", "../src/engine/timer-bridge.ts", "../src/utils/qr-svg.ts", "../src/components/console.ts", "../src/main.ts"],
  "sourcesContent": ["/**\n * URL parameter serialization / deserialization.\n * Format: ?app=timer&t=3600&n=3600&s=42&rows=24&mode=standard&clock=true&theme=nixie&timerMode=classic&glow=1.0&friction=1.0\n */\n\nimport type { TimerMode } from '../engine/renderer';\n\nexport type AppMode = 'timer' | 'clock';\n\nexport interface AppParams {\n  /** App mode: timer or clock */\n  app: AppMode;\n  /** Timer duration in seconds */\n  t: number;\n  /** Total number of particles */\n  n: number;\n  /** PRNG seed */\n  s: number;\n  /** Number of peg rows */\n  rows: number;\n  /** Physics mode preset name */\n  mode: string;\n  /** Clock display enabled */\n  clock: boolean;\n  /** Color theme name */\n  theme: string;\n  /** Timer display mode */\n  timerMode: TimerMode;\n  /** Glow intensity (0-2) */\n  glow: number;\n  /** Centiseconds display enabled */\n  cs: boolean;\n  /** Friction multiplier for drag values */\n  friction: number;\n}\n\nconst VALID_MODES = ['standard', 'heavy sand', 'techno', 'moon gravity', 'super ball'];\nconst VALID_THEMES = ['nixie', 'system', 'studio', 'cyber'];\nconst VALID_TIMER_MODES: TimerMode[] = ['classic', 'strict', 'seconds', 'off'];\nconst VALID_APP_MODES: AppMode[] = ['timer', 'clock'];\n\nconst DEFAULTS: AppParams = {\n  app: 'timer',\n  t: 3600,\n  n: 3600,\n  s: 0,       // 0 means \"generate from timestamp\"\n  rows: 24,\n  mode: 'standard',\n  clock: false,\n  theme: 'nixie',\n  timerMode: 'classic',\n  glow: 1.0,\n  cs: true,\n  friction: 1.0,\n};\n\nexport function readParams(): AppParams {\n  const sp = new URLSearchParams(window.location.search);\n  const raw = (key: string, fallback: number): number => {\n    const v = sp.get(key);\n    if (v === null) return fallback;\n    const num = parseInt(v, 10);\n    return Number.isFinite(num) ? num : fallback;\n  };\n\n  let seed = raw('s', DEFAULTS.s);\n  if (seed === 0) {\n    seed = (Date.now() % 1_000_000) | 1;\n  }\n\n  const appRaw = (sp.get('app') || DEFAULTS.app).toLowerCase().trim() as AppMode;\n  const app = VALID_APP_MODES.includes(appRaw) ? appRaw : DEFAULTS.app;\n\n  const modeRaw = (sp.get('mode') || DEFAULTS.mode).toLowerCase().trim();\n  const mode = VALID_MODES.includes(modeRaw) ? modeRaw : DEFAULTS.mode;\n\n  const clockRaw = sp.get('clock');\n  const clock = clockRaw === null ? DEFAULTS.clock : clockRaw !== 'false' && clockRaw !== '0';\n\n  const themeRaw = (sp.get('theme') || DEFAULTS.theme).toLowerCase().trim();\n  const theme = VALID_THEMES.includes(themeRaw) ? themeRaw : DEFAULTS.theme;\n\n  const timerModeRaw = (sp.get('timerMode') || DEFAULTS.timerMode).toLowerCase().trim() as TimerMode;\n  const timerMode = VALID_TIMER_MODES.includes(timerModeRaw) ? timerModeRaw : DEFAULTS.timerMode;\n\n  const glowRaw = sp.get('glow');\n  const glow = glowRaw !== null ? Math.max(0, Math.min(2, parseFloat(glowRaw) || DEFAULTS.glow)) : DEFAULTS.glow;\n\n  const csRaw = sp.get('cs');\n  const cs = csRaw === null ? DEFAULTS.cs : csRaw !== 'false' && csRaw !== '0';\n\n  const frictionRaw = sp.get('friction');\n  const friction = frictionRaw !== null\n    ? Math.max(0.5, Math.min(3.0, parseFloat(frictionRaw) || DEFAULTS.friction))\n    : DEFAULTS.friction;\n\n  return {\n    app,\n    t: Math.max(1, raw('t', DEFAULTS.t)),\n    n: Math.max(10, Math.min(3600, raw('n', DEFAULTS.n))),\n    s: seed,\n    rows: Math.max(4, Math.min(64, raw('rows', DEFAULTS.rows))),\n    mode,\n    clock,\n    theme,\n    timerMode,\n    glow,\n    cs,\n    friction,\n  };\n}\n\nexport function writeParams(cfg: AppParams): void {\n  const sp = new URLSearchParams();\n  sp.set('app', cfg.app);\n  sp.set('t', String(cfg.t));\n  sp.set('n', String(cfg.n));\n  sp.set('s', String(cfg.s));\n  sp.set('rows', String(cfg.rows));\n  sp.set('mode', cfg.mode);\n  sp.set('clock', String(cfg.clock));\n  sp.set('theme', cfg.theme);\n  sp.set('timerMode', cfg.timerMode);\n  sp.set('glow', String(cfg.glow));\n  sp.set('cs', String(cfg.cs));\n  sp.set('friction', String(cfg.friction));\n  const url = `${window.location.pathname}?${sp.toString()}`;\n  window.history.replaceState(null, '', url);\n}\n", "/**\n * Seed-based deterministic PRNG (mulberry32).\n * Math.random() is FORBIDDEN in this project.\n * All randomness must flow through this module.\n */\nexport function createPRNG(seed: number): () => number {\n  let s = seed | 0;\n  return (): number => {\n    s |= 0;\n    s = (s + 0x6d2b79f5) | 0;\n    let t = Math.imul(s ^ (s >>> 15), 1 | s);\n    t = (t + Math.imul(t ^ (t >>> 7), 61 | t)) ^ t;\n    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;\n  };\n}\n\n/** Hash a string into a numeric seed. */\nexport function hashSeed(str: string): number {\n  let h = 0;\n  for (let i = 0; i < str.length; i++) {\n    h = (Math.imul(31, h) + str.charCodeAt(i)) | 0;\n  }\n  return h >>> 0;\n}\n", "/**\n * Physics-based particle simulation.\n * NO PHYSICS ENGINE \u2014 simplified gravity + peg-collision model.\n *\n * Each particle carries:\n *   - Pre-computed 50/50 path  (mathematical truth, P(k)=C(n,k)(1/2)^n)\n *   - Live physics state        (x, y, vx, vy \u2014 unique kinetic drama)\n *\n * Collision model: normal-based reflection off circular peg surfaces.\n * The deflection direction emerges from geometry (collision normal),\n * NOT from artificial kick forces.\n *\n * Time authority: elapsedMs is set EXCLUSIVELY by the Web Worker timer.\n * The simulation never self-increments elapsed time.\n */\n\n// \u2500\u2500 Types \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface Particle {\n  path: number[];       // 0=left, 1=right at each peg row\n  bin: number;          // final bin = sum(path)\n  x: number;            // px\n  y: number;            // px\n  vx: number;           // px/s\n  vy: number;           // px/s\n  pegIndex: number;     // next peg row to interact with\n  settled: boolean;\n  jitter: number;       // [0,1) per-particle randomness seed\n}\n\nexport interface BoardGeom {\n  emitX: number;\n  emitY: number;\n  pegX: (row: number, index: number) => number;\n  pegY: (row: number) => number;\n  pegSpacing: number;\n  numRows: number;\n  accBottom: number;\n}\n\nexport interface SimConfig {\n  numRows: number;\n  totalParticles: number;\n  totalTimeSec: number;\n  rng: () => number;\n}\n\n// \u2500\u2500 Physics constants (tuning knobs \u2014 live-editable via Console) \u2500\u2500\n\nexport type PhysicsParams = {\n  restitution: number;    // coefficient of restitution (0 = perfectly inelastic, 1 = elastic)\n  restitutionRange: number; // per-particle random spread added to restitution\n  nudge: number;          // gentle position correction toward expected peg (0\u20130.15)\n  dragX: number;\n  dragY: number;\n  dragXSettle: number;\n  dragYSettle: number;\n  gravity: number;\n};\n\nexport const PRESETS: Record<string, PhysicsParams> = {\n  'Standard': {\n    restitution: 0.20, restitutionRange: 0.08,\n    nudge: 0.08,\n    dragX: 3.0, dragY: 1.5, dragXSettle: 6.0, dragYSettle: 3.0, gravity: 800,\n  },\n  'Heavy Sand': {\n    restitution: 0.01, restitutionRange: 0.02,\n    nudge: 0.10,\n    dragX: 6.0, dragY: 2.0, dragXSettle: 14.0, dragYSettle: 7.0, gravity: 1400,\n  },\n  'Techno': {\n    restitution: 0.0, restitutionRange: 0.0,\n    nudge: 0.15,\n    dragX: 10.0, dragY: 1.0, dragXSettle: 18.0, dragYSettle: 4.0, gravity: 1600,\n  },\n  'Moon Gravity': {\n    restitution: 0.08, restitutionRange: 0.03,\n    nudge: 0.12,\n    dragX: 2.0, dragY: 0.08, dragXSettle: 3.0, dragYSettle: 0.8, gravity: 50,\n  },\n  'Super Ball': {\n    restitution: 0.70, restitutionRange: 0.15,\n    nudge: 0.04,\n    dragX: 0.8, dragY: 0.4, dragXSettle: 2.5, dragYSettle: 1.2, gravity: 800,\n  },\n};\n\nexport const PHYSICS: PhysicsParams = { ...PRESETS['Standard'] };\n\n// \u2500\u2500 Helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction fract(x: number): number {\n  return x - Math.floor(x);\n}\n\n/**\n * Compute the smallest positive time for a particle at `y` with velocity `vy`\n * under constant gravity `g` to reach `targetY`.\n * Uses standard kinematics: y(t) = y + vy*t + 0.5*g*t\u00B2\n * Returns Infinity if the target is unreachable.\n */\nfunction timeToHit(y: number, vy: number, g: number, targetY: number): number {\n  const dy = targetY - y;\n  if (dy <= 0) return 0; // already at or past target\n\n  if (Math.abs(g) < 1e-6) {\n    // No gravity \u2014 linear: t = dy / vy\n    return vy > 1e-9 ? dy / vy : Infinity;\n  }\n\n  // Quadratic: 0.5*g*t\u00B2 + vy*t - dy = 0\n  const disc = vy * vy + 2 * g * dy;\n  if (disc < 0) return Infinity;\n\n  const sqrtDisc = Math.sqrt(disc);\n  const t1 = (-vy + sqrtDisc) / g;\n  const t2 = (-vy - sqrtDisc) / g;\n\n  // Return smallest positive root\n  let t = Infinity;\n  if (t1 > 1e-9) t = t1;\n  if (t2 > 1e-9 && t2 < t) t = t2;\n  return t;\n}\n\nexport function maxBinProbability(numRows: number): number {\n  const k = Math.floor(numRows / 2);\n  let logC = 0;\n  for (let i = 1; i <= numRows; i++) logC += Math.log(i);\n  for (let i = 1; i <= k; i++) logC -= Math.log(i);\n  for (let i = 1; i <= numRows - k; i++) logC -= Math.log(i);\n  return Math.exp(logC - numRows * Math.LN2);\n}\n\n// \u2500\u2500 Simulation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Effective peg collision radius as fraction of pegSpacing. */\nconst PEG_COLLISION_FRAC = 0.30;\n\nexport class Simulation {\n  readonly numRows: number;\n  readonly totalParticles: number;\n  totalTimeMs: number;\n\n  binCounts: number[];\n  activeParticles: Particle[] = [];\n  emittedCount = 0;\n  elapsedMs = 0;\n  allEmitted = false;\n  allSettled = false;\n\n  private rng: () => number;\n  emitIntervalMs: number;\n\n  constructor(cfg: SimConfig) {\n    this.numRows = cfg.numRows;\n    this.totalParticles = cfg.totalParticles;\n    this.totalTimeMs = cfg.totalTimeSec * 1000;\n    this.rng = cfg.rng;\n    this.binCounts = new Array(cfg.numRows + 1).fill(0);\n    this.emitIntervalMs = this.totalTimeMs / cfg.totalParticles;\n  }\n\n  /**\n   * Advance simulation. Returns newly-settled particles for baking.\n   *\n   * IMPORTANT: This method does NOT advance elapsedMs.\n   * elapsedMs is set exclusively by the Worker timer via setElapsedMs().\n   * Emission is derived from the current elapsedMs value.\n   */\n  update(\n    dtMs: number,\n    geom: BoardGeom,\n    getGroundY: (x: number) => number,\n  ): Particle[] {\n    const dt = Math.min(dtMs, 100) / 1000; // seconds, capped\n    const settled: Particle[] = [];\n\n    // \u2500\u2500 Emission (derived from Worker-authoritative elapsedMs) \u2500\u2500\n    if (!this.allEmitted) {\n      const expectedEmitted = Math.min(\n        this.totalParticles,\n        Math.floor(this.elapsedMs / this.emitIntervalMs),\n      );\n      const toEmit = expectedEmitted - this.emittedCount;\n      for (let i = 0; i < toEmit; i++) {\n        this.activeParticles.push(this.createParticle(geom));\n      }\n      if (this.emittedCount >= this.totalParticles) this.allEmitted = true;\n    }\n\n    // \u2500\u2500 Physics \u2500\u2500\n    const alive: Particle[] = [];\n    const halfBoard = geom.pegSpacing * (this.numRows / 2 + 1.5);\n    const pegR = geom.pegSpacing * PEG_COLLISION_FRAC;\n\n    for (const p of this.activeParticles) {\n      const g = PHYSICS.gravity;\n\n      // Drag (stronger in settling zone)\n      const settling = p.pegIndex >= this.numRows;\n      const dxCoeff = settling ? PHYSICS.dragXSettle : PHYSICS.dragX;\n      const dyCoeff = settling ? PHYSICS.dragYSettle : PHYSICS.dragY;\n      p.vx *= Math.exp(-dxCoeff * dt);\n      p.vy *= Math.exp(-dyCoeff * dt);\n\n      // \u2500\u2500 CCD sweep loop (quadratic \u2014 accounts for gravity during flight) \u2500\u2500\n      let remainDt = dt;\n      let didSettle = false;\n      const MAX_CCD_ITER = this.numRows + 2;\n\n      for (let iter = 0; iter < MAX_CCD_ITER && remainDt > 0; iter++) {\n        if (p.pegIndex < this.numRows) {\n          // \u2500\u2500 Peg zone \u2500\u2500\n          const pegRowY = geom.pegY(p.pegIndex);\n          const tHit = timeToHit(p.y, p.vy, g, pegRowY);\n\n          if (tHit > remainDt) {\n            p.x += p.vx * remainDt;\n            p.y += p.vy * remainDt + 0.5 * g * remainDt * remainDt;\n            p.vy += g * remainDt;\n            remainDt = 0;\n            break;\n          }\n\n          // Advance to exact collision point\n          p.x += p.vx * tHit;\n          p.vy += g * tHit;\n          p.y = pegRowY;\n          remainDt -= tHit;\n\n          // \u2500\u2500 Collision response \u2014 normal-based reflection \u2500\u2500\n          const dir = p.path[p.pegIndex];\n          const bj = fract(p.jitter * 997.0 + p.pegIndex * 7.31);\n\n          let hIdx = 0;\n          for (let i = 0; i < p.pegIndex; i++) hIdx += p.path[i];\n          const pegCX = geom.pegX(p.pegIndex, hIdx);\n\n          const nudge = PHYSICS.nudge;\n          p.x = p.x * (1 - nudge) + pegCX * nudge;\n\n          let dx = p.x - pegCX;\n          const minOff = pegR * (0.10 + 0.12 * bj);\n          if (dir === 1 && dx < minOff) dx = minOff;\n          if (dir === 0 && dx > -minOff) dx = -minOff;\n          dx = Math.max(-pegR, Math.min(pegR, dx));\n\n          const frac = dx / pegR;\n          const nx = frac;\n          const ny = -Math.sqrt(Math.max(0, 1 - frac * frac));\n\n          const vDotN = p.vx * nx + p.vy * ny;\n          if (vDotN < 0) {\n            const e = PHYSICS.restitution + PHYSICS.restitutionRange * bj;\n            p.vx -= (1 + e) * vDotN * nx;\n            p.vy -= (1 + e) * vDotN * ny;\n          }\n\n          p.pegIndex++;\n        } else {\n          // \u2500\u2500 Settling zone \u2014 CCD against ground \u2500\u2500\n          const groundY = getGroundY(p.x);\n          const tGround = timeToHit(p.y, p.vy, g, groundY);\n\n          if (tGround > remainDt) {\n            p.x += p.vx * remainDt;\n            p.y += p.vy * remainDt + 0.5 * g * remainDt * remainDt;\n            p.vy += g * remainDt;\n            remainDt = 0;\n            break;\n          }\n\n          // Hit ground\n          p.x += p.vx * tGround;\n          p.y = groundY;\n          p.settled = true;\n          this.binCounts[p.bin]++;\n          settled.push(p);\n          didSettle = true;\n          break;\n        }\n      }\n\n      if (didSettle) continue;\n      p.x = Math.max(geom.emitX - halfBoard, Math.min(geom.emitX + halfBoard, p.x));\n      alive.push(p);\n    }\n\n    this.activeParticles = alive;\n    if (this.allEmitted && alive.length === 0) this.allSettled = true;\n\n    return settled;\n  }\n\n  getRemainingTimeSec(): number {\n    return Math.max(0, (this.totalTimeMs - this.elapsedMs) / 1000);\n  }\n\n  /**\n   * Set elapsed time from Worker tick.\n   * This is the SOLE source of truth for elapsed time.\n   */\n  setElapsedMs(ms: number): void {\n    this.elapsedMs = ms;\n  }\n\n  /** Add time to total duration and recalculate emission interval. */\n  addTime(ms: number): void {\n    this.totalTimeMs += ms;\n    this.emitIntervalMs = this.totalTimeMs / this.totalParticles;\n  }\n\n  /**\n   * Instant-snap: emit all particles that SHOULD have been emitted by now\n   * (based on current elapsedMs) but weren't. Skip physics; settle immediately.\n   * Used after tab-hidden restore when elapsedMs has advanced but update() didn't run.\n   */\n  instantSnap(geom: BoardGeom): Particle[] {\n    const expectedEmitted = Math.min(\n      this.totalParticles,\n      Math.floor(this.elapsedMs / this.emitIntervalMs),\n    );\n    const toEmit = expectedEmitted - this.emittedCount;\n    if (toEmit <= 0) return [];\n\n    const settled: Particle[] = [];\n    for (let i = 0; i < toEmit; i++) {\n      const p = this.createParticle(geom);\n      p.settled = true;\n      p.pegIndex = this.numRows;\n      this.binCounts[p.bin]++;\n      settled.push(p);\n    }\n\n    if (this.emittedCount >= this.totalParticles) this.allEmitted = true;\n    return settled;\n  }\n\n  /**\n   * Force-settle all active (in-flight) particles immediately.\n   * Returns them for baking. Used when restoring from hidden tab.\n   */\n  forceSettleActive(): Particle[] {\n    const settled: Particle[] = [];\n    for (const p of this.activeParticles) {\n      p.settled = true;\n      p.pegIndex = this.numRows;\n      this.binCounts[p.bin]++;\n      settled.push(p);\n    }\n    this.activeParticles = [];\n    return settled;\n  }\n\n  /** Reset simulation to initial state \u2014 all particles removed, counters zeroed. */\n  reset(): void {\n    this.activeParticles = [];\n    this.binCounts.fill(0);\n    this.emittedCount = 0;\n    this.elapsedMs = 0;\n    this.allEmitted = false;\n    this.allSettled = false;\n  }\n\n  private createParticle(geom: BoardGeom): Particle {\n    const path: number[] = [];\n    let bin = 0;\n    for (let i = 0; i < this.numRows; i++) {\n      const d = this.rng() < 0.5 ? 0 : 1;\n      path.push(d);\n      bin += d;\n    }\n    this.emittedCount++;\n    return {\n      path,\n      bin,\n      x: geom.emitX,\n      y: geom.emitY,\n      vx: 0,\n      vy: 0,\n      pegIndex: 0,\n      settled: false,\n      jitter: this.rng(),\n    };\n  }\n}\n", "/**\n * Seven-segment neon clock renderer.\n *\n * Segment layout:\n *   \u2500a\u2500\n *  \u2502   \u2502\n *  f   b\n *  \u2502   \u2502\n *   \u2500g\u2500\n *  \u2502   \u2502\n *  e   c\n *  \u2502   \u2502\n *   \u2500d\u2500\n *\n * Rendering: no shadowBlur. Glow via multi-pass overlay at scaled width.\n * Ultra-thin segments \u2014 glow is the star, core is the whisper.\n */\n\n// \u2500\u2500 Segment map: [a,b,c,d,e,f,g] per digit 0-9 \u2500\u2500\n\nexport const DIGIT_SEGMENTS: boolean[][] = [\n  [true,  true,  true,  true,  true,  true,  false], // 0\n  [false, true,  true,  false, false, false, false], // 1\n  [true,  true,  false, true,  true,  false, true],  // 2\n  [true,  true,  true,  true,  false, false, true],  // 3\n  [false, true,  true,  false, false, true,  true],  // 4\n  [true,  false, true,  true,  false, true,  true],  // 5\n  [true,  false, true,  true,  true,  true,  true],  // 6\n  [true,  true,  true,  false, false, false, false], // 7\n  [true,  true,  true,  true,  true,  true,  true],  // 8\n  [true,  true,  true,  true,  false, true,  true],  // 9\n];\n\n// \u2500\u2500 Theme interface \u2500\u2500\n\nexport interface ClockTheme {\n  name: string;\n  segmentRGB: [number, number, number];\n  grainRGB: [number, number, number];\n  glowIntensity: number;\n}\n\nexport const CLOCK_THEMES: ClockTheme[] = [\n  { name: 'Nixie',  segmentRGB: [255, 147, 41],  grainRGB: [255, 180, 100], glowIntensity: 1.2 },\n  { name: 'System', segmentRGB: [0, 255, 65],     grainRGB: [120, 255, 140], glowIntensity: 0.8 },\n  { name: 'Studio', segmentRGB: [220, 220, 230],  grainRGB: [230, 230, 240], glowIntensity: 1.0 },\n  { name: 'Cyber',  segmentRGB: [0, 150, 255],    grainRGB: [80, 180, 255],  glowIntensity: 1.0 },\n];\n\nexport function getThemeByName(name: string): ClockTheme {\n  const lower = name.toLowerCase();\n  return CLOCK_THEMES.find(t => t.name.toLowerCase() === lower) || CLOCK_THEMES[0];\n}\n\n// \u2500\u2500 Segment geometry helpers \u2500\u2500\n\nfunction drawSegmentPath(\n  ctx: CanvasRenderingContext2D,\n  x: number, y: number,\n  w: number, h: number,\n  segIndex: number,\n  thickness: number,\n): void {\n  const ht = thickness / 2;\n  const margin = thickness * 0.3;\n\n  let sx: number, sy: number, len: number, horizontal: boolean;\n\n  switch (segIndex) {\n    case 0: sx = x + margin; sy = y; len = w - margin * 2; horizontal = true; break;\n    case 1: sx = x + w; sy = y + margin; len = h / 2 - margin * 2; horizontal = false; break;\n    case 2: sx = x + w; sy = y + h / 2 + margin; len = h / 2 - margin * 2; horizontal = false; break;\n    case 3: sx = x + margin; sy = y + h; len = w - margin * 2; horizontal = true; break;\n    case 4: sx = x; sy = y + h / 2 + margin; len = h / 2 - margin * 2; horizontal = false; break;\n    case 5: sx = x; sy = y + margin; len = h / 2 - margin * 2; horizontal = false; break;\n    case 6: sx = x + margin; sy = y + h / 2; len = w - margin * 2; horizontal = true; break;\n    default: return;\n  }\n\n  if (horizontal) {\n    ctx.moveTo(sx, sy);\n    ctx.lineTo(sx + ht, sy - ht);\n    ctx.lineTo(sx + len - ht, sy - ht);\n    ctx.lineTo(sx + len, sy);\n    ctx.lineTo(sx + len - ht, sy + ht);\n    ctx.lineTo(sx + ht, sy + ht);\n    ctx.closePath();\n  } else {\n    ctx.moveTo(sx, sy);\n    ctx.lineTo(sx - ht, sy + ht);\n    ctx.lineTo(sx - ht, sy + len - ht);\n    ctx.lineTo(sx, sy + len);\n    ctx.lineTo(sx + ht, sy + len - ht);\n    ctx.lineTo(sx + ht, sy + ht);\n    ctx.closePath();\n  }\n}\n\n// \u2500\u2500 Public drawing functions \u2500\u2500\n\nexport function drawDigit(\n  ctx: CanvasRenderingContext2D,\n  x: number, y: number,\n  w: number, h: number,\n  segments: boolean[],\n  rgb: [number, number, number],\n  glowIntensity: number,\n): void {\n  // Ultra-thin core \u2014 glow is the protagonist\n  const thickness = Math.max(1.2, w * 0.07);\n\n  // 6 glow passes: outer 2 softer, inner 4 hotter\n  const glowScales = [5.5, 4.5, 3.5, 2.8, 2.2, 1.8];\n  const glowAlphaFactors = [0.5, 0.7, 1.0, 1.0, 1.2, 1.2];\n\n  for (let s = 0; s < 7; s++) {\n    if (segments[s]) {\n      const glowAlpha = 0.09 * glowIntensity;\n      for (let pass = 0; pass < 6; pass++) {\n        ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${(glowAlpha * glowAlphaFactors[pass]).toFixed(4)})`;\n        ctx.beginPath();\n        drawSegmentPath(ctx, x, y, w, h, s, thickness * glowScales[pass]);\n        ctx.fill();\n      }\n\n      // Core: crisp thin line\n      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},0.85)`;\n      ctx.beginPath();\n      drawSegmentPath(ctx, x, y, w, h, s, thickness);\n      ctx.fill();\n    } else {\n      // Off segment: barely-there ghost\n      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},0.02)`;\n      ctx.beginPath();\n      drawSegmentPath(ctx, x, y, w, h, s, thickness);\n      ctx.fill();\n    }\n  }\n}\n\n/**\n * Draw a colon (two dots) between digit groups.\n */\nfunction drawColon(\n  ctx: CanvasRenderingContext2D,\n  x: number, y: number,\n  dotR: number,\n  rgb: [number, number, number],\n  glowIntensity: number,\n  digitH: number,\n): void {\n  const topY = y - digitH * 0.20;\n  const botY = y + digitH * 0.20;\n  const alpha = 0.4;\n\n  // Glow passes\n  const glowAlpha = 0.09 * glowIntensity;\n  for (const dy of [topY, botY]) {\n    for (let pass = 0; pass < 3; pass++) {\n      const scale = [3.0, 2.2, 1.6][pass];\n      const factor = [0.6, 0.9, 1.1][pass];\n      ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${(glowAlpha * factor).toFixed(4)})`;\n      ctx.beginPath();\n      ctx.arc(x, dy, dotR * scale, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    // Core dot\n    ctx.fillStyle = `rgba(${rgb[0]},${rgb[1]},${rgb[2]},${alpha})`;\n    ctx.beginPath();\n    ctx.arc(x, dy, dotR, 0, Math.PI * 2);\n    ctx.fill();\n  }\n}\n\n/**\n * Draw clock centered at (cx, cy).\n * With centiseconds: MM : SS : CC (6 digits + colons)\n * Without centiseconds: MM : SS or HH : MM : SS (colons included)\n */\nexport function drawClock(\n  ctx: CanvasRenderingContext2D,\n  totalSec: number,\n  cx: number, cy: number,\n  digitH: number,\n  theme: ClockTheme,\n  centiseconds?: number,\n): void {\n  const hh = Math.floor(totalSec / 3600);\n  const mm = Math.floor((totalSec % 3600) / 60);\n  const ss = Math.floor(totalSec % 60);\n\n  const digitW = digitH * 0.50;\n  const pairGap = digitW * 0.35;    // luxurious intra-pair kerning\n  const groupGap = digitW * 1.3;    // wide group separation \u2014 colon breathes\n\n  const rgb = theme.segmentRGB;\n  const glow = theme.glowIntensity;\n\n  // Determine groups\n  let groups: number[][];\n  if (centiseconds !== undefined) {\n    // MM : SS : CC\n    groups = [\n      [Math.floor(mm / 10), mm % 10],\n      [Math.floor(ss / 10), ss % 10],\n      [Math.floor(centiseconds / 10), centiseconds % 10],\n    ];\n  } else if (hh > 0) {\n    // HH : MM : SS\n    groups = [\n      [Math.floor(hh / 10), hh % 10],\n      [Math.floor(mm / 10), mm % 10],\n      [Math.floor(ss / 10), ss % 10],\n    ];\n  } else {\n    // MM : SS\n    groups = [\n      [Math.floor(mm / 10), mm % 10],\n      [Math.floor(ss / 10), ss % 10],\n    ];\n  }\n\n  const numGroups = groups.length;\n  const pairW = digitW * 2 + pairGap;\n  const totalW = pairW * numGroups + groupGap * (numGroups - 1);\n  const startX = cx - totalW / 2;\n  const startY = cy - digitH / 2;\n\n  let dx = startX;\n  const dotR = Math.max(1.2, digitW * 0.08);\n\n  for (let g = 0; g < numGroups; g++) {\n    const [d1, d2] = groups[g];\n    drawDigit(ctx, dx, startY, digitW, digitH, DIGIT_SEGMENTS[d1], rgb, glow);\n    dx += digitW + pairGap;\n    drawDigit(ctx, dx, startY, digitW, digitH, DIGIT_SEGMENTS[d2], rgb, glow);\n    dx += digitW;\n\n    // Draw colon between groups\n    if (g < numGroups - 1) {\n      const colonX = dx + groupGap / 2;\n      drawColon(ctx, colonX, cy, dotR, rgb, glow, digitH);\n      dx += groupGap;\n    }\n  }\n}\n", "/**\n * Pure geometry \u2014 no canvas, no DOM.\n * Layout computation, peg coordinates, hopper grain positions, stack jitter.\n */\n\nimport { maxBinProbability } from './simulation';\n\nexport const SQRT3_2 = Math.sqrt(3) / 2;\n\n// \u2500\u2500 Layout \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport interface Layout {\n  width: number;\n  height: number;\n  dpr: number;\n  centerX: number;\n  contentW: number;\n\n  // Hopper (funnel: rect top + trapezoid bottom)\n  hopperTop: number;\n  hopperJunction: number;  // rect\u2192trapezoid seam\n  hopperBottom: number;    // nozzle exit\n  hopperRectHW: number;    // half-width of rect section\n  hopperTopHW: number;     // alias for hopperRectHW\n  nozzleHW: number;        // half-width at nozzle (= gridTopHW)\n  hopperSigma: number;     // sigma in peg-spacing units for Gaussian envelope\n\n  // Board\n  emitY: number;\n  boardTop: number;\n  boardBottom: number;\n\n  // Accumulation\n  accTop: number;\n  accBottom: number;\n  accHeight: number;\n\n  // Inline timer\n  inlineTimerY: number;\n\n  // Sizing\n  pegSpacing: number;\n  rowSpacingY: number;\n  numRows: number;\n  pegRadius: number;\n  grainRadius: number;\n  settledDiameter: number;\n  settledRadius: number;\n  stackScale: number;\n  stackRowH: number;     // rendering row height for stacks (normalized)\n  miniGrainR: number;    // tiny dot radius for hopper + stack texture\n}\n\nexport function computeLayout(\n  w: number,\n  h: number,\n  dpr: number,\n  numRows: number,\n  totalParticles: number,\n): Layout {\n  const centerX = w / 2;\n  const marginX = w * 0.15;\n  const contentW = w - marginX * 2;\n\n  // \u2500\u2500 Safe zones \u2500\u2500\n  // topMargin and bottomMargin are INVIOLABLE \u2014 stacks never cross bottomMargin.\n  const topMargin = h * 0.05;\n  const bottomMargin = h * 0.15;\n  const safeH = h - topMargin - bottomMargin;\n\n  // \u2500\u2500 Grid sizing \u2500\u2500\n  const dxFromWidth = contentW / (numRows + 2);\n\n  const inlineTimerH = h * 0.06;\n  const gapBudget = h * 0.03;\n  const availableForSystem = safeH - inlineTimerH - gapBudget;\n\n  const boardH_target = availableForSystem * 3 / 5;\n  const dxFromRatio = numRows > 1\n    ? boardH_target / ((numRows - 1) * SQRT3_2)\n    : dxFromWidth;\n\n  const pegSpacing = Math.min(dxFromWidth, dxFromRatio);\n  const rowSpacingY = pegSpacing * SQRT3_2;\n  const boardH = numRows > 1 ? (numRows - 1) * rowSpacingY : 0;\n\n  // \u2500\u2500 Universal grain radius \u2500\u2500\n  const grainRadius = Math.max(1.2, Math.min(3.5, pegSpacing * 0.09));\n  const pegRadius = Math.max(1.5, Math.min(5.0, pegSpacing * 0.12));\n\n  // \u2500\u2500 Hopper dimensions \u2500\u2500\n  const nozzleHW = pegSpacing * 0.8;\n  const gridHW = (numRows * pegSpacing) / 2;\n  const hopperTopHW = Math.max(pegSpacing * 4, gridHW * 1.3);\n  const hopperRectHW = hopperTopHW;\n\n  const taperH = Math.max(boardH / 3, pegSpacing * 2.5);\n\n  // \u2500\u2500 Gaps \u2500\u2500\n  const hopperToGrid = Math.max(pegSpacing * 0.6, h * 0.012);\n  const gridToAcc = Math.max(pegSpacing * 0.7, h * 0.015);\n\n  // \u2500\u2500 Accumulation: bottom-anchored \u2500\u2500\n  // accBottom is FIXED at the UI buffer line. Stacks grow upward from here.\n  const accBottom = h - bottomMargin;\n\n  // Compute how much space the hopper + grid consume above stacks\n  const aboveAccH = inlineTimerH + taperH + hopperToGrid + boardH + gridToAcc;\n\n  // accHeight gets whatever remains, capped at boardH/2 to keep proportions sane\n  const accHeight_available = safeH - aboveAccH;\n  const accHeight = Math.max(pegSpacing * 2, Math.min(accHeight_available, boardH / 2));\n\n  // \u2500\u2500 Accumulation grain sizing \u2500\u2500\n  const maxProb = maxBinProbability(numRows);\n  const maxBinCount = maxProb * totalParticles * 1.15;\n\n  // \u2500\u2500 Position everything bottom-up from the anchor \u2500\u2500\n  const accTop = accBottom - accHeight;\n  const boardBottom = accTop - gridToAcc;\n  const boardTopY = boardBottom - boardH;\n  const hopperBottom = boardTopY - hopperToGrid;\n  const hopperTop = hopperBottom - taperH;\n  const hopperJunction = hopperTop;\n  const emitY = hopperBottom + hopperToGrid * 0.55;\n  // Inline timer sits above hopper; clamp so it never overlaps or goes off-screen\n  const inlineTimerY = Math.max(topMargin + inlineTimerH * 0.5, hopperTop - inlineTimerH * 0.6);\n\n  const stackScale = (accHeight * 0.85) / (maxProb * totalParticles);\n\n  // Stack rendering: row height normalized so peak bin \u2264 accHeight * 0.95\n  const d_natural = grainRadius * 1.6;\n  const rowH_natural = d_natural * SQRT3_2;\n  const peakCeiling = accHeight * 0.95;\n  const stackRowH = maxBinCount > 0\n    ? Math.min(rowH_natural, peakCeiling / maxBinCount)\n    : rowH_natural;\n\n  // Mini-grain radius: smaller than falling particles, used for hopper + stack texture\n  const miniGrainR = Math.max(0.8, grainRadius * 0.55);\n\n  // \u2500\u2500 Vertical centering \u2500\u2500\n  let finalHopperTop = hopperTop;\n  let finalHopperJunction = hopperJunction;\n  let finalHopperBottom = hopperBottom;\n  let finalEmitY = emitY;\n  let finalBoardTop = boardTopY;\n  let finalBoardBottom = boardBottom;\n  let finalAccTop = accTop;\n  let finalAccBottom = accBottom;\n  let finalInlineTimerY = inlineTimerY;\n\n  const contentTop = finalInlineTimerY - inlineTimerH * 0.5;\n  const contentBottom = finalAccBottom;\n  const totalContentH = contentBottom - contentTop;\n\n  const idealOffsetY = (h - totalContentH) / 2 - contentTop;\n\n  const uiSafeBottom = h * 0.12;\n  const maxOffset = (h - uiSafeBottom) - finalAccBottom;\n  const minOffset = topMargin - contentTop;\n  const offsetY = Math.max(minOffset, Math.min(idealOffsetY, maxOffset));\n\n  finalHopperTop += offsetY;\n  finalHopperJunction += offsetY;\n  finalHopperBottom += offsetY;\n  finalEmitY += offsetY;\n  finalBoardTop += offsetY;\n  finalBoardBottom += offsetY;\n  finalAccTop += offsetY;\n  finalAccBottom += offsetY;\n  finalInlineTimerY += offsetY;\n\n  return {\n    width: w, height: h, dpr, centerX, contentW,\n    hopperTop: finalHopperTop,\n    hopperJunction: finalHopperJunction,\n    hopperBottom: finalHopperBottom,\n    hopperRectHW, hopperTopHW: hopperRectHW, nozzleHW,\n    hopperSigma: taperH * 0.47 / pegSpacing,\n    emitY: finalEmitY,\n    boardTop: finalBoardTop, boardBottom: finalBoardBottom,\n    accTop: finalAccTop, accBottom: finalAccBottom, accHeight,\n    inlineTimerY: finalInlineTimerY,\n    pegSpacing, rowSpacingY, numRows, pegRadius,\n    grainRadius, settledDiameter: stackRowH,\n    settledRadius: stackRowH / 2,\n    stackScale,\n    stackRowH,\n    miniGrainR,\n  };\n}\n\n// \u2500\u2500 Peg coordinates (pure functions) \u2500\u2500\n\nexport function pegX(L: Layout, row: number, index: number): number {\n  return L.centerX + (index - row / 2) * L.pegSpacing;\n}\n\nexport function pegY(L: Layout, row: number): number {\n  return L.boardTop + row * L.rowSpacingY;\n}\n\n// \u2500\u2500 Gaussian half-width for inverted bell-curve hopper \u2500\u2500\n\nexport function gaussianHW(y: number, L: Layout): number {\n  const totalH = L.hopperBottom - L.hopperTop;\n  if (totalH <= 0) return L.nozzleHW;\n  const t = Math.max(0, Math.min(1, (L.hopperBottom - y) / totalH)); // 0=bottom, 1=top\n  const sigPx = L.hopperSigma * L.pegSpacing;\n  const d = t * totalH;\n  const gaussVal = 1 - Math.exp(-(d * d) / (2 * sigPx * sigPx));\n  return L.nozzleHW + (L.hopperTopHW - L.nozzleHW) * gaussVal;\n}\n\n// \u2500\u2500 Hopper grain positions (hex-packed, bottom-up) \u2500\u2500\n\nexport interface HopperGrain {\n  x: number;\n  y: number;\n}\n\nexport function computeHopperGrains(\n  L: Layout,\n  totalCount: number,\n  grainR: number,\n): HopperGrain[] {\n  const grains: HopperGrain[] = [];\n  const d = grainR * 2.1;\n  const rowH = d * SQRT3_2;\n  const cx = L.centerX;\n  const trapH = L.hopperBottom - L.hopperJunction;\n\n  let row = 0;\n  let y = L.hopperBottom - grainR * 1.5;\n\n  while (grains.length < totalCount) {\n    const hw = gaussianHW(y, L);\n\n    const usableW = hw * 0.88;\n    const xOff = (row % 2 === 1) ? d * 0.5 : 0;\n    const nCols = Math.max(1, Math.floor((usableW * 2) / d));\n\n    for (let c = 0; c < nCols && grains.length < totalCount; c++) {\n      const gx = cx - usableW + xOff + c * d + grainR;\n      const seed = (row * 1009 + c * 7919 + 31337) & 0x7fffffff;\n      const jx = ((seed % 1000) / 1000 - 0.5) * grainR * 0.5;\n      const jy = (((seed * 1103515245 + 12345) & 0x7fffffff) % 1000 / 1000 - 0.5) * grainR * 0.4;\n      grains.push({ x: gx + jx, y: y + jy });\n    }\n\n    y -= rowH;\n    row++;\n  }\n\n  return grains;\n}\n\n// \u2500\u2500 Deterministic jitter for stack grains \u2500\u2500\n\nexport function stackJitterX(bin: number, k: number, maxJitter: number): number {\n  const hash = ((bin * 2654435761 + k * 340573321) >>> 0) & 0x7fffffff;\n  return (hash % 10000 / 10000 - 0.5) * 2 * maxJitter;\n}\n\nexport function stackJitterY(bin: number, k: number, maxJitter: number): number {\n  const hash = ((bin * 1103515245 + k * 1299709) >>> 0) & 0x7fffffff;\n  return (hash % 10000 / 10000 - 0.5) * 2 * maxJitter;\n}\n", "/**\n * GrainRenderer \u2014 owns both canvases + all grain/peg/hopper drawing.\n *\n * Architecture:\n *   staticCanvas  \u2014 settled grains baked once, never redrawn per frame.\n *   dynamicCanvas \u2014 moving particles, pegs, hopper grains, UI \u2014 cleared each frame.\n */\n\nimport type { Particle } from './simulation';\nimport type { ClockTheme } from './seven-seg';\nimport {\n  Layout, HopperGrain,\n  pegX, pegY,\n  stackJitterX, stackJitterY,\n  computeHopperGrains,\n  gaussianHW,\n} from './layout';\n\nconst PI2 = Math.PI * 2;\n\n// \u2500\u2500 Unified grain appearance \u2500\u2500\nconst GRAIN_ALPHA = 0.85;          // moving particles\nconst GRAIN_GLOW_ALPHA = 0.06;\nconst GRAIN_GLOW_SCALE = 2.5;\nconst STATIC_GRAIN_ALPHA = 1.0;    // baked stack grains \u2014 fully opaque to prevent accumulation\n\nexport class GrainRenderer {\n  readonly staticCanvas: HTMLCanvasElement;\n  readonly dynamicCanvas: HTMLCanvasElement;\n  readonly sCtx: CanvasRenderingContext2D;\n  readonly dCtx: CanvasRenderingContext2D;\n\n  /** Per-bin settled grain counts. */\n  private binCounts: number[];\n\n  /** Hopper grain positions (pre-computed). */\n  private hopperGrainCache: HopperGrain[] = [];\n\n  // \u2500\u2500 Purge drain animation \u2500\u2500\n  private purgeOffsets: number[] = [];\n  private purgeVelocities: number[] = [];\n  private purgeDelays: number[] = [];\n  private purgeAlphas: number[] = [];\n  private purging = false;\n\n  // \u2500\u2500 Grain colors \u2500\u2500\n  private grainCoreFill = '';\n  private grainGlowFill = '';\n  private staticGrainFill = '';    // opaque \u2014 for baked stack grains\n\n  constructor(container: HTMLElement) {\n    this.staticCanvas = document.createElement('canvas');\n    this.dynamicCanvas = document.createElement('canvas');\n    for (const c of [this.staticCanvas, this.dynamicCanvas]) {\n      c.style.position = 'absolute';\n      c.style.top = '0';\n      c.style.left = '0';\n      container.appendChild(c);\n    }\n    this.sCtx = this.staticCanvas.getContext('2d')!;\n    this.dCtx = this.dynamicCanvas.getContext('2d')!;\n    this.binCounts = [];\n  }\n\n  updateGrainColors(theme: ClockTheme): void {\n    const [r, g, b] = theme.grainRGB;\n    this.grainCoreFill = `rgba(${r},${g},${b},${GRAIN_ALPHA})`;\n    this.grainGlowFill = `rgba(${r},${g},${b},${GRAIN_GLOW_ALPHA})`;\n    this.staticGrainFill = `rgba(${r},${g},${b},${STATIC_GRAIN_ALPHA})`;\n  }\n\n  applyLayout(L: Layout, totalParticles: number): void {\n    const w = L.width;\n    const h = L.height;\n    const dpr = L.dpr;\n\n    for (const c of [this.staticCanvas, this.dynamicCanvas]) {\n      c.width = w * dpr;\n      c.height = h * dpr;\n      c.style.width = w + 'px';\n      c.style.height = h + 'px';\n    }\n    this.sCtx.setTransform(dpr, 0, 0, dpr, 0, 0);\n    this.dCtx.setTransform(dpr, 0, 0, dpr, 0, 0);\n\n    this.binCounts = new Array(L.numRows + 1).fill(0);\n    this.sCtx.clearRect(0, 0, w, h);\n\n    this.hopperGrainCache = computeHopperGrains(L, totalParticles, L.miniGrainR);\n  }\n\n  getBinCounts(): number[] {\n    return this.binCounts;\n  }\n\n  // \u2500\u2500 Baking \u2014 grain with slot-width X jitter \u2500\u2500\n\n  bakeParticle(L: Layout, p: Particle): void {\n    const bin = p.bin;\n    this.binCounts[bin]++;\n    const count = this.binCounts[bin];\n\n    const binX = pegX(L, L.numRows - 1, bin);\n    const mr = L.miniGrainR;\n    const d = mr * 2.1;\n    const rowH = L.stackRowH;\n    const maxJitterX = Math.min(4, mr * 2.5);\n    const maxJitterY = rowH * 0.18;\n    const hexOff = (count % 2 === 0) ? d * 0.5 : 0;\n    const jx = stackJitterX(bin, count, maxJitterX);\n    const jy = stackJitterY(bin, count, maxJitterY);\n    const grainX = binX + hexOff + jx;\n    const grainY = L.accBottom - (count - 0.5) * rowH + jy;\n\n    const ctx = this.sCtx;\n    ctx.fillStyle = this.staticGrainFill;\n    ctx.beginPath();\n    ctx.arc(grainX, grainY, mr, 0, PI2);\n    ctx.fill();\n  }\n\n  /** Rebake all settled grains with current grain color. */\n  rebakeStatic(L: Layout, _theme: ClockTheme): void {\n    if (!L) return;\n    this.sCtx.clearRect(0, 0, L.width, L.height);\n    const mr = L.miniGrainR;\n    const d = mr * 2.1;\n    const rowH = L.stackRowH;\n    const maxJitterX = Math.min(4, mr * 2.5);\n    const maxJitterY = rowH * 0.18;\n\n    this.sCtx.fillStyle = this.staticGrainFill;\n\n    // Opaque grain circles only \u2014 no column fills\n    this.sCtx.beginPath();\n    for (let bin = 0; bin <= L.numRows; bin++) {\n      const binX = pegX(L, L.numRows - 1, bin);\n      for (let k = 1; k <= this.binCounts[bin]; k++) {\n        const hexOff = (k % 2 === 0) ? d * 0.5 : 0;\n        const jx = stackJitterX(bin, k, maxJitterX);\n        const jy = stackJitterY(bin, k, maxJitterY);\n        const gx = binX + hexOff + jx;\n        const gy = L.accBottom - (k - 0.5) * rowH + jy;\n        this.sCtx.moveTo(gx + mr, gy);\n        this.sCtx.arc(gx, gy, mr, 0, PI2);\n      }\n    }\n    this.sCtx.fill();\n  }\n\n  drawHopper(\n    ctx: CanvasRenderingContext2D,\n    L: Layout,\n    emitted: number,\n    total: number,\n  ): void {\n    const cx = L.centerX;\n\n    ctx.save();\n\n    // \u2500\u2500 Funnel outline (Gaussian curve) \u2500\u2500\n    const visTop = Math.max(0, L.hopperTop);\n    ctx.strokeStyle = 'rgba(255,255,255,0.08)';\n    ctx.lineWidth = 0.5;\n    const nSamples = 40;\n    ctx.beginPath();\n    // Right edge top\u2192bottom\n    for (let i = 0; i <= nSamples; i++) {\n      const y = visTop + (L.hopperBottom - visTop) * (i / nSamples);\n      const hw = gaussianHW(y, L);\n      if (i === 0) ctx.moveTo(cx + hw, y);\n      else ctx.lineTo(cx + hw, y);\n    }\n    // Left edge bottom\u2192top\n    for (let i = nSamples; i >= 0; i--) {\n      const y = visTop + (L.hopperBottom - visTop) * (i / nSamples);\n      const hw = gaussianHW(y, L);\n      ctx.lineTo(cx - hw, y);\n    }\n    ctx.closePath();\n    ctx.stroke();\n\n    // \u2500\u2500 Grain fill: parabolic surface clipping \u2500\u2500\n    // Instead of drawing first N grains, we compute a U-shaped \"water surface\"\n    // that drops as grains are emitted. Only grains below the surface are drawn.\n    const remaining = Math.max(0, total - emitted);\n    const cacheLen = this.hopperGrainCache.length;\n\n    if (remaining > 0 && cacheLen > 0) {\n      const r = L.miniGrainR;\n      const ratio = remaining / total;  // 1.0 = full, 0.0 = empty\n\n      // Surface line: surfaceY(x) defines the top of the sand at horizontal position x.\n      // As ratio decreases, the surface drops (surfaceY increases = lower on screen).\n      // The center drops faster than edges \u2192 U-shape (parabolic).\n      const hopperH = L.hopperBottom - L.hopperTop;\n      const topHW = L.hopperTopHW;\n\n      // baseLevel: overall surface height. At ratio=1 it's above the hopper top;\n      // at ratio=0 it's below the hopper bottom.\n      const baseLevel = L.hopperTop + hopperH * (1 - ratio) * 1.15;\n\n      // Bowl depth: how much deeper the center is compared to edges.\n      // Increases as sand depletes (more dramatic U-shape).\n      const bowlDepth = hopperH * 0.35 * (1 - ratio);\n\n      // Glow pass (batched)\n      ctx.fillStyle = this.grainGlowFill;\n      ctx.beginPath();\n      for (let i = 0; i < cacheLen; i++) {\n        const g = this.hopperGrainCache[i];\n        if (g.y < -r * 3) continue;\n        // Normalized horizontal offset from center: 0=center, 1=edge\n        const off = Math.min(1, Math.abs(g.x - cx) / topHW);\n        // Parabolic surface: center is deeper (higher Y), edges are higher (lower Y)\n        const surfaceY = baseLevel - bowlDepth * (off * off);\n        if (g.y < surfaceY) continue;  // grain is above surface \u2192 hidden\n        ctx.moveTo(g.x + r * GRAIN_GLOW_SCALE, g.y);\n        ctx.arc(g.x, g.y, r * GRAIN_GLOW_SCALE, 0, PI2);\n      }\n      ctx.fill();\n\n      // Core pass (batched)\n      ctx.fillStyle = this.grainCoreFill;\n      ctx.beginPath();\n      for (let i = 0; i < cacheLen; i++) {\n        const g = this.hopperGrainCache[i];\n        if (g.y < -r) continue;\n        const off = Math.min(1, Math.abs(g.x - cx) / topHW);\n        const surfaceY = baseLevel - bowlDepth * (off * off);\n        if (g.y < surfaceY) continue;\n        ctx.moveTo(g.x + r, g.y);\n        ctx.arc(g.x, g.y, r, 0, PI2);\n      }\n      ctx.fill();\n    }\n\n    // \u2500\u2500 Nozzle stream \u2500\u2500\n    if (remaining > 0) {\n      const now = performance.now();\n      const r = L.miniGrainR;\n      // Fewer stream dots when only a few grains remain\n      const streamCount = remaining < 10 ? Math.max(1, Math.ceil(remaining / 3)) : 4;\n      for (let i = 0; i < streamCount; i++) {\n        const phase = ((now * 0.003 + i * 0.25) % 1);\n        const sy = L.hopperBottom + (L.emitY - L.hopperBottom) * phase;\n        ctx.globalAlpha = 0.4 * (1 - phase * 0.8);\n        ctx.fillStyle = this.grainCoreFill;\n        ctx.beginPath();\n        ctx.arc(cx, sy, r * 0.7, 0, PI2);\n        ctx.fill();\n      }\n    }\n\n    ctx.restore();\n  }\n\n  drawPegs(ctx: CanvasRenderingContext2D, L: Layout, theme: ClockTheme, pegAlphaOverride?: number): void {\n    const [pr, pg, pb] = theme.segmentRGB;\n    const alpha = pegAlphaOverride !== undefined ? pegAlphaOverride : 0.15;\n    // Blend theme color with gray(180). When alpha is high (alarm flash), use more theme color.\n    const themeWeight = (pegAlphaOverride !== undefined && pegAlphaOverride > 0.5) ? 0.6 : 0.3;\n    const grayWeight = 1 - themeWeight;\n    const blendR = Math.round(pr * themeWeight + 180 * grayWeight);\n    const blendG = Math.round(pg * themeWeight + 180 * grayWeight);\n    const blendB = Math.round(pb * themeWeight + 180 * grayWeight);\n    ctx.fillStyle = `rgba(${blendR},${blendG},${blendB},${alpha.toFixed(3)})`;\n    ctx.beginPath();\n    for (let row = 0; row < L.numRows; row++) {\n      for (let j = 0; j <= row; j++) {\n        const x = pegX(L, row, j);\n        const y = pegY(L, row);\n        ctx.moveTo(x + L.pegRadius, y);\n        ctx.arc(x, y, L.pegRadius, 0, PI2);\n      }\n    }\n    ctx.fill();\n  }\n\n  drawParticles(\n    ctx: CanvasRenderingContext2D,\n    L: Layout,\n    particles: Particle[],\n  ): void {\n    if (particles.length === 0) return;\n    const r = L.grainRadius;\n\n    ctx.fillStyle = this.grainGlowFill;\n    ctx.beginPath();\n    for (const p of particles) {\n      ctx.moveTo(p.x + r * GRAIN_GLOW_SCALE, p.y);\n      ctx.arc(p.x, p.y, r * GRAIN_GLOW_SCALE, 0, PI2);\n    }\n    ctx.fill();\n\n    ctx.fillStyle = this.grainCoreFill;\n    ctx.beginPath();\n    for (const p of particles) {\n      ctx.moveTo(p.x + r, p.y);\n      ctx.arc(p.x, p.y, r, 0, PI2);\n    }\n    ctx.fill();\n  }\n\n  drawRainParticles(\n    ctx: CanvasRenderingContext2D,\n    L: Layout,\n    rain: { x: number; y: number; alpha: number }[],\n    theme: ClockTheme,\n  ): void {\n    const r = L.miniGrainR;\n    const [gr, gg, gb] = theme.grainRGB;\n    for (const p of rain) {\n      ctx.globalAlpha = p.alpha * (GRAIN_GLOW_ALPHA / GRAIN_ALPHA);\n      ctx.fillStyle = `rgb(${gr},${gg},${gb})`;\n      ctx.beginPath();\n      ctx.arc(p.x, p.y, r * GRAIN_GLOW_SCALE, 0, PI2);\n      ctx.fill();\n\n      ctx.globalAlpha = p.alpha;\n      ctx.beginPath();\n      ctx.arc(p.x, p.y, r, 0, PI2);\n      ctx.fill();\n    }\n    ctx.globalAlpha = 1;\n  }\n\n  // \u2500\u2500 Purge drain animation \u2500\u2500\n\n  beginPurge(L: Layout): void {\n    const numBins = L.numRows + 1;\n    this.purgeOffsets = new Array(numBins).fill(0);\n    this.purgeVelocities = new Array(numBins).fill(0);\n    this.purgeDelays = [];\n    this.purgeAlphas = new Array(numBins).fill(1);\n    for (let i = 0; i < numBins; i++) {\n      const hash = ((i * 2654435761) >>> 0) & 0x7fffffff;\n      this.purgeDelays.push((hash % 1000) / 1000 * 0.2);\n    }\n    this.purging = true;\n  }\n\n  /**\n   * Drain animation: each bin's grains fall with gravity.\n   * Returns true when fully drained.\n   */\n  purgeStacks(L: Layout, dt: number, theme: ClockTheme): boolean {\n    this.sCtx.clearRect(0, 0, L.width, L.height);\n\n    if (!this.purging) {\n      this.binCounts.fill(0);\n      return true;\n    }\n\n    const mr = L.miniGrainR;\n    const d = mr * 2.1;\n    const rowH = L.stackRowH;\n    const maxJitterX = Math.min(4, mr * 2.5);\n    const maxJitterY = rowH * 0.18;\n    const gravity = 1500;\n    let allDone = true;\n\n    // Update physics per-bin\n    for (let bin = 0; bin <= L.numRows; bin++) {\n      if (this.binCounts[bin] === 0) continue;\n      if (this.purgeDelays[bin] > 0) {\n        this.purgeDelays[bin] -= dt;\n        allDone = false;\n        continue;\n      }\n      this.purgeVelocities[bin] += gravity * dt;\n      this.purgeOffsets[bin] += this.purgeVelocities[bin] * dt;\n      this.purgeAlphas[bin] = Math.max(0, 1 - this.purgeOffsets[bin] / (L.height * 0.6));\n      if (this.purgeAlphas[bin] > 0) {\n        allDone = false;\n      }\n    }\n\n    if (allDone) {\n      this.binCounts.fill(0);\n      this.purging = false;\n      return true;\n    }\n\n    // Draw falling grains\n    const [gr, gg, gb] = theme.grainRGB;\n    // Glow pass\n    this.sCtx.beginPath();\n    let anyGlow = false;\n    for (let bin = 0; bin <= L.numRows; bin++) {\n      const alpha = this.purgeAlphas[bin];\n      if (alpha <= 0 || this.binCounts[bin] === 0) continue;\n      const offset = this.purgeOffsets[bin];\n      const binX = pegX(L, L.numRows - 1, bin);\n      for (let k = 0; k < this.binCounts[bin]; k++) {\n        const kk = k + 1;\n        const hexOff = (kk % 2 === 0) ? d * 0.5 : 0;\n        const jx = stackJitterX(bin, kk, maxJitterX);\n        const jy = stackJitterY(bin, kk, maxJitterY);\n        const gx = binX + hexOff + jx;\n        const gy = L.accBottom - (k + 0.5) * rowH + jy + offset;\n        if (gy > L.height + mr * 3) continue;\n        if (!anyGlow) {\n          anyGlow = true;\n        }\n        this.sCtx.moveTo(gx + mr * GRAIN_GLOW_SCALE, gy);\n        this.sCtx.arc(gx, gy, mr * GRAIN_GLOW_SCALE, 0, PI2);\n      }\n    }\n    if (anyGlow) {\n      this.sCtx.fillStyle = `rgba(${gr},${gg},${gb},${GRAIN_GLOW_ALPHA})`;\n      this.sCtx.fill();\n    }\n\n    // Core pass \u2014 need per-bin alpha, so draw per-bin\n    for (let bin = 0; bin <= L.numRows; bin++) {\n      const alpha = this.purgeAlphas[bin];\n      if (alpha <= 0 || this.binCounts[bin] === 0) continue;\n      const offset = this.purgeOffsets[bin];\n      const binX = pegX(L, L.numRows - 1, bin);\n      this.sCtx.fillStyle = `rgba(${gr},${gg},${gb},${(GRAIN_ALPHA * alpha).toFixed(3)})`;\n      this.sCtx.beginPath();\n      for (let k = 0; k < this.binCounts[bin]; k++) {\n        const kk = k + 1;\n        const hexOff = (kk % 2 === 0) ? d * 0.5 : 0;\n        const jx = stackJitterX(bin, kk, maxJitterX);\n        const jy = stackJitterY(bin, kk, maxJitterY);\n        const gx = binX + hexOff + jx;\n        const gy = L.accBottom - (k + 0.5) * rowH + jy + offset;\n        if (gy > L.height + mr) continue;\n        this.sCtx.moveTo(gx + mr, gy);\n        this.sCtx.arc(gx, gy, mr, 0, PI2);\n      }\n      this.sCtx.fill();\n    }\n\n    return false;\n  }\n\n  clearStatic(L: Layout): void {\n    this.binCounts.fill(0);\n    this.sCtx.clearRect(0, 0, L.width, L.height);\n    this.purging = false;\n  }\n\n  /** Ground height based on nearest bin's grain count. */\n  getGroundY(L: Layout, x: number): number {\n    const numBins = L.numRows + 1;\n    let nearestBin = 0;\n    let minDist = Infinity;\n    for (let b = 0; b < numBins; b++) {\n      const bx = pegX(L, L.numRows - 1, b);\n      const dist = Math.abs(x - bx);\n      if (dist < minDist) {\n        minDist = dist;\n        nearestBin = b;\n      }\n    }\n    return L.accBottom - this.binCounts[nearestBin] * L.stackRowH;\n  }\n}\n", "/**\n * AppRenderer \u2014 slim orchestrator.\n * Delegates grain/canvas ops to GrainRenderer, keeps frame pipeline + UI drawing.\n */\n\nimport type { Particle, BoardGeom } from './simulation';\nimport { drawClock, getThemeByName, CLOCK_THEMES } from './seven-seg';\nimport type { ClockTheme } from './seven-seg';\nimport { computeLayout, pegX, pegY } from './layout';\nimport type { Layout } from './layout';\nimport { GrainRenderer } from './grain-renderer';\n\nexport type TimerMode = 'classic' | 'strict' | 'seconds' | 'off';\n\nexport class Renderer {\n  layout!: Layout;\n  private gr: GrainRenderer;\n  private totalParticles: number;\n\n  // \u2500\u2500 Theme & clock \u2500\u2500\n  clockEnabled = true;\n  private currentTheme: ClockTheme = CLOCK_THEMES[0];\n\n  // \u2500\u2500 Alarm \u2500\u2500\n  alarmActive = false;\n  private alarmFlashStart = 0;\n  private alarmHighlight = false;\n\n  constructor(\n    container: HTMLElement,\n    numRows: number,\n    totalParticles: number,\n    _seed: number,\n  ) {\n    this.totalParticles = totalParticles;\n    this.gr = new GrainRenderer(container);\n    this.gr.updateGrainColors(this.currentTheme);\n    this.resize(numRows);\n  }\n\n  setClockEnabled(v: boolean): void {\n    this.clockEnabled = v;\n  }\n\n  setTheme(theme: ClockTheme): void {\n    this.currentTheme = theme;\n    this.gr.updateGrainColors(theme);\n    // Set background tint from theme\n    const [r, g, b] = theme.segmentRGB;\n    document.documentElement.style.setProperty('--bg',\n      `rgb(${Math.round(r * 0.02)},${Math.round(g * 0.02)},${Math.round(b * 0.02)})`);\n    // Rebake static canvas with new grain color\n    this.gr.rebakeStatic(this.layout, theme);\n  }\n\n  setThemeByName(name: string): void {\n    this.setTheme(getThemeByName(name));\n  }\n\n  setGlowIntensity(v: number): void {\n    this.currentTheme = { ...this.currentTheme, glowIntensity: v };\n  }\n\n  getTheme(): ClockTheme {\n    return this.currentTheme;\n  }\n\n  resize(numRows: number): void {\n    const dpr = window.devicePixelRatio || 1;\n    const w = window.innerWidth;\n    const h = window.innerHeight;\n\n    this.layout = computeLayout(w, h, dpr, numRows, this.totalParticles);\n    this.gr.applyLayout(this.layout, this.totalParticles);\n  }\n\n  // \u2500\u2500 Geometry for simulation \u2500\u2500\n\n  pegX(row: number, index: number): number {\n    return pegX(this.layout, row, index);\n  }\n\n  pegY(row: number): number {\n    return pegY(this.layout, row);\n  }\n\n  getGeom(): BoardGeom {\n    return {\n      emitX: this.layout.centerX,\n      emitY: this.layout.emitY,\n      pegX: (r, i) => this.pegX(r, i),\n      pegY: (r) => this.pegY(r),\n      pegSpacing: this.layout.pegSpacing,\n      numRows: this.layout.numRows,\n      accBottom: this.layout.accBottom,\n    };\n  }\n\n  /** Ground height based on nearest bin's grain count. */\n  getGroundY(x: number): number {\n    return this.gr.getGroundY(this.layout, x);\n  }\n\n  // \u2500\u2500 Baking \u2500\u2500\n\n  bakeParticle(p: Particle): void {\n    this.gr.bakeParticle(this.layout, p);\n  }\n\n  // \u2500\u2500 Frame drawing \u2500\u2500\n\n  drawFrame(\n    particles: Particle[],\n    remainingSec: number,\n    totalParticles: number,\n    emittedCount: number,\n    _paused: boolean,\n    totalMs?: number,\n    rain?: { x: number; y: number; alpha: number }[],\n    centiseconds?: number,\n    wallClockSec?: number,\n  ): void {\n    const L = this.layout;\n    const ctx = this.gr.dCtx;\n    ctx.clearRect(0, 0, L.width, L.height);\n\n    if (totalMs !== undefined && totalMs > 0) {\n      this.drawProgressBar(ctx, remainingSec * 1000, totalMs);\n    }\n\n    if (this.clockEnabled) {\n      if (wallClockSec !== undefined) {\n        this.drawSevenSegClock(ctx, wallClockSec, undefined);\n      } else {\n        this.drawSevenSegClock(ctx, remainingSec, centiseconds);\n      }\n    }\n    if (wallClockSec !== undefined) {\n      this.drawInlineTimer(ctx, wallClockSec, undefined);\n    } else {\n      this.drawInlineTimer(ctx, remainingSec, centiseconds);\n    }\n    this.gr.drawHopper(ctx, L, emittedCount, totalParticles);\n\n    // Alarm pin flash\n    let pegAlpha: number | undefined;\n    if (this.alarmActive) {\n      const elapsed = performance.now() - this.alarmFlashStart;\n      const flashDuration = 200;\n      const totalFlashes = 10;\n      const flashIndex = elapsed / flashDuration;\n      if (flashIndex < totalFlashes) {\n        const phase = flashIndex % 1;\n        const wave = Math.sin(phase * Math.PI);\n        pegAlpha = 0.15 + 0.70 * wave;\n      } else {\n        pegAlpha = 0.55;\n        this.alarmHighlight = true;\n      }\n    }\n\n    this.gr.drawPegs(ctx, L, this.currentTheme, pegAlpha);\n    this.gr.drawParticles(ctx, L, particles);\n    if (rain && rain.length > 0) {\n      this.gr.drawRainParticles(ctx, L, rain, this.currentTheme);\n    }\n  }\n\n  private drawProgressBar(ctx: CanvasRenderingContext2D, remainingMs: number, totalMs: number): void {\n    const progress = Math.max(0, Math.min(1, 1 - remainingMs / totalMs));\n    const [r, g, b] = this.currentTheme.segmentRGB;\n    ctx.fillStyle = `rgba(${r},${g},${b},0.60)`;\n    ctx.fillRect(0, 0, this.layout.width * progress, 2);\n  }\n\n  private drawSevenSegClock(ctx: CanvasRenderingContext2D, sec: number, centiseconds?: number): void {\n    const L = this.layout;\n    const digitH = Math.min(L.width * 0.22, L.height * 0.25);\n    drawClock(ctx, Math.floor(sec), L.centerX, L.height / 2, digitH, this.currentTheme, centiseconds);\n  }\n\n  private drawInlineTimer(ctx: CanvasRenderingContext2D, sec: number, centiseconds?: number): void {\n    if (sec <= 0) return;\n    const L = this.layout;\n    const digitH = L.height * 0.04;\n    drawClock(ctx, Math.floor(sec), L.centerX, L.inlineTimerY, digitH, this.currentTheme, centiseconds);\n  }\n\n  // \u2500\u2500 Rain particles (refill \u2014 identical grain rendering) \u2500\u2500\n\n  drawRainParticles(ctx: CanvasRenderingContext2D, rainParticles: { x: number; y: number; alpha: number }[]): void {\n    this.gr.drawRainParticles(ctx, this.layout, rainParticles, this.currentTheme);\n  }\n\n  // \u2500\u2500 Purge \u2500\u2500\n\n  beginPurge(): void {\n    this.gr.beginPurge(this.layout);\n  }\n\n  purgeStacks(dt: number): boolean {\n    return this.gr.purgeStacks(this.layout, dt, this.currentTheme);\n  }\n\n  // \u2500\u2500 Alarm \u2500\u2500\n\n  startAlarm(): void {\n    this.alarmActive = true;\n    this.alarmFlashStart = performance.now();\n    this.alarmHighlight = false;\n  }\n\n  stopAlarm(): void {\n    this.alarmActive = false;\n    this.alarmHighlight = false;\n  }\n\n  /** Clear baked grains and reset all state. */\n  clearStatic(): void {\n    this.gr.clearStatic(this.layout);\n  }\n}\n\nexport { CLOCK_THEMES, getThemeByName };\nexport type { ClockTheme, Layout };\n", "/**\n * Timer Bridge \u2014 wraps the Web Worker timer for main-thread use.\n */\n\nexport class TimerBridge {\n  private worker: Worker;\n  onTick: ((remainingMs: number, elapsedMs: number) => void) | null = null;\n  onDone: (() => void) | null = null;\n\n  constructor() {\n    this.worker = new Worker('dist/timer-worker.js');\n    this.worker.onmessage = (e: MessageEvent) => {\n      const msg = e.data;\n      if (msg.type === 'TICK') {\n        this.onTick?.(msg.remainingMs, msg.elapsedMs);\n      } else if (msg.type === 'DONE') {\n        this.onDone?.();\n      }\n    };\n  }\n\n  start(totalMs: number): void {\n    this.worker.postMessage({\n      type: 'START',\n      totalMs,\n      startAbsMs: performance.now(),\n    });\n  }\n\n  addTime(addMs: number): void {\n    this.worker.postMessage({ type: 'ADD_TIME', addMs });\n  }\n\n  pause(): void {\n    this.worker.postMessage({ type: 'PAUSE' });\n  }\n\n  resume(): void {\n    this.worker.postMessage({\n      type: 'RESUME',\n      resumeAbsMs: performance.now(),\n    });\n  }\n\n  reset(): void {\n    this.worker.postMessage({ type: 'RESET' });\n  }\n}\n", "/**\n * qr-svg.ts\n * Self-contained QR code SVG generator. No external dependencies.\n *\n * Supports:\n *   - Byte mode encoding (covers all URLs / UTF-8 strings)\n *   - Error correction level M\n *   - QR versions 1\u201310 (auto-selects smallest that fits)\n *   - All 8 mask patterns evaluated, best chosen by penalty score\n *   - Returns a complete <svg> string\n *\n * Usage:\n *   generateQRSvg(\"https://example.com\", 256)\n */\n\n// \u2500\u2500\u2500 Reed-Solomon GF(256) arithmetic \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nconst GF_EXP = new Uint8Array(512);\nconst GF_LOG = new Uint8Array(256);\n\n(function initGF() {\n  let x = 1;\n  for (let i = 0; i < 255; i++) {\n    GF_EXP[i] = x;\n    GF_LOG[x] = i;\n    x <<= 1;\n    if (x & 0x100) x ^= 0x11d; // primitive polynomial x^8+x^4+x^3+x^2+1\n    x &= 0xff;\n  }\n  for (let i = 255; i < 512; i++) GF_EXP[i] = GF_EXP[i - 255];\n})();\n\nfunction gfMul(a: number, b: number): number {\n  if (a === 0 || b === 0) return 0;\n  return GF_EXP[GF_LOG[a] + GF_LOG[b]];\n}\n\nfunction gfPolyMul(p: number[], q: number[]): number[] {\n  const r = new Array<number>(p.length + q.length - 1).fill(0);\n  for (let i = 0; i < p.length; i++)\n    for (let j = 0; j < q.length; j++)\n      r[i + j] ^= gfMul(p[i], q[j]);\n  return r;\n}\n\n/** Build RS generator polynomial of degree `n` */\nfunction rsGenerator(n: number): number[] {\n  let g: number[] = [1];\n  for (let i = 0; i < n; i++)\n    g = gfPolyMul(g, [1, GF_EXP[i]]);\n  return g;\n}\n\n/** Compute `ecCount` RS error correction codewords for `data` */\nfunction rsEncode(data: Uint8Array, ecCount: number): Uint8Array {\n  const gen = rsGenerator(ecCount);\n  const msg = new Uint8Array(data.length + ecCount);\n  msg.set(data);\n  for (let i = 0; i < data.length; i++) {\n    const c = msg[i];\n    if (c !== 0)\n      for (let j = 0; j < gen.length; j++)\n        msg[i + j] ^= gfMul(gen[j], c);\n  }\n  return msg.slice(data.length);\n}\n\n// \u2500\u2500\u2500 QR capacity tables (byte mode, EC level M) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n// [version]: { totalDataCodewords, ecCodewordsPerBlock, blocks }\n// Source: QR spec Table 9\nconst EC_M: Record<number, { total: number; ecPerBlock: number; blocks: [number, number][] }> = {\n  1:  { total: 16,  ecPerBlock: 10, blocks: [[1, 16]] },\n  2:  { total: 28,  ecPerBlock: 16, blocks: [[1, 28]] },\n  3:  { total: 44,  ecPerBlock: 26, blocks: [[1, 44]] },\n  4:  { total: 64,  ecPerBlock: 18, blocks: [[2, 32]] },\n  5:  { total: 86,  ecPerBlock: 24, blocks: [[2, 43]] },\n  6:  { total: 108, ecPerBlock: 16, blocks: [[4, 27]] },\n  7:  { total: 124, ecPerBlock: 18, blocks: [[4, 31]] },\n  8:  { total: 154, ecPerBlock: 22, blocks: [[2, 38], [2, 39]] },\n  9:  { total: 182, ecPerBlock: 22, blocks: [[3, 36], [2, 37]] },\n  10: { total: 216, ecPerBlock: 26, blocks: [[4, 43], [1, 44]] },\n};\n\n// Max byte capacity per version at EC level M\nconst BYTE_CAPACITY: Record<number, number> = {\n  1: 14, 2: 26, 3: 42, 4: 62, 5: 84,\n  6: 106, 7: 122, 8: 152, 9: 180, 10: 213,\n};\n\n// Alignment pattern center positions per version\nconst ALIGN_POS: Record<number, number[]> = {\n  1: [], 2: [6,18], 3: [6,22], 4: [6,26], 5: [6,30],\n  6: [6,34], 7: [6,22,38], 8: [6,24,42], 9: [6,26,46], 10: [6,28,50],\n};\n\n// \u2500\u2500\u2500 Format information strings (EC level M, masks 0-7) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n// Pre-computed 15-bit format strings (with mask applied): EC=M (bits 10), mask 0-7\n// Format string = 5-bit data XOR 10-bit BCH, then XOR with 101010000010010\nconst FORMAT_STRINGS: number[] = [\n  0x5412, 0x5125, 0x5E7C, 0x5B4B, 0x45F9, 0x40CE, 0x4F97, 0x4AA0,\n];\n\n// \u2500\u2500\u2500 BitBuffer \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nclass BitBuffer {\n  private buf: number[] = [];\n  private len = 0;\n\n  put(val: number, bits: number): void {\n    for (let i = bits - 1; i >= 0; i--) {\n      this.buf.push((val >> i) & 1);\n      this.len++;\n    }\n  }\n\n  get length(): number { return this.len; }\n\n  getBit(i: number): number { return this.buf[i]; }\n\n  toBytes(): Uint8Array {\n    const bytes = new Uint8Array(Math.ceil(this.len / 8));\n    for (let i = 0; i < this.len; i++) {\n      if (this.buf[i]) bytes[i >> 3] |= 0x80 >> (i & 7);\n    }\n    return bytes;\n  }\n}\n\n// \u2500\u2500\u2500 Module matrix helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\ntype Matrix = Uint8Array[]; // 0=light, 1=dark, 2=reserved\n\nfunction makeMatrix(size: number): Matrix {\n  return Array.from({ length: size }, () => new Uint8Array(size));\n}\n\nfunction setModule(m: Matrix, r: number, c: number, v: number): void {\n  if (r >= 0 && r < m.length && c >= 0 && c < m.length) m[r][c] = v;\n}\n\n// Place a finder pattern (7\u00D77 + separator) at top-left corner offset\nfunction placeFinder(m: Matrix, row: number, col: number): void {\n  for (let r = -1; r <= 7; r++) {\n    for (let c = -1; c <= 7; c++) {\n      const pr = row + r, pc = col + c;\n      if (pr < 0 || pr >= m.length || pc < 0 || pc >= m.length) continue;\n      // outer 7\u00D77: border ring or inner 3\u00D73\n      const inOuter = r >= 0 && r <= 6 && c >= 0 && c <= 6;\n      const ring = r === 0 || r === 6 || c === 0 || c === 6;\n      const inner = r >= 2 && r <= 4 && c >= 2 && c <= 4;\n      m[pr][pc] = inOuter ? (ring || inner ? 1 : 0) : 0;\n    }\n  }\n}\n\nfunction placeAlignment(m: Matrix, r: number, c: number): void {\n  for (let dr = -2; dr <= 2; dr++) {\n    for (let dc = -2; dc <= 2; dc++) {\n      const ring = Math.abs(dr) === 2 || Math.abs(dc) === 2;\n      const center = dr === 0 && dc === 0;\n      m[r + dr][c + dc] = ring || center ? 1 : 0;\n    }\n  }\n}\n\nfunction reserveFormat(m: Matrix, size: number): void {\n  // Format info positions around finders\n  for (let i = 0; i <= 8; i++) {\n    setModule(m, 8, i, 2);\n    setModule(m, i, 8, 2);\n  }\n  setModule(m, 8, 8, 2);\n  for (let i = 0; i < 8; i++) {\n    setModule(m, size - 1 - i, 8, 2);\n    setModule(m, 8, size - 1 - i, 2);\n  }\n  // Dark module\n  m[size - 8][8] = 1;\n}\n\nfunction writeFormat(m: Matrix, size: number, maskId: number): void {\n  const fmt = FORMAT_STRINGS[maskId];\n  // Position 0-14 bits in the format areas\n  const bits: number[] = [];\n  for (let i = 14; i >= 0; i--) bits.push((fmt >> i) & 1);\n\n  let bi = 0;\n  // Top-left horizontal (cols 0-5, skip 6 (timing), col 7, col 8)\n  for (let i = 0; i <= 5; i++) m[8][i] = bits[bi++];\n  m[8][7] = bits[bi++];\n  m[8][8] = bits[bi++];\n  // Top-left vertical (rows 7 down to 0, skip timing row 6)\n  m[7][8] = bits[bi++];\n  for (let i = 5; i >= 0; i--) m[i][8] = bits[bi++];\n\n  // Bottom-left and top-right copies\n  bi = 0;\n  for (let i = 0; i < 8; i++) m[size - 1 - i][8] = bits[bi++];\n  for (let i = 0; i < 7; i++) m[8][size - 7 + i] = bits[bi++];\n}\n\n// \u2500\u2500\u2500 Data placement \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction placeData(m: Matrix, data: number[]): void {\n  const size = m.length;\n  let bitIdx = 0;\n  let up = true;\n\n  for (let right = size - 1; right >= 1; right -= 2) {\n    if (right === 6) right = 5; // skip vertical timing column\n    for (let cnt = 0; cnt < size; cnt++) {\n      const row = up ? size - 1 - cnt : cnt;\n      for (let dc = 0; dc < 2; dc++) {\n        const col = right - dc;\n        if (m[row][col] !== 2 && m[row][col] !== 1) {\n          // will be overwritten, treat 0 as unset data cell\n          // check if it was set by structural functions or is a true data cell\n        }\n        if (m[row][col] === 0 || (m[row][col] !== 2 && m[row][col] !== 1)) {\n          // Only write to cells not already reserved (2) or structural (finder/align/timing set to 0/1)\n          // We track via a separate \"reserved\" mask approach \u2014 cells already marked 1 by structure stay 1\n          // For simplicity: we rely on the fact that structural 0s were placed intentionally.\n          // Data placement ONLY writes to cells that are still 0 AND not reserved (2).\n          if (m[row][col] !== 2) {\n            // check: is this cell structurally used? We mark structural 1s before this call.\n            // cells marked 2 are reserved format cells. cells that are 0 may be structural light or data.\n            // We need a separate \"isFunctional\" grid. Let's use a value of 3 for structural light.\n          }\n        }\n      }\n    }\n    up = !up;\n  }\n}\n\n// \u2500\u2500\u2500 Full matrix builder \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Build the raw (unmasked, no format written) matrix with all structural modules placed.\n * Returns [matrix, functionalMask] where functionalMask[r][c]=1 means not a data cell.\n */\nfunction buildStructural(version: number): [Matrix, Matrix] {\n  const size = version * 4 + 17;\n  const m = makeMatrix(size);\n  const fm = makeMatrix(size); // functional mask\n\n  // Finder patterns\n  placeFinder(m, 0, 0);\n  placeFinder(m, 0, size - 7);\n  placeFinder(m, size - 7, 0);\n\n  // Mark finders + separators as functional\n  for (let r = 0; r <= 8; r++) for (let c = 0; c <= 8; c++) fm[r][c] = 1;\n  for (let r = 0; r <= 8; r++) for (let c = size - 8; c < size; c++) fm[r][c] = 1;\n  for (let r = size - 8; r < size; r++) for (let c = 0; c <= 8; c++) fm[r][c] = 1;\n\n  // Timing patterns\n  for (let i = 8; i < size - 8; i++) {\n    const v = i % 2 === 0 ? 1 : 0;\n    m[6][i] = v; fm[6][i] = 1;\n    m[i][6] = v; fm[i][6] = 1;\n  }\n\n  // Alignment patterns\n  const ap = ALIGN_POS[version] ?? [];\n  for (const r of ap) {\n    for (const c of ap) {\n      if (fm[r][c]) continue; // overlaps finder\n      placeAlignment(m, r, c);\n      for (let dr = -2; dr <= 2; dr++)\n        for (let dc = -2; dc <= 2; dc++)\n          fm[r + dr][c + dc] = 1;\n    }\n  }\n\n  // Format info areas (mark as functional, value 2 used as sentinel for write later)\n  reserveFormat(m, size);\n  for (let i = 0; i <= 8; i++) { fm[8][i] = 1; fm[i][8] = 1; }\n  for (let i = 0; i < 8; i++) { fm[size - 1 - i][8] = 1; fm[8][size - 1 - i] = 1; }\n  fm[size - 8][8] = 1; // dark module\n\n  return [m, fm];\n}\n\n/** Place data bits into the matrix using the standard zigzag pattern */\nfunction embedData(m: Matrix, fm: Matrix, bits: number[]): void {\n  const size = m.length;\n  let idx = 0;\n  let up = true;\n  for (let right = size - 1; right >= 1; right -= 2) {\n    if (right === 6) right = 5;\n    for (let cnt = 0; cnt < size; cnt++) {\n      const row = up ? size - 1 - cnt : cnt;\n      for (let dc = 0; dc < 2; dc++) {\n        const col = right - dc;\n        if (!fm[row][col]) {\n          m[row][col] = idx < bits.length ? bits[idx++] : 0;\n        }\n      }\n    }\n    up = !up;\n  }\n}\n\n/** Apply mask pattern to non-functional cells */\nfunction applyMask(m: Matrix, fm: Matrix, maskId: number): Matrix {\n  const size = m.length;\n  const masked = makeMatrix(size);\n  for (let r = 0; r < size; r++) {\n    for (let c = 0; c < size; c++) {\n      masked[r][c] = m[r][c];\n      if (!fm[r][c]) {\n        let flip = false;\n        switch (maskId) {\n          case 0: flip = (r + c) % 2 === 0; break;\n          case 1: flip = r % 2 === 0; break;\n          case 2: flip = c % 3 === 0; break;\n          case 3: flip = (r + c) % 3 === 0; break;\n          case 4: flip = (Math.floor(r / 2) + Math.floor(c / 3)) % 2 === 0; break;\n          case 5: flip = ((r * c) % 2) + ((r * c) % 3) === 0; break;\n          case 6: flip = (((r * c) % 2) + ((r * c) % 3)) % 2 === 0; break;\n          case 7: flip = (((r + c) % 2) + ((r * c) % 3)) % 2 === 0; break;\n        }\n        if (flip) masked[r][c] ^= 1;\n      }\n    }\n  }\n  return masked;\n}\n\n/** Compute QR penalty score for a masked matrix */\nfunction penaltyScore(m: Matrix): number {\n  const size = m.length;\n  let score = 0;\n\n  // Rule 1: 5+ consecutive same-color in row/col\n  for (let r = 0; r < size; r++) {\n    for (let isRow of [true, false]) {\n      let run = 1;\n      for (let i = 1; i < size; i++) {\n        const cur = isRow ? m[r][i] : m[i][r];\n        const prev = isRow ? m[r][i - 1] : m[i - 1][r];\n        if (cur === prev) { run++; if (run === 5) score += 3; else if (run > 5) score++; }\n        else run = 1;\n      }\n    }\n  }\n\n  // Rule 2: 2\u00D72 blocks\n  for (let r = 0; r < size - 1; r++)\n    for (let c = 0; c < size - 1; c++)\n      if (m[r][c] === m[r][c+1] && m[r][c] === m[r+1][c] && m[r][c] === m[r+1][c+1])\n        score += 3;\n\n  // Rule 3: finder-like patterns\n  const pat1 = [1,0,1,1,1,0,1,0,0,0,0];\n  const pat2 = [0,0,0,0,1,0,1,1,1,0,1];\n  for (let r = 0; r < size; r++) {\n    for (let c = 0; c <= size - 11; c++) {\n      let m1 = true, m2 = true;\n      for (let k = 0; k < 11; k++) {\n        if (m[r][c+k] !== pat1[k]) m1 = false;\n        if (m[r][c+k] !== pat2[k]) m2 = false;\n      }\n      if (m1 || m2) score += 40;\n    }\n  }\n  for (let c = 0; c < size; c++) {\n    for (let r = 0; r <= size - 11; r++) {\n      let m1 = true, m2 = true;\n      for (let k = 0; k < 11; k++) {\n        if (m[r+k][c] !== pat1[k]) m1 = false;\n        if (m[r+k][c] !== pat2[k]) m2 = false;\n      }\n      if (m1 || m2) score += 40;\n    }\n  }\n\n  // Rule 4: dark module ratio\n  let dark = 0;\n  for (let r = 0; r < size; r++) for (let c = 0; c < size; c++) dark += m[r][c];\n  const pct = dark / (size * size) * 100;\n  const k = Math.floor(Math.abs(pct - 50) / 5);\n  score += k * 10;\n\n  return score;\n}\n\n// \u2500\u2500\u2500 Main encoder \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/** Encode `text` as UTF-8 bytes */\nfunction toUtf8(text: string): Uint8Array {\n  const out: number[] = [];\n  for (let i = 0; i < text.length; ) {\n    const cp = text.codePointAt(i)!;\n    if (cp < 0x80) { out.push(cp); i += 1; }\n    else if (cp < 0x800) { out.push(0xc0 | (cp >> 6), 0x80 | (cp & 0x3f)); i += 1; }\n    else if (cp < 0x10000) { out.push(0xe0|(cp>>12), 0x80|((cp>>6)&0x3f), 0x80|(cp&0x3f)); i += 1; }\n    else { out.push(0xf0|(cp>>18), 0x80|((cp>>12)&0x3f), 0x80|((cp>>6)&0x3f), 0x80|(cp&0x3f)); i += 2; }\n  }\n  return new Uint8Array(out);\n}\n\n/** Build the full data codeword sequence (interleaved blocks + EC) */\nfunction buildCodewords(version: number, data: Uint8Array): number[] {\n  const info = EC_M[version];\n  if (!info) throw new Error(`Unsupported version ${version}`);\n\n  // Build message bits\n  const bb = new BitBuffer();\n  bb.put(0b0100, 4);           // mode: byte\n  bb.put(data.length, 8);      // character count (byte mode, versions 1-9 use 8 bits)\n  for (const byte of data) bb.put(byte, 8);\n  bb.put(0, 4);                // terminator\n\n  // Pad to byte boundary\n  while (bb.length % 8 !== 0) bb.put(0, 1);\n  const padBytes = [0xEC, 0x11];\n  let pi = 0;\n  const totalBits = info.total * 8;\n  while (bb.length < totalBits) { bb.put(padBytes[pi & 1], 8); pi++; }\n\n  const msgBytes = bb.toBytes();\n\n  // Split into blocks, compute EC codewords per block\n  const dataBlocks: Uint8Array[] = [];\n  const ecBlocks: Uint8Array[] = [];\n  let offset = 0;\n  for (const [count, blockLen] of info.blocks) {\n    for (let b = 0; b < count; b++) {\n      const block = msgBytes.slice(offset, offset + blockLen);\n      dataBlocks.push(block);\n      ecBlocks.push(rsEncode(block, info.ecPerBlock));\n      offset += blockLen;\n    }\n  }\n\n  // Interleave data codewords\n  const result: number[] = [];\n  const maxDataLen = Math.max(...dataBlocks.map(b => b.length));\n  for (let i = 0; i < maxDataLen; i++)\n    for (const block of dataBlocks)\n      if (i < block.length) result.push(block[i]);\n\n  // Interleave EC codewords\n  for (let i = 0; i < info.ecPerBlock; i++)\n    for (const ec of ecBlocks)\n      result.push(ec[i]);\n\n  return result;\n}\n\n// \u2500\u2500\u2500 Public API \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n/**\n * Generate a QR code SVG string for the given URL.\n * @param url   The text to encode\n * @param size  SVG width/height in pixels\n * @param quiet Number of quiet-zone modules (default 4)\n */\nexport function generateQRSvg(url: string, size: number, quiet = 4): string {\n  const utf8 = toUtf8(url);\n\n  // Pick smallest version that fits\n  let version = 1;\n  while (version <= 10 && BYTE_CAPACITY[version] < utf8.length) version++;\n  if (version > 10) throw new Error('Input too long for version 1-10 QR code');\n\n  const codewords = buildCodewords(version, utf8);\n\n  // Convert codewords to bit array\n  const bits: number[] = [];\n  for (const cw of codewords) for (let i = 7; i >= 0; i--) bits.push((cw >> i) & 1);\n  // Remainder bits (version-specific, all 0)\n  const remBits = [0, 7, 7, 7, 7, 7, 0, 0, 0, 0, 0];\n  for (let i = 0; i < (remBits[version] ?? 0); i++) bits.push(0);\n\n  // Build structural matrix\n  const [baseM, fm] = buildStructural(version);\n  embedData(baseM, fm, bits);\n\n  // Evaluate all 8 masks, pick lowest penalty\n  let bestMask = 0;\n  let bestScore = Infinity;\n  for (let mask = 0; mask < 8; mask++) {\n    const candidate = applyMask(baseM, fm, mask);\n    writeFormat(candidate, candidate.length, mask);\n    const s = penaltyScore(candidate);\n    if (s < bestScore) { bestScore = s; bestMask = mask; }\n  }\n\n  const finalM = applyMask(baseM, fm, bestMask);\n  writeFormat(finalM, finalM.length, bestMask);\n\n  // \u2500\u2500 Render to SVG \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const qSize = finalM.length;\n  const totalModules = qSize + quiet * 2;\n  const moduleSize = size / totalModules;\n\n  const rects: string[] = [];\n  for (let r = 0; r < qSize; r++) {\n    for (let c = 0; c < qSize; c++) {\n      if (finalM[r][c] === 1) {\n        const x = ((c + quiet) * moduleSize).toFixed(2);\n        const y = ((r + quiet) * moduleSize).toFixed(2);\n        const w = (moduleSize + 0.5).toFixed(2); // slight overlap to avoid gaps\n        rects.push(`<rect x=\"${x}\" y=\"${y}\" width=\"${w}\" height=\"${w}\"/>`);\n      }\n    }\n  }\n\n  return [\n    `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${size}\" height=\"${size}\" viewBox=\"0 0 ${size} ${size}\">`,\n    `<rect width=\"${size}\" height=\"${size}\" fill=\"white\"/>`,\n    `<g fill=\"black\">`,\n    ...rects,\n    `</g>`,\n    `</svg>`,\n  ].join('');\n}\n", "/**\n * Control Console \u2014 Tipsy Tap Studio Pro Edition.\n *\n * Refined instrument panel: glassmorphism drawer, digital-gauge aesthetics,\n * generous breathing room. Minimal on-screen controls auto-hide after 5s.\n */\n\nimport { PRESETS, PHYSICS, PhysicsParams } from '../engine/simulation';\nimport { CLOCK_THEMES } from '../engine/seven-seg';\nimport { generateQRSvg } from '../utils/qr-svg';\nimport type { AppMode } from '../utils/url-params';\n\n// \u2500\u2500 Types \u2500\u2500\n\nexport type SignalStatus = 'ready' | 'running' | 'ending' | 'idle' | 'alarm';\n\nexport interface ConsoleController {\n  el: HTMLElement;\n  show(): void;\n  hide(): void;\n  setTime(remainingMs: number): void;\n  setStatus(status: SignalStatus): void;\n  onModeChange: ((mode: string) => void) | null;\n  onPause: (() => void) | null;\n  onStart: (() => void) | null;\n  onStop: (() => void) | null;\n  onThemeChange: ((themeName: string) => void) | null;\n  onDurationChange: ((sec: number) => void) | null;\n  onCentisecondsToggle: ((enabled: boolean) => void) | null;\n  onResetDefaults: (() => void) | null;\n  onShareURL: (() => void) | null;\n  onAppModeChange: ((mode: AppMode) => void) | null;\n  onGravityChange: ((value: number) => void) | null;\n  onBouncinessChange: ((value: number) => void) | null;\n  onFrictionChange: ((value: number) => void) | null;\n  setPaused(paused: boolean): void;\n  setThemeName(name: string): void;\n  setAccentColor(rgb: [number, number, number]): void;\n  closeDrawer(): void;\n}\n\n// \u2500\u2500 Styles \u2500\u2500\n\nfunction injectStyles(): void {\n  if (document.getElementById('gt-console-style')) return;\n  const style = document.createElement('style');\n  style.id = 'gt-console-style';\n  style.textContent = `\n    /* \u2500\u2500 On-screen controls \u2500\u2500 */\n    .gt-controls {\n      position: fixed;\n      bottom: 28px;\n      left: 50%;\n      transform: translateX(-50%);\n      z-index: 1000;\n      display: flex;\n      gap: 20px;\n      align-items: center;\n      user-select: none;\n      transition: opacity 0.4s ease;\n    }\n    .gt-controls.hidden {\n      opacity: 0;\n      pointer-events: none;\n    }\n    .gt-ctrl-btn {\n      width: 36px;\n      height: 36px;\n      border-radius: 50%;\n      border: 1.5px solid rgba(255,255,255,0.12);\n      background: transparent;\n      color: rgba(255,255,255,0.45);\n      font-size: 14px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      transition: background 0.2s, color 0.2s, border-color 0.2s;\n      padding: 0;\n      line-height: 1;\n    }\n    .gt-ctrl-btn:hover {\n      background: rgba(255,255,255,0.04);\n      color: rgba(255,255,255,0.80);\n      border-color: rgba(255,255,255,0.25);\n    }\n    .gt-ctrl-btn:active {\n      background: rgba(255,255,255,0.14);\n    }\n    .gt-ctrl-btn svg {\n      width: 18px;\n      height: 18px;\n      fill: currentColor;\n    }\n\n    /* \u2500\u2500 Side Drawer (Glassmorphism) \u2500\u2500 */\n    .gt-drawer-overlay {\n      position: fixed;\n      inset: 0;\n      z-index: 600;\n      background: rgba(0,0,0,0.35);\n      opacity: 0;\n      pointer-events: none;\n      transition: opacity 0.3s ease;\n    }\n    .gt-drawer-overlay.open {\n      opacity: 1;\n      pointer-events: auto;\n    }\n    .gt-drawer {\n      position: fixed;\n      top: 0;\n      right: 0;\n      bottom: 0;\n      width: 300px;\n      max-width: 82vw;\n      z-index: 601;\n      background: rgba(8,8,12,0.72);\n      border-left: 1px solid rgba(255,255,255,0.05);\n      backdrop-filter: blur(32px) saturate(1.4);\n      -webkit-backdrop-filter: blur(32px) saturate(1.4);\n      transform: translateX(100%);\n      transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);\n      display: flex;\n      flex-direction: column;\n      font-family: 'JetBrains Mono', 'SF Mono', 'Menlo', monospace;\n      overflow-y: auto;\n      scrollbar-width: thin;\n      scrollbar-color: rgba(255,255,255,0.06) transparent;\n    }\n    .gt-drawer.open {\n      transform: translateX(0);\n    }\n    .gt-drawer-content {\n      padding: 40px 28px 32px;\n      display: flex;\n      flex-direction: column;\n      gap: 36px;\n    }\n\n    /* \u2500\u2500 Section headings \u2500\u2500 */\n    .gt-section-title {\n      font-size: 10px;\n      font-weight: 700;\n      letter-spacing: 4px;\n      text-transform: uppercase;\n      color: rgba(255,255,255,0.25);\n      margin-bottom: 20px;\n      padding-bottom: 8px;\n      border-bottom: 1px solid rgba(255,255,255,0.04);\n    }\n    .gt-section {\n      display: flex;\n      flex-direction: column;\n    }\n\n    /* \u2500\u2500 Field rows \u2500\u2500 */\n    .gt-field-row {\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n      gap: 12px;\n      min-height: 36px;\n      margin-bottom: 4px;\n    }\n    .gt-field-label {\n      font-size: 11px;\n      font-weight: 400;\n      color: rgba(255,255,255,0.40);\n      flex-shrink: 0;\n      letter-spacing: 0.5px;\n    }\n    .gt-field-select {\n      flex: 1;\n      max-width: 150px;\n      padding: 6px 10px;\n      background: rgba(255,255,255,0.03);\n      border: 1px solid rgba(255,255,255,0.06);\n      border-radius: 6px;\n      color: rgba(255,255,255,0.60);\n      font-family: inherit;\n      font-size: 11px;\n      outline: none;\n      cursor: pointer;\n      transition: border-color 0.15s;\n    }\n    .gt-field-select:focus {\n      border-color: rgba(255,255,255,0.15);\n    }\n    .gt-field-select option {\n      background: #0c0c0e;\n      color: #bbb;\n    }\n\n    /* \u2500\u2500 Theme strip \u2500\u2500 */\n    .gt-theme-strip {\n      display: flex;\n      gap: 0;\n      margin-bottom: 4px;\n      border-radius: 8px;\n      overflow: hidden;\n      border: 1px solid rgba(255,255,255,0.05);\n    }\n    .gt-theme-chip {\n      flex: 1;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      gap: 5px;\n      padding: 10px 0;\n      font-size: 8.5px;\n      font-weight: 500;\n      letter-spacing: 0.8px;\n      text-transform: uppercase;\n      font-family: inherit;\n      color: rgba(255,255,255,0.30);\n      background: rgba(255,255,255,0.02);\n      border: none;\n      border-right: 1px solid rgba(255,255,255,0.04);\n      cursor: pointer;\n      transition: all 0.25s;\n    }\n    .gt-theme-chip:last-child {\n      border-right: none;\n    }\n    .gt-theme-chip .gt-led {\n      width: 4px;\n      height: 4px;\n      border-radius: 50%;\n      flex-shrink: 0;\n      opacity: 0.45;\n      transition: opacity 0.25s, box-shadow 0.25s;\n    }\n    .gt-theme-chip:hover {\n      background: rgba(255,255,255,0.05);\n      color: rgba(255,255,255,0.55);\n    }\n    .gt-theme-chip:hover .gt-led {\n      opacity: 0.7;\n    }\n    .gt-theme-chip.active {\n      color: rgba(255,255,255,0.85);\n      background: color-mix(in srgb, var(--tc) 6%, transparent);\n      box-shadow: inset 0 0 12px color-mix(in srgb, var(--tc) 8%, transparent);\n    }\n    .gt-theme-chip.active .gt-led {\n      opacity: 1;\n      box-shadow: 0 0 4px var(--tc), 0 0 8px color-mix(in srgb, var(--tc) 50%, transparent);\n    }\n\n    /* \u2500\u2500 Sliders \u2500\u2500 */\n    .gt-slider-row {\n      display: flex;\n      align-items: center;\n      gap: 10px;\n      min-height: 32px;\n      margin-bottom: 4px;\n    }\n    .gt-slider-label {\n      font-size: 10px;\n      font-weight: 400;\n      color: rgba(255,255,255,0.30);\n      width: 52px;\n      flex-shrink: 0;\n      text-align: right;\n      letter-spacing: 0.3px;\n    }\n    .gt-slider-input {\n      -webkit-appearance: none;\n      appearance: none;\n      flex: 1;\n      height: 2px;\n      background: rgba(255,255,255,0.08);\n      border-radius: 1px;\n      outline: none;\n      cursor: pointer;\n    }\n    .gt-slider-input::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      appearance: none;\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background: rgba(255,255,255,0.40);\n      cursor: pointer;\n      transition: background 0.15s;\n    }\n    .gt-slider-input::-webkit-slider-thumb:hover {\n      background: rgba(255,255,255,0.65);\n    }\n    .gt-slider-input::-moz-range-thumb {\n      width: 12px;\n      height: 12px;\n      border-radius: 50%;\n      background: rgba(255,255,255,0.40);\n      cursor: pointer;\n      border: none;\n    }\n    .gt-slider-val {\n      font-size: 10px;\n      font-weight: 400;\n      color: rgba(255,255,255,0.22);\n      width: 38px;\n      text-align: left;\n      letter-spacing: 0.3px;\n    }\n\n    /* \u2500\u2500 Duration control \u2500\u2500 */\n    .gt-dur-row {\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      min-height: 36px;\n      margin-bottom: 4px;\n    }\n    .gt-dur-btn {\n      width: 30px;\n      height: 30px;\n      border-radius: 50%;\n      border: 1px solid rgba(255,255,255,0.08);\n      background: transparent;\n      color: rgba(255,255,255,0.35);\n      font-size: 16px;\n      font-family: inherit;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      cursor: pointer;\n      user-select: none;\n      flex-shrink: 0;\n      transition: all 0.15s;\n    }\n    .gt-dur-btn:hover {\n      background: rgba(255,255,255,0.05);\n      color: rgba(255,255,255,0.70);\n      border-color: rgba(255,255,255,0.15);\n    }\n    .gt-dur-btn:active {\n      background: rgba(255,255,255,0.10);\n    }\n    .gt-dur-display {\n      width: 56px;\n      padding: 0;\n      background: transparent;\n      border: none;\n      color: rgba(255,255,255,0.70);\n      font-family: inherit;\n      font-size: 14px;\n      font-weight: 500;\n      letter-spacing: 1.5px;\n      outline: none;\n      text-align: center;\n      flex-shrink: 0;\n      caret-color: rgba(255,255,255,0.40);\n    }\n    .gt-dur-display:focus {\n      color: rgba(255,255,255,0.90);\n    }\n\n    /* \u2500\u2500 System buttons \u2500\u2500 */\n    .gt-sys-btn {\n      width: 100%;\n      padding: 10px 0;\n      background: rgba(255,255,255,0.02);\n      border: 1px solid rgba(255,255,255,0.05);\n      border-radius: 8px;\n      color: rgba(255,255,255,0.35);\n      font-family: inherit;\n      font-size: 10px;\n      font-weight: 500;\n      letter-spacing: 1px;\n      text-transform: uppercase;\n      cursor: pointer;\n      transition: all 0.15s;\n      margin-bottom: 8px;\n    }\n    .gt-sys-btn:hover {\n      background: rgba(255,255,255,0.05);\n      color: rgba(255,255,255,0.60);\n      border-color: rgba(255,255,255,0.10);\n    }\n    .gt-sys-btn:active {\n      background: rgba(255,255,255,0.08);\n    }\n\n    /* \u2500\u2500 Fixed credits \u2500\u2500 */\n    .gt-credits {\n      position: fixed;\n      bottom: 8px;\n      left: 50%;\n      transform: translateX(-50%);\n      font-size: 9px;\n      color: rgba(255,255,255,0.12);\n      letter-spacing: 1.5px;\n      z-index: 1;\n      pointer-events: none;\n      font-family: 'JetBrains Mono', 'SF Mono', monospace;\n    }\n  `;\n  document.head.appendChild(style);\n}\n\n// \u2500\u2500 Helpers \u2500\u2500\n\nfunction fmtMmSs(sec: number): string {\n  const m = Math.floor(sec / 60);\n  const s = sec % 60;\n  return `${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;\n}\n\nfunction parseMmSs(str: string): number | null {\n  const parts = str.split(':');\n  if (parts.length === 2) {\n    const m = parseInt(parts[0], 10);\n    const s = parseInt(parts[1], 10);\n    if (Number.isFinite(m) && Number.isFinite(s)) return m * 60 + s;\n  }\n  const v = parseInt(str, 10);\n  return Number.isFinite(v) ? v : null;\n}\n\n// \u2500\u2500 Console creation \u2500\u2500\n\nexport function createConsole(\n  initialMode: string,\n  initialTheme = 'Nixie',\n  initialDurationSec = 3600,\n  initialCs = true,\n  initialAppMode: AppMode = 'timer',\n  initialFriction = 1.0,\n): ConsoleController {\n  injectStyles();\n\n  let isPaused = false;\n  let currentDuration = Math.min(initialDurationSec, 3600);\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // FIXED CREDITS\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  const creditsEl = document.createElement('div');\n  creditsEl.className = 'gt-credits';\n  creditsEl.textContent = 'Crafted by Tipsy Tap Studio';\n  document.body.appendChild(creditsEl);\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // ON-SCREEN CONTROLS\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  const controls = document.createElement('div');\n  controls.className = 'gt-controls';\n\n  function makeBtn(svg: string, title: string): HTMLButtonElement {\n    const btn = document.createElement('button');\n    btn.className = 'gt-ctrl-btn';\n    btn.innerHTML = svg;\n    btn.title = title;\n    return btn;\n  }\n\n  const startBtn = makeBtn(\n    '<svg viewBox=\"0 0 24 24\"><polygon points=\"6,4 20,12 6,20\"/></svg>',\n    'Start',\n  );\n  const pauseBtn = makeBtn(\n    '<svg viewBox=\"0 0 24 24\"><rect x=\"5\" y=\"4\" width=\"4\" height=\"16\"/><rect x=\"15\" y=\"4\" width=\"4\" height=\"16\"/></svg>',\n    'Pause',\n  );\n  const stopBtn = makeBtn(\n    '<svg viewBox=\"0 0 24 24\"><rect x=\"5\" y=\"5\" width=\"14\" height=\"14\" rx=\"2\"/></svg>',\n    'Stop',\n  );\n  const settingsBtn = makeBtn(\n    '<svg viewBox=\"0 0 24 24\"><path d=\"M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"/><path d=\"M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\"/></svg>',\n    'Settings',\n  );\n\n  startBtn.addEventListener('click', () => ctrl.onStart?.());\n  pauseBtn.addEventListener('click', () => ctrl.onPause?.());\n  stopBtn.addEventListener('click', () => ctrl.onStop?.());\n  settingsBtn.addEventListener('click', () => toggleDrawer());\n\n  controls.appendChild(startBtn);\n  controls.appendChild(pauseBtn);\n  controls.appendChild(stopBtn);\n  controls.appendChild(settingsBtn);\n  document.body.appendChild(controls);\n\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n  // SIDE DRAWER\n  // \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\n  const overlay = document.createElement('div');\n  overlay.className = 'gt-drawer-overlay';\n  overlay.addEventListener('click', () => closeDrawer());\n\n  const drawer = document.createElement('div');\n  drawer.className = 'gt-drawer';\n\n  const drawerContent = document.createElement('div');\n  drawerContent.className = 'gt-drawer-content';\n\n  // \u2500\u2500 TIMER section \u2500\u2500\n  const timerSection = document.createElement('div');\n  timerSection.className = 'gt-section';\n  timerSection.innerHTML = '<div class=\"gt-section-title\">Timer</div>';\n\n  // App mode\n  const appRow = document.createElement('div');\n  appRow.className = 'gt-field-row';\n  appRow.innerHTML = '<span class=\"gt-field-label\">App</span>';\n  const appSelect = document.createElement('select');\n  appSelect.className = 'gt-field-select';\n  for (const [val, label] of [['timer', 'Timer'], ['clock', 'Clock']] as const) {\n    const opt = document.createElement('option');\n    opt.value = val;\n    opt.textContent = label;\n    if (val === initialAppMode) opt.selected = true;\n    appSelect.appendChild(opt);\n  }\n  appSelect.addEventListener('change', () => {\n    ctrl.onAppModeChange?.(appSelect.value as AppMode);\n    updateClockModeVisibility();\n  });\n  appRow.appendChild(appSelect);\n  timerSection.appendChild(appRow);\n\n  // Duration (hidden in clock mode)\n  const durLabel = document.createElement('div');\n  durLabel.className = 'gt-field-row';\n  durLabel.innerHTML = '<span class=\"gt-field-label\">Duration</span>';\n  durLabel.style.marginBottom = '0';\n\n  const durRow = document.createElement('div');\n  durRow.className = 'gt-dur-row';\n\n  const durMinusBtn = document.createElement('button');\n  durMinusBtn.className = 'gt-dur-btn';\n  durMinusBtn.textContent = '\\u2212';\n\n  const durSlider = document.createElement('input');\n  durSlider.type = 'range';\n  durSlider.className = 'gt-slider-input';\n  durSlider.min = '1';\n  durSlider.max = '3600';\n  durSlider.step = '1';\n  durSlider.value = String(currentDuration);\n  durSlider.style.flex = '1';\n\n  const durDisplay = document.createElement('input');\n  durDisplay.className = 'gt-dur-display';\n  durDisplay.type = 'text';\n  durDisplay.value = fmtMmSs(currentDuration);\n\n  const durPlusBtn = document.createElement('button');\n  durPlusBtn.className = 'gt-dur-btn';\n  durPlusBtn.textContent = '+';\n\n  function setDuration(sec: number): void {\n    sec = Math.max(1, Math.min(3600, sec));\n    currentDuration = sec;\n    durSlider.value = String(sec);\n    durDisplay.value = fmtMmSs(sec);\n    ctrl.onDurationChange?.(sec);\n  }\n\n  durSlider.addEventListener('input', () => {\n    const v = parseInt(durSlider.value, 10);\n    currentDuration = v;\n    durDisplay.value = fmtMmSs(v);\n    ctrl.onDurationChange?.(v);\n  });\n\n  durDisplay.addEventListener('change', () => {\n    const parsed = parseMmSs(durDisplay.value);\n    if (parsed !== null) {\n      setDuration(parsed);\n    } else {\n      durDisplay.value = fmtMmSs(currentDuration);\n    }\n  });\n\n  // +/- hold acceleration\n  let holdInterval: ReturnType<typeof setInterval> | null = null;\n  function startHold(delta: number): void {\n    setDuration(currentDuration + delta);\n    holdInterval = setInterval(() => setDuration(currentDuration + delta), 80);\n  }\n  function stopHold(): void {\n    if (holdInterval !== null) { clearInterval(holdInterval); holdInterval = null; }\n  }\n\n  durMinusBtn.addEventListener('pointerdown', (e) => { e.preventDefault(); startHold(-1); });\n  durMinusBtn.addEventListener('pointerup', stopHold);\n  durMinusBtn.addEventListener('pointerleave', stopHold);\n  durPlusBtn.addEventListener('pointerdown', (e) => { e.preventDefault(); startHold(1); });\n  durPlusBtn.addEventListener('pointerup', stopHold);\n  durPlusBtn.addEventListener('pointerleave', stopHold);\n\n  durRow.appendChild(durMinusBtn);\n  durRow.appendChild(durSlider);\n  durRow.appendChild(durDisplay);\n  durRow.appendChild(durPlusBtn);\n\n  timerSection.appendChild(durLabel);\n  timerSection.appendChild(durRow);\n\n  // Centiseconds (hidden in clock mode)\n  const csRow = document.createElement('div');\n  csRow.className = 'gt-field-row';\n  csRow.innerHTML = '<span class=\"gt-field-label\">Centiseconds</span>';\n  const csSelect = document.createElement('select');\n  csSelect.className = 'gt-field-select';\n  csSelect.innerHTML = '<option value=\"on\">ON</option><option value=\"off\">OFF</option>';\n  csSelect.value = initialCs ? 'on' : 'off';\n  csSelect.addEventListener('change', () => {\n    ctrl.onCentisecondsToggle?.(csSelect.value === 'on');\n  });\n  csRow.appendChild(csSelect);\n  timerSection.appendChild(csRow);\n\n  // Preset\n  const physModeRow = document.createElement('div');\n  physModeRow.className = 'gt-field-row';\n  physModeRow.innerHTML = '<span class=\"gt-field-label\">Preset</span>';\n  const physModeSelect = document.createElement('select');\n  physModeSelect.className = 'gt-field-select';\n  for (const name of Object.keys(PRESETS)) {\n    const opt = document.createElement('option');\n    opt.value = name.toLowerCase();\n    opt.textContent = name;\n    if (name.toLowerCase() === initialMode.toLowerCase()) opt.selected = true;\n    physModeSelect.appendChild(opt);\n  }\n  physModeSelect.addEventListener('change', () => {\n    ctrl.onModeChange?.(physModeSelect.value);\n    updateBaseFromPreset();\n    syncPhysicsSliders();\n  });\n  physModeRow.appendChild(physModeSelect);\n  timerSection.appendChild(physModeRow);\n\n  // Clock mode visibility\n  function updateClockModeVisibility(): void {\n    const isClock = appSelect.value === 'clock';\n    durLabel.style.display = isClock ? 'none' : '';\n    durRow.style.display = isClock ? 'none' : '';\n    csRow.style.display = isClock ? 'none' : '';\n  }\n  updateClockModeVisibility();\n\n  drawerContent.appendChild(timerSection);\n\n  // \u2500\u2500 THEME section \u2500\u2500\n  const themeSection = document.createElement('div');\n  themeSection.className = 'gt-section';\n  themeSection.innerHTML = '<div class=\"gt-section-title\">Theme</div>';\n\n  const themeStrip = document.createElement('div');\n  themeStrip.className = 'gt-theme-strip';\n  const themeChips: HTMLButtonElement[] = [];\n\n  const LED_COLORS: Record<string, string> = {\n    nixie:  '#FF8C00',\n    system: '#00FF41',\n    studio: '#FFFFFF',\n    cyber:  '#00D1FF',\n  };\n\n  for (const t of CLOCK_THEMES) {\n    const chip = document.createElement('button');\n    chip.className = 'gt-theme-chip';\n    const tc = LED_COLORS[t.name.toLowerCase()] || '#fff';\n    chip.style.setProperty('--tc', tc);\n    if (t.name.toLowerCase() === initialTheme.toLowerCase()) chip.classList.add('active');\n\n    const led = document.createElement('span');\n    led.className = 'gt-led';\n    led.style.background = tc;\n    chip.appendChild(led);\n\n    const label = document.createElement('span');\n    label.textContent = t.name;\n    chip.appendChild(label);\n\n    chip.addEventListener('click', () => {\n      themeChips.forEach(c => c.classList.remove('active'));\n      chip.classList.add('active');\n      ctrl.onThemeChange?.(t.name);\n    });\n    themeStrip.appendChild(chip);\n    themeChips.push(chip);\n  }\n  themeSection.appendChild(themeStrip);\n  drawerContent.appendChild(themeSection);\n\n  // \u2500\u2500 PHYSICS section \u2500\u2500\n  const physSection = document.createElement('div');\n  physSection.className = 'gt-section';\n  physSection.innerHTML = '<div class=\"gt-section-title\">Physics</div>';\n\n  // Base drag values for friction multiplier\n  let baseDragX = PHYSICS.dragX;\n  let baseDragY = PHYSICS.dragY;\n  let baseDragXSettle = PHYSICS.dragXSettle;\n  let baseDragYSettle = PHYSICS.dragYSettle;\n  let currentFriction = initialFriction;\n\n  function updateBaseFromPreset(): void {\n    baseDragX = PHYSICS.dragX;\n    baseDragY = PHYSICS.dragY;\n    baseDragXSettle = PHYSICS.dragXSettle;\n    baseDragYSettle = PHYSICS.dragYSettle;\n  }\n\n  function applyFriction(f: number): void {\n    currentFriction = f;\n    PHYSICS.dragX = baseDragX * f;\n    PHYSICS.dragY = baseDragY * f;\n    PHYSICS.dragXSettle = baseDragXSettle * f;\n    PHYSICS.dragYSettle = baseDragYSettle * f;\n  }\n\n  if (initialFriction !== 1.0) {\n    applyFriction(initialFriction);\n  }\n\n  // Gravity\n  const gravRow = document.createElement('div');\n  gravRow.className = 'gt-slider-row';\n  const gravLabel = document.createElement('span');\n  gravLabel.className = 'gt-slider-label';\n  gravLabel.textContent = 'Gravity';\n  const gravInput = document.createElement('input');\n  gravInput.type = 'range';\n  gravInput.className = 'gt-slider-input';\n  gravInput.min = '50';\n  gravInput.max = '3000';\n  gravInput.step = '10';\n  gravInput.value = String(PHYSICS.gravity);\n  const gravVal = document.createElement('span');\n  gravVal.className = 'gt-slider-val';\n  gravVal.textContent = String(Math.round(PHYSICS.gravity));\n  gravInput.addEventListener('input', () => {\n    const v = parseFloat(gravInput.value);\n    PHYSICS.gravity = v;\n    gravVal.textContent = String(Math.round(v));\n    ctrl.onGravityChange?.(v);\n  });\n  gravRow.appendChild(gravLabel);\n  gravRow.appendChild(gravInput);\n  gravRow.appendChild(gravVal);\n  physSection.appendChild(gravRow);\n\n  // Bounce (restitution)\n  const bounceRow = document.createElement('div');\n  bounceRow.className = 'gt-slider-row';\n  const bounceLabel = document.createElement('span');\n  bounceLabel.className = 'gt-slider-label';\n  bounceLabel.textContent = 'Bounce';\n  const bounceInput = document.createElement('input');\n  bounceInput.type = 'range';\n  bounceInput.className = 'gt-slider-input';\n  bounceInput.min = '0';\n  bounceInput.max = '1.0';\n  bounceInput.step = '0.01';\n  bounceInput.value = String(PHYSICS.restitution);\n  const bounceVal = document.createElement('span');\n  bounceVal.className = 'gt-slider-val';\n  bounceVal.textContent = PHYSICS.restitution.toFixed(2);\n  bounceInput.addEventListener('input', () => {\n    const v = parseFloat(bounceInput.value);\n    PHYSICS.restitution = v;\n    bounceVal.textContent = v.toFixed(2);\n    ctrl.onBouncinessChange?.(v);\n  });\n  bounceRow.appendChild(bounceLabel);\n  bounceRow.appendChild(bounceInput);\n  bounceRow.appendChild(bounceVal);\n  physSection.appendChild(bounceRow);\n\n  // Flow (friction multiplier)\n  const fricRow = document.createElement('div');\n  fricRow.className = 'gt-slider-row';\n  const fricLabel = document.createElement('span');\n  fricLabel.className = 'gt-slider-label';\n  fricLabel.textContent = 'Flow';\n  const fricInput = document.createElement('input');\n  fricInput.type = 'range';\n  fricInput.className = 'gt-slider-input';\n  fricInput.min = '0.5';\n  fricInput.max = '3.0';\n  fricInput.step = '0.05';\n  fricInput.value = String(currentFriction);\n  const fricVal = document.createElement('span');\n  fricVal.className = 'gt-slider-val';\n  fricVal.textContent = `\\u00D7${currentFriction.toFixed(2)}`;\n  fricInput.addEventListener('input', () => {\n    const v = parseFloat(fricInput.value);\n    applyFriction(v);\n    fricVal.textContent = `\\u00D7${v.toFixed(2)}`;\n    ctrl.onFrictionChange?.(v);\n  });\n  fricRow.appendChild(fricLabel);\n  fricRow.appendChild(fricInput);\n  fricRow.appendChild(fricVal);\n  physSection.appendChild(fricRow);\n\n  // Reset\n  const physResetBtn = document.createElement('button');\n  physResetBtn.className = 'gt-sys-btn';\n  physResetBtn.textContent = 'Reset Physics';\n  physResetBtn.style.marginTop = '12px';\n  physResetBtn.addEventListener('click', () => {\n    applyPreset(physModeSelect.value);\n    updateBaseFromPreset();\n    currentFriction = 1.0;\n    applyFriction(1.0);\n    syncPhysicsSliders();\n  });\n  physSection.appendChild(physResetBtn);\n\n  function syncPhysicsSliders(): void {\n    gravInput.value = String(PHYSICS.gravity);\n    gravVal.textContent = String(Math.round(PHYSICS.gravity));\n    bounceInput.value = String(PHYSICS.restitution);\n    bounceVal.textContent = PHYSICS.restitution.toFixed(2);\n    fricInput.value = String(currentFriction);\n    fricVal.textContent = `\\u00D7${currentFriction.toFixed(2)}`;\n  }\n\n  drawerContent.appendChild(physSection);\n\n  // \u2500\u2500 SYSTEM section (with QR code baked into template) \u2500\u2500\n  const _qrSvg = generateQRSvg('https://tipsytapstudio.github.io/galton-timer/', 140);\n  const sysSection = document.createElement('div');\n  sysSection.className = 'gt-section';\n  sysSection.innerHTML = `<div class=\"gt-section-title\">System</div>`;\n\n  const shareBtn = document.createElement('button');\n  shareBtn.className = 'gt-sys-btn';\n  shareBtn.textContent = 'Share URL';\n  shareBtn.addEventListener('click', () => {\n    ctrl.onShareURL?.();\n    shareBtn.textContent = 'Copied!';\n    setTimeout(() => { shareBtn.textContent = 'Share URL'; }, 1500);\n  });\n  sysSection.appendChild(shareBtn);\n\n  const resetBtn = document.createElement('button');\n  resetBtn.className = 'gt-sys-btn';\n  resetBtn.textContent = 'Reset to Default';\n  resetBtn.addEventListener('click', () => ctrl.onResetDefaults?.());\n  sysSection.appendChild(resetBtn);\n\n  // Inject QR code directly into sysSection's innerHTML (part of the template)\n  sysSection.insertAdjacentHTML('beforeend',\n    `<div style=\"margin-top:24px;padding-top:20px;border-top:1px solid #333;display:flex;flex-direction:column;align-items:center;gap:10px\">` +\n    `<span style=\"font-size:9px;color:#888;letter-spacing:1px\">Scan to open (Mobile)</span>` +\n    `<div style=\"width:140px;height:140px;border-radius:4px;overflow:hidden\">${_qrSvg}</div>` +\n    `</div>`\n  );\n  drawerContent.appendChild(sysSection);\n\n  drawer.appendChild(drawerContent);\n  document.body.appendChild(overlay);\n  document.body.appendChild(drawer);\n\n  // \u2500\u2500 Drawer toggle \u2500\u2500\n  let drawerOpen = false;\n\n  function toggleDrawer(): void {\n    drawerOpen = !drawerOpen;\n    drawer.classList.toggle('open', drawerOpen);\n    overlay.classList.toggle('open', drawerOpen);\n    if (drawerOpen) { syncPhysicsSliders(); }\n  }\n\n  function closeDrawer(): void {\n    drawerOpen = false;\n    drawer.classList.remove('open');\n    overlay.classList.remove('open');\n  }\n\n  // \u2500\u2500 Controller \u2500\u2500\n  const ctrl: ConsoleController = {\n    el: controls,\n    show() { controls.classList.remove('hidden'); },\n    hide() {\n      controls.classList.add('hidden');\n      if (drawerOpen) closeDrawer();\n    },\n    setTime(_remainingMs: number) {},\n    setStatus(_status: SignalStatus) {},\n    onModeChange: null,\n    onPause: null,\n    onStart: null,\n    onStop: null,\n    onThemeChange: null,\n    onDurationChange: null,\n    onCentisecondsToggle: null,\n    onResetDefaults: null,\n    onShareURL: null,\n    onAppModeChange: null,\n    onGravityChange: null,\n    onBouncinessChange: null,\n    onFrictionChange: null,\n    setPaused(p: boolean) {\n      isPaused = p;\n      startBtn.style.display = p ? '' : 'none';\n      pauseBtn.style.display = p ? 'none' : '';\n    },\n    setThemeName(name: string) {\n      themeChips.forEach(c => {\n        c.classList.toggle('active', c.textContent?.toLowerCase() === name.toLowerCase());\n      });\n    },\n    setAccentColor(rgb: [number, number, number]) {\n      const [r, g, b] = rgb;\n      const accentBorder = `rgba(${r},${g},${b},0.30)`;\n      const accentColor = `rgba(${r},${g},${b},0.70)`;\n      for (const btn of [startBtn, pauseBtn, stopBtn, settingsBtn]) {\n        btn.style.borderColor = accentBorder;\n        btn.style.color = accentColor;\n      }\n    },\n    closeDrawer,\n  };\n\n  startBtn.style.display = 'none';\n  return ctrl;\n}\n\nexport function applyPreset(modeName: string): void {\n  const key = Object.keys(PRESETS).find(\n    k => k.toLowerCase() === modeName.toLowerCase()\n  );\n  if (!key) return;\n  const preset = PRESETS[key];\n  for (const k of Object.keys(preset) as (keyof PhysicsParams)[]) {\n    (PHYSICS as any)[k] = preset[k];\n  }\n}\n", "/**\n * GALTON-TIMER \u2014 main entry point.\n * \"Chaos to Order, Randomness to Truth.\"\n *\n * Time authority: The Web Worker timer is the SOLE source of truth for elapsed time.\n * The simulation never self-increments elapsedMs \u2014 it receives it from Worker ticks.\n * On tab-hidden, the Worker keeps running (never paused). On restore, we snap.\n */\n\nimport { readParams, writeParams } from './utils/url-params';\nimport type { AppMode } from './utils/url-params';\nimport { createPRNG } from './utils/seed';\nimport { Simulation } from './engine/simulation';\nimport { Renderer, getThemeByName } from './engine/renderer';\nimport { gaussianHW } from './engine/layout';\nimport { TimerBridge } from './engine/timer-bridge';\nimport { createConsole, applyPreset } from './components/console';\n\n// \u2500\u2500 Bootstrap \u2500\u2500\n\nconst params = readParams();\n\n// CLOCK mode overrides\nconst isClockMode = params.app === 'clock';\nif (isClockMode) {\n  params.n = 3600;\n  params.t = 3600;\n} else if (params.timerMode === 'seconds') {\n  params.n = params.t; // 1:1 sync: one grain per second\n}\nwriteParams(params);\n\nconst rng = createPRNG(params.s);\n\nlet sim = new Simulation({\n  numRows: params.rows,\n  totalParticles: params.n,\n  totalTimeSec: params.t,\n  rng,\n});\n\n// \u2500\u2500 DOM \u2500\u2500\n\nconst container = document.getElementById('app')!;\nconst renderer = new Renderer(container, params.rows, params.n, params.s);\n\n// \u2500\u2500 Apply initial theme + clock \u2500\u2500\n\nrenderer.setThemeByName(params.theme);\nrenderer.setClockEnabled(params.clock);\nrenderer.setGlowIntensity(1.0); // Fixed recommended glow\n\n// \u2500\u2500 Apply initial mode preset \u2500\u2500\n\napplyPreset(params.mode);\n\n// \u2500\u2500 Web Worker Timer (SOLE time authority) \u2500\u2500\n\nconst timerBridge = new TimerBridge();\nlet workerRemainingMs = params.t * 1000;\n\n// Clock mode: worker elapsed starts from 0 for the remaining portion of the hour,\n// but the simulation needs the full hour-elapsed offset so grains continue emitting.\nlet clockElapsedOffset = 0;\n\ntimerBridge.onTick = (remainingMs, elapsedMs) => {\n  workerRemainingMs = remainingMs;\n  sim.setElapsedMs(elapsedMs + clockElapsedOffset);\n  consoleCtrl.setTime(remainingMs);\n};\n\ntimerBridge.onDone = () => {\n  workerRemainingMs = 0;\n  consoleCtrl.setTime(0);\n\n  if (isClockMode) {\n    // Hourly refill \u2014 no alarm, auto restart\n    startTheLoop();\n  } else {\n    renderer.startAlarm();\n    consoleCtrl.setStatus('alarm');\n  }\n};\n\n// \u2500\u2500 Console \u2500\u2500\n\nconst consoleCtrl = createConsole(\n  params.mode,\n  params.theme,\n  params.t,\n  params.cs,\n  params.app,\n  params.friction,\n);\n\n// Set initial accent color\nconsoleCtrl.setAccentColor(getThemeByName(params.theme).segmentRGB);\n\n// Auto-hide timer (5 seconds)\nlet hideTimeout: ReturnType<typeof setTimeout> | null = null;\n\nfunction showConsole(): void {\n  consoleCtrl.show();\n  if (hideTimeout !== null) clearTimeout(hideTimeout);\n  hideTimeout = setTimeout(() => consoleCtrl.hide(), 5000);\n}\n\ndocument.addEventListener('mousemove', showConsole);\ndocument.addEventListener('touchstart', showConsole);\nshowConsole();\n\n// Console callbacks\nconsoleCtrl.onModeChange = (modeName: string) => {\n  applyPreset(modeName);\n  params.mode = modeName;\n  writeParams(params);\n};\n\nconsoleCtrl.onThemeChange = (themeName: string) => {\n  renderer.setThemeByName(themeName);\n  consoleCtrl.setThemeName(themeName);\n  consoleCtrl.setAccentColor(getThemeByName(themeName).segmentRGB);\n  params.theme = themeName.toLowerCase();\n  writeParams(params);\n};\n\nconsoleCtrl.onCentisecondsToggle = (enabled: boolean) => {\n  params.cs = enabled;\n  writeParams(params);\n};\n\nconsoleCtrl.onDurationChange = (sec: number) => {\n  params.t = sec;\n  writeParams(params);\n};\n\nconsoleCtrl.onAppModeChange = (mode: AppMode) => {\n  params.app = mode;\n  writeParams(params);\n  // Reload to fully reinitialize with new mode\n  window.location.reload();\n};\n\nconsoleCtrl.onGravityChange = (_value: number) => {\n  // Gravity is set directly on PHYSICS by the console slider\n};\n\nconsoleCtrl.onFrictionChange = (value: number) => {\n  params.friction = value;\n  writeParams(params);\n};\n\nconsoleCtrl.onPause = () => togglePause();\nconsoleCtrl.onStart = () => {\n  if (paused) togglePause();      // resume if paused\n  else if (appState === 'idle' || sim.allSettled) startTheLoop(); // restart\n};\nconsoleCtrl.onStop = () => startTheLoop();\n\nconsoleCtrl.onShareURL = () => {\n  writeParams(params);\n  navigator.clipboard.writeText(window.location.href).catch(() => {});\n};\n\nconsoleCtrl.onResetDefaults = () => {\n  window.location.search = '';\n};\n\n// \u2500\u2500 State \u2500\u2500\n\ntype AppState = 'running' | 'paused' | 'purging' | 'refilling' | 'idle';\nlet appState: AppState = 'idle';\nlet lastTime: number | null = null;\nlet paused = false;\nlet rafId = 0;\n\n// Rain particles for refill animation\nlet rainParticles: { x: number; y: number; vx: number; vy: number; alpha: number; bounces: number }[] = [];\nlet refillElapsed = 0;\n\n// \u2500\u2500 Helpers \u2500\u2500\n\nfunction getCs(): number | undefined {\n  if (isClockMode) return undefined;\n  if (!params.cs) return undefined;\n  return Math.floor((workerRemainingMs % 1000) / 10);\n}\n\nfunction getWallClockSec(): number | undefined {\n  if (!isClockMode) return undefined;\n  const now = new Date();\n  return now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds();\n}\n\nfunction togglePause(): void {\n  if (appState === 'purging' || appState === 'refilling') return;\n  if (sim.allSettled) return;\n\n  paused = !paused;\n  consoleCtrl.setPaused(paused);\n\n  if (paused) {\n    appState = 'paused';\n    timerBridge.pause();\n    cancelAnimationFrame(rafId);\n    renderer.drawFrame(\n      sim.activeParticles,\n      workerRemainingMs / 1000,\n      sim.totalParticles,\n      sim.emittedCount,\n      true,\n      sim.totalTimeMs,\n      undefined,\n      getCs(),\n      getWallClockSec(),\n    );\n  } else {\n    appState = 'running';\n    timerBridge.resume();\n    lastTime = null;\n    rafId = requestAnimationFrame(frame);\n  }\n}\n\nfunction startTheLoop(): void {\n  timerBridge.reset();\n  cancelAnimationFrame(rafId);\n  renderer.stopAlarm();\n  renderer.beginPurge();\n  appState = 'purging';\n  consoleCtrl.setStatus('ending');\n  lastTime = null;\n  rafId = requestAnimationFrame(frame);\n}\n\nfunction beginRefill(): void {\n  appState = 'refilling';\n  refillElapsed = 0;\n  rainParticles = [];\n\n  const L = renderer.layout;\n  const hopperHW = L.hopperTopHW;\n  const count = Math.min(Math.round(params.n * 0.15), 400);\n  for (let i = 0; i < count; i++) {\n    const tx = (Math.random() - 0.5) * 2;\n    rainParticles.push({\n      x: L.centerX + tx * hopperHW * 0.85,\n      y: L.hopperTop - 5 - Math.random() * 25,\n      vx: (Math.random() - 0.5) * 8,\n      vy: 300 + Math.random() * 50,\n      alpha: 0.5 + Math.random() * 0.3,\n      bounces: 0,\n    });\n  }\n}\n\nfunction startFresh(): void {\n  sim.reset();\n  renderer.clearStatic();\n  renderer.resize(params.rows);\n\n  workerRemainingMs = params.t * 1000;\n  paused = false;\n  appState = 'running';\n\n  consoleCtrl.setPaused(false);\n  consoleCtrl.setStatus('ready');\n  consoleCtrl.setTime(params.t * 1000);\n\n  setTimeout(() => {\n    if (appState === 'running') {\n      consoleCtrl.setStatus('running');\n    }\n  }, 1000);\n\n  if (isClockMode) {\n    // Start from current position within the hour\n    const now = new Date();\n    const min = now.getMinutes();\n    const sec = now.getSeconds();\n    const ms = now.getMilliseconds();\n    const elapsedInHourMs = (min * 60 + sec) * 1000 + ms;\n    const remainingMs = 3600000 - elapsedInHourMs;\n\n    // Store offset so onTick adds it to worker's elapsed\n    clockElapsedOffset = elapsedInHourMs;\n\n    timerBridge.start(remainingMs);\n    workerRemainingMs = remainingMs;\n\n    // Instantly snap elapsed grains into place\n    sim.setElapsedMs(elapsedInHourMs);\n    const geom = renderer.getGeom();\n    const snapped = sim.instantSnap(geom);\n    for (const p of snapped) {\n      renderer.bakeParticle(p);\n    }\n  } else {\n    clockElapsedOffset = 0;\n    timerBridge.start(params.t * 1000);\n  }\n\n  lastTime = null;\n  rafId = requestAnimationFrame(frame);\n}\n\nfunction bakeSettledBatch(particles: import('./engine/simulation').Particle[]): void {\n  for (const p of particles) {\n    renderer.bakeParticle(p);\n  }\n}\n\n// \u2500\u2500 Resize \u2500\u2500\n\nwindow.addEventListener('resize', () => {\n  renderer.resize(params.rows);\n  if (paused || sim.allSettled) {\n    renderer.drawFrame(\n      sim.activeParticles,\n      workerRemainingMs / 1000,\n      sim.totalParticles,\n      sim.emittedCount,\n      paused,\n      sim.totalTimeMs,\n      undefined,\n      getCs(),\n      getWallClockSec(),\n    );\n  }\n});\n\n// \u2500\u2500 Pause / Resume (Space) \u2500\u2500\n\ndocument.addEventListener('keydown', (e) => {\n  if (e.code === 'Space') {\n    e.preventDefault();\n    togglePause();\n  }\n});\n\n// \u2500\u2500 Visibility API (Instant Snap) \u2500\u2500\n\ndocument.addEventListener('visibilitychange', () => {\n  if (document.hidden) {\n    cancelAnimationFrame(rafId);\n  } else {\n    if (appState !== 'running') {\n      if (appState === 'purging' || appState === 'refilling') {\n        lastTime = null;\n        rafId = requestAnimationFrame(frame);\n      }\n      return;\n    }\n\n    const geom = renderer.getGeom();\n    const forcedSettled = sim.forceSettleActive();\n    bakeSettledBatch(forcedSettled);\n    const snapped = sim.instantSnap(geom);\n    bakeSettledBatch(snapped);\n\n    renderer.drawFrame(\n      sim.activeParticles,\n      workerRemainingMs / 1000,\n      sim.totalParticles,\n      sim.emittedCount,\n      false,\n      sim.totalTimeMs,\n      undefined,\n      getCs(),\n      getWallClockSec(),\n    );\n\n    lastTime = null;\n    rafId = requestAnimationFrame(frame);\n  }\n});\n\n// \u2500\u2500 Main Loop \u2500\u2500\n\nfunction frame(now: number): void {\n  if (appState === 'paused' || appState === 'idle') return;\n\n  if (lastTime === null) lastTime = now;\n  const dtMs = Math.min(now - lastTime, 100);\n  const dtSec = dtMs / 1000;\n  lastTime = now;\n\n  if (appState === 'purging') {\n    const done = renderer.purgeStacks(dtSec);\n    renderer.drawFrame([], 0, sim.totalParticles, sim.totalParticles, false, sim.totalTimeMs);\n\n    if (done) {\n      beginRefill();\n    }\n    rafId = requestAnimationFrame(frame);\n    return;\n  }\n\n  if (appState === 'refilling') {\n    refillElapsed += dtMs;\n\n    const L = renderer.layout;\n    const gravity = 400;\n    for (const p of rainParticles) {\n      p.vy += gravity * dtSec;\n      p.x += p.vx * dtSec;\n      p.y += p.vy * dtSec;\n\n      if (p.y >= L.hopperBottom) {\n        p.y = L.hopperBottom - 1;\n        if (p.bounces < 3 && Math.abs(p.vy) > 15) {\n          const e = 0.15 + Math.random() * 0.30;\n          p.vy = -Math.abs(p.vy) * e;\n          p.vx = (Math.random() - 0.5) * 60;\n          p.bounces++;\n        } else {\n          p.vy = 0;\n          p.vx = 0;\n          p.alpha = Math.max(0, p.alpha - dtSec * 1.8);\n        }\n      }\n\n      const hw = gaussianHW(p.y, L);\n      const maxX = L.centerX + hw * 0.88;\n      const minX = L.centerX - hw * 0.88;\n      if (p.x > maxX) { p.x = maxX; p.vx = -Math.abs(p.vx) * 0.3; }\n      if (p.x < minX) { p.x = minX; p.vx = Math.abs(p.vx) * 0.3; }\n    }\n    rainParticles = rainParticles.filter(p => p.alpha > 0.01);\n\n    renderer.drawFrame([], params.t, sim.totalParticles, 0, false, sim.totalTimeMs, rainParticles);\n\n    if (refillElapsed >= 800) {\n      startFresh();\n      return;\n    }\n    rafId = requestAnimationFrame(frame);\n    return;\n  }\n\n  // \u2500\u2500 Running state \u2500\u2500\n  const geom = renderer.getGeom();\n  const settled = sim.update(dtMs, geom, (x) => renderer.getGroundY(x));\n\n  for (const p of settled) {\n    renderer.bakeParticle(p);\n  }\n\n  renderer.drawFrame(\n    sim.activeParticles,\n    workerRemainingMs / 1000,\n    sim.totalParticles,\n    sim.emittedCount,\n    false,\n    sim.totalTimeMs,\n    undefined,\n    getCs(),\n    getWallClockSec(),\n  );\n\n  if (!sim.allSettled) {\n    rafId = requestAnimationFrame(frame);\n  } else {\n    consoleCtrl.setStatus('ending');\n  }\n}\n\n// \u2500\u2500 Initial start \u2500\u2500\n\nstartFresh();\n"],
  "mappings": "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AA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA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",
  "names": ["container", "container", "rainParticles", "k"]
}
