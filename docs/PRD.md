# docs/PRD.md

## 1. コンセプト・ステートメント
**"Chaos to Order, Randomness to Truth."**
一粒の砂の行方は予測不能だが、一万粒の砂は神の方程式（正規分布）へと収束する。GALTON-TIMERは、フランシス・ゴルトン卿へのリスペクトと、中心極限定理に対するエンジニア的執着が生み出した、実用性を兼ね備えた「数学的おもちゃ」である。
※注：本アプリは統計学の実証を目的としており、癒やしやスピリチュアルな効果は一切含まれていません。あるのは厳密な二項分布の近似だけです。

---

## 2. ターゲット・エクスペリエンス
- **体験の核**: 喧騒（ランダム）の中に潜む秩序（真理）を、デスクトップの片隅で静かに目撃する。
- **デザイン哲学**: `WALL-CLOCK` と同系統のミニマリズム。情報の引き算により「砂の動き」を際立たせる。
- **開発エピソード**: 物理演算のリアルよりも数学的純粋性を優先。$50/50$ の純粋な確率抽選こそがこのアプリの「正義」である。

---

## 3. 主要機能 (Core Features)

### 3.1 物理シミュレーター & タイマー
- **放出アルゴリズム**: 設定時間 $T$ 内に総粒子数 $N$ を均等に放出する「ブザービーター」方式。
- **数学的挙動**: 釘の各段（標準12段）で左右 $\pm 0.5$ の純粋な確率分岐。
- **物理演算の簡略化 (MVP)**:
    - 粒子同士の衝突は無視。
    - 落下中はカスタム数学ループ（Custom Math Loop）で座標更新。
    - 底に到達した粒子は「Static Baking（背景画像化）」し、動的な描画リストから除外することで負荷を最小化。
- **モバイル最適化**: スマホブラウザでの **60fps** 維持を絶対条件とする。

### 3.2 「FLIP（反転）」操作
- **アクション**: リセットボタンまたは操作により重力ベクトルを反転。
- **演出**: 溜まった秩序（ベルカーブ）が崩れ、上部の排出口へ吸い込まれるように戻る「エントロピーの逆転」を視覚化。

### 3.3 終了演出（二段階の終焉）
1. **Release End**: 上部の砂が空になった（タイマーが **00:00** になった）瞬間に放出停止。
2. **Settled End**: 最後の粒子が底に静止した瞬間、ベルカーブが一度パルス発光。サンプルサイズ（例：$N=10,000$）を表示。
3. **Sound**: 澄んだサイン波の減衰音（シンギングボウル的な響き）を一度だけ鳴らす。

---

## 4. ビジュアル・デザインシステム (Series Guideline)

| 項目 | 仕様 |
| :--- | :--- |
| **背景色** | **#000000** (純粋な黒) |
| **フォント** | **JetBrains Mono** (等幅。コードの佇まい) |
| **粒子（砂）** | **#FFFFFF** またはテーマカラー。1pxの点、または微発光ドット。 |
| **UI要素** | 最小限。設定パネルは不透明度を下げ、背景に溶け込ませる。 |
| **URL共有** | `?t=300&m=1&s=42` 等の形式で、時間・モード・シード値を共有。 |

---

## 5. 技術スタック & フォルダ構成

### 5.1 Tech Stack
- **Language**: TypeScript / JavaScript (ES6+)
- **Rendering**: HTML5 Canvas API (2D Context)
- **Audio**: Web Audio API (Waveform synthesis)
- **Optimization**: Static Layer Baking / PRNG (Seed-based)

### 5.2 Folder Structure
galton-timer/
├── index.html
├── src/
│   ├── main.ts         # Init & App Loop
│   ├── engine/
│   │   ├── simulation.ts # Math-based particle logic
│   │   ├── renderer.ts   # Canvas rendering & Baking
│   │   └── audio.ts      # Minimalist sound synth
│   ├── components/
│   │   ├── timer.ts      # Emission rate control
│   │   └── ui.ts         # Settings & URL Sync
│   └── utils/
│       ├── seed.ts       # PRNG logic
│       └── url-params.ts # State serialization
├── docs/
│   ├── PRD.md          # 本ドキュメント
│   └── DESIGN_GUIDELINE.md
└── README.md

---

## 6. 優先順位 (Priority)

1. **Must**: 1万粒をスマホで動かすBaking描画の実装。
2. **Must**: 時間通りの放出制御とURLパラメータによる再現性。
3. **Should**: 「NEON GHOST」モード（残像エフェクト）。
4. **Could**: AUTO-LOOP（サイネージモード）。

---

## 7. 開発メモ（ユーモアとこだわり）
- **「50/50の嘘」について**: 現実の物理では入射角や摩擦が影響するが、本作では「中心極限定理の純粋性」を尊び、あえて $50:50$ の数学的抽選のみを採用する。この「物理よりも数学を優先した」という歪みが、本作のアイデンティティである。
- **スピリチュアル排除**: ユーザーが「運勢」を見出さないよう、淡々と統計データとしての側面を強調する。
- **パフォーマンス**: 1万個のインスタンスを愚直に描画してはならない。静止した瞬間にビットマップに焼き付ける「Baking」こそが、このアプリをタイマーとして成立させる鍵である。